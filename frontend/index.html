<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Shaker - 智能鸡尾酒推荐专家</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        :root {
            /* 森林主题色调 - 绿意清新温暖 */
            --primary-gradient: linear-gradient(135deg, #2d5016 0%, #4a7c59 50%, #8fbc8f 100%);
            --forest-dark: #1a2e1a;
            --forest-green: #228b22;
            --warm-green: #8fbc8f;
            --leaf-green: #9acd32;
            --soft-beige: #f5f5dc;
            
            /* 背景色 - 温暖自然 */
            --bg-primary: #f8f5f0;
            --bg-secondary: #e8f5e8;
            --bg-glass: rgba(143, 188, 143, 0.1);
            --bg-glass-hover: rgba(143, 188, 143, 0.2);
            --bg-warm: rgba(245, 245, 220, 0.9);
            
            /* 文本色 - 自然温暖 */
            --text-primary: #2d4a2d;
            --text-secondary: #4a7c59;
            --text-muted: #6b8e6b;
            --text-warm: #8b4513;
            
            /* 边框和阴影 - 柔和自然 */
            --border-natural: rgba(143, 188, 143, 0.3);
            --shadow-soft: 0 4px 20px rgba(34, 139, 34, 0.1);
            --shadow-warm: 0 8px 32px rgba(139, 69, 19, 0.1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            line-height: 1.6;
            overflow-x: hidden;
            scroll-behavior: smooth;
        }

        /* 森林背景 - 绿意清新温暖 */
        .bg-animation {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            z-index: -1;
            background: linear-gradient(180deg, #f8f5f0 0%, #e8f5e8 50%, #d0e7d0 100%);
            overflow: hidden;
        }

        .bg-animation::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: 
                radial-gradient(circle at 15% 30%, rgba(34, 139, 34, 0.1) 0%, transparent 40%),
                radial-gradient(circle at 70% 20%, rgba(143, 188, 143, 0.15) 0%, transparent 50%),
                radial-gradient(circle at 85% 70%, rgba(154, 205, 50, 0.1) 0%, transparent 45%),
                radial-gradient(circle at 30% 80%, rgba(34, 139, 34, 0.08) 0%, transparent 60%);
            animation: forestSway 15s ease-in-out infinite;
        }

        .bg-animation::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-image: 
                radial-gradient(circle at 25% 60%, rgba(154, 205, 50, 0.2) 2px, transparent 2px),
                radial-gradient(circle at 75% 40%, rgba(143, 188, 143, 0.15) 1px, transparent 1px),
                radial-gradient(circle at 50% 20%, rgba(34, 139, 34, 0.1) 1px, transparent 1px),
                radial-gradient(circle at 90% 90%, rgba(139, 69, 19, 0.1) 1px, transparent 1px);
            background-size: 120px 120px, 80px 80px, 150px 150px, 200px 200px;
            animation: leafDance 8s ease-in-out infinite alternate;
        }

        @keyframes forestSway {
            0%, 100% { transform: translate(0, 0) scale(1); }
            33% { transform: translate(10px, -5px) scale(1.02); }
            66% { transform: translate(-8px, 8px) scale(0.98); }
        }

        @keyframes elegantBlink {
            0%, 50% { opacity: 1; transform: scaleY(1); }
            51%, 100% { opacity: 0.3; transform: scaleY(0.8); }
        }

        @keyframes fadeOut {
            0% { opacity: 1; transform: scaleY(1); }
            100% { opacity: 0; transform: scaleY(0); }
        }

        @keyframes gentleGlow {
            0%, 100% { box-shadow: 0 20px 60px rgba(34, 139, 34, 0.08), 0 8px 25px rgba(0, 0, 0, 0.05); }
            50% { box-shadow: 0 25px 70px rgba(34, 139, 34, 0.12), 0 10px 30px rgba(0, 0, 0, 0.08); }
        }

        @keyframes leafDance {
            0% { opacity: 0.4; transform: translateY(0px); }
            100% { opacity: 0.7; transform: translateY(-10px); }
        }

        /* 容器 */
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 2rem;
        }

        /* 玻璃态效果 */
        .glass-card {
            background: var(--bg-glass);
            backdrop-filter: blur(20px);
            border: 1px solid var(--border-glass);
            border-radius: 20px;
            box-shadow: var(--shadow-card);
            transition: all 0.3s ease;
        }

        .glass-card:hover {
            background: var(--bg-glass-hover);
            transform: translateY(-5px);
            box-shadow: var(--shadow-glow);
        }

        /* 头部导航 - 森林风格 */
        .header {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 1000;
            padding: 1rem 0;
            background: transparent;
            transition: all 0.3s ease;
        }

        .header.scrolled {
            background: rgba(248, 245, 240, 0.95);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid var(--border-natural);
            box-shadow: var(--shadow-soft);
        }

        .header .container {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--text-primary);
            text-decoration: none;
        }

        .logo-icon {
            font-size: 2rem;
            background: linear-gradient(45deg, var(--forest-green), var(--warm-green));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        /* 树叶装饰 - 只在标题前面 */
        .title-leaf {
            display: inline-block;
            margin-right: 1rem;
            font-size: 3rem;
            animation: leafSway 3s ease-in-out infinite;
            vertical-align: middle;
        }

        @keyframes leafSway {
            0%, 100% { transform: rotate(-5deg); }
            50% { transform: rotate(5deg); }
        }

        /* 主要内容区域 */
        .main-content {
            padding-top: 5rem;
            min-height: 100vh;
        }

        /* 英雄区域 */
        .hero-section {
            padding: 12rem 0 8rem;
            text-align: center;
            min-height: 100vh;
            display: flex;
            align-items: flex-start;
            position: relative;
            padding-top: 20vh;
        }

        .hero-title {
            font-size: clamp(2.5rem, 5vw, 4rem);
            font-weight: 800;
            margin-bottom: 1.5rem;
            color: var(--text-primary);
        }

        .gradient-text {
            background: linear-gradient(135deg, var(--forest-dark) 0%, var(--forest-green) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .hero-subtitle {
            font-size: 1.2rem;
            color: var(--text-secondary);
            margin-bottom: 3rem;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
        }

        .hero-cta {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 1rem 2rem;
            background: linear-gradient(135deg, var(--forest-green), var(--warm-green));
            color: white;
            text-decoration: none;
            border-radius: 50px;
            font-weight: 600;
            font-size: 1.1rem;
            transition: all 0.3s ease;
            box-shadow: var(--shadow-soft);
        }

        .hero-cta:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-warm);
            background: linear-gradient(135deg, var(--warm-green), var(--leaf-green));
        }

        /* 右侧进度指示器 */
        .progress-sidebar {
            position: fixed;
            right: 2rem;
            top: 50%;
            transform: translateY(-50%);
            z-index: 1000;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .progress-line-main {
            width: 2px;
            height: 400px;
            background: linear-gradient(180deg, var(--border-natural) 0%, var(--forest-green) 50%, var(--border-natural) 100%);
            position: relative;
        }

        .progress-indicator {
            position: absolute;
            left: 50%;
            transform: translateX(-50%);
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: var(--forest-green);
            top: 0%;
            transition: all 0.5s ease;
            box-shadow: 0 0 10px rgba(34, 139, 34, 0.5);
        }

        /* 移动端隐藏进度条 */
        @media (max-width: 768px) {
            .progress-sidebar {
                display: none;
            }
        }

        /* 场景卡片样式 - 一排3个 */
        .scene-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 1.5rem;
            margin-top: 2rem;
        }

        .scene-card {
            padding: 2rem 1.5rem;
            background: var(--bg-warm);
            border: 2px solid var(--border-natural);
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
        }

        .scene-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-soft);
        }

        .scene-card.selected {
            background: linear-gradient(135deg, rgba(34, 139, 34, 0.15), rgba(143, 188, 143, 0.2));
            border-color: var(--forest-green);
            box-shadow: 0 0 20px rgba(34, 139, 34, 0.3);
            transform: translateY(-2px);
        }

        /* 场景特定动画 */
        .scene-card[data-value="聚会派对"].selected .scene-icon {
            animation: partyPulse 2s ease-in-out infinite;
        }

        .scene-card[data-value="浪漫约会"].selected .scene-icon {
            animation: heartBeat 1.5s ease-in-out infinite;
        }

        .scene-card[data-value="独处放松"].selected .scene-icon {
            animation: meditateFloat 3s ease-in-out infinite;
        }

        .scene-card[data-value="商务会面"].selected .scene-icon {
            animation: businessShake 2s ease-in-out infinite;
        }

        .scene-card[data-value="夜晚时光"].selected .scene-icon {
            animation: moonGlow 2.5s ease-in-out infinite;
        }

        .scene-card[data-value="午后惬意"].selected .scene-icon {
            animation: sunRays 3s ease-in-out infinite;
        }

        /* 场景动画关键帧 */
        @keyframes partyPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.2); filter: brightness(1.5); }
        }

        @keyframes heartBeat {
            0%, 100% { transform: scale(1); }
            25% { transform: scale(1.1); }
            50% { transform: scale(1.15); }
            75% { transform: scale(1.1); }
        }

        @keyframes meditateFloat {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-8px); }
        }

        @keyframes businessShake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-2px); }
            75% { transform: translateX(2px); }
        }

        @keyframes moonGlow {
            0%, 100% { filter: brightness(1); }
            50% { filter: brightness(1.2); }
        }

        @keyframes sunRays {
            0%, 100% { transform: rotate(0deg); filter: brightness(1); }
            50% { transform: rotate(5deg); filter: brightness(1.3); }
        }



        .scene-icon {
            font-size: 2.5rem;
            display: block;
            margin-bottom: 1rem;
        }

        .scene-title {
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: inherit;
        }

        .scene-desc {
            font-size: 0.9rem;
            color: var(--text-muted);
            line-height: 1.4;
        }

        .scene-card.selected .scene-desc {
            color: rgba(255, 255, 255, 0.9);
        }

        /* 响应式 */
        @media (max-width: 768px) {
            .scene-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        /* 心情卡片样式 - 一排3个 */
        .mood-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 1.5rem;
            margin-top: 2rem;
        }

        .mood-card {
            padding: 2rem 1.5rem;
            background: var(--bg-warm);
            border: 2px solid var(--border-natural);
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
        }

        .mood-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-soft);
        }

        .mood-card.selected {
            background: linear-gradient(135deg, rgba(34, 139, 34, 0.12), rgba(143, 188, 143, 0.18));
            border-color: var(--forest-green);
            box-shadow: 0 0 15px rgba(34, 139, 34, 0.25);
            transform: translateY(-2px);
        }

        /* 心情特定动画 */
        .mood-card[data-value="春日愉悦"].selected .mood-icon {
            animation: springBloom 2s ease-in-out infinite;
        }

        .mood-card[data-value="雨后忧郁"].selected {
            position: relative;
            overflow: hidden;
        }

        .mood-card[data-value="雨后忧郁"].selected::before {
            content: '';
            position: absolute;
            top: -50px;
            left: 0;
            right: 0;
            height: 100px;
            background: linear-gradient(45deg, transparent 30%, rgba(173, 216, 230, 0.3) 50%, transparent 70%);
            animation: rainDrop 1.5s ease-in-out infinite;
            pointer-events: none;
        }

        .mood-card[data-value="雨后忧郁"].selected .mood-icon {
            animation: rainGlow 2s ease-in-out infinite;
        }

        .mood-card[data-value="夏日激情"].selected .mood-icon {
            animation: fireIntensity 1.8s ease-in-out infinite;
        }

        .mood-card[data-value="秋叶宁静"].selected .mood-icon {
            animation: leafFall 3s ease-in-out infinite;
        }

        .mood-card[data-value="山峰自信"].selected .mood-icon {
            animation: mountainStand 2.5s ease-in-out infinite;
        }

        .mood-card[data-value="深林沉思"].selected .mood-icon {
            animation: forestWisdom 3.5s ease-in-out infinite;
        }

        /* 心情动画关键帧 */
        @keyframes springBloom {
            0%, 100% { transform: scale(1) rotate(0deg); filter: brightness(1); }
            50% { transform: scale(1.15) rotate(5deg); filter: brightness(1.4); }
        }

        @keyframes rainDrop {
            0% { transform: translateY(-100px); opacity: 0; }
            50% { opacity: 0.7; }
            100% { transform: translateY(100px); opacity: 0; }
        }

        @keyframes rainGlow {
            0%, 100% { filter: brightness(1) contrast(1); }
            50% { filter: brightness(1.2) contrast(1.3) hue-rotate(10deg); }
        }

        @keyframes fireIntensity {
            0%, 100% { transform: scale(1); filter: brightness(1) hue-rotate(0deg); }
            25% { transform: scale(1.1); filter: brightness(1.3) hue-rotate(5deg); }
            75% { transform: scale(1.05); filter: brightness(1.2) hue-rotate(-5deg); }
        }

        @keyframes leafFall {
            0%, 100% { transform: translateY(0px) rotate(0deg); }
            25% { transform: translateY(-5px) rotate(2deg); }
            75% { transform: translateY(3px) rotate(-2deg); }
        }

        @keyframes mountainStand {
            0%, 100% { transform: scale(1); filter: brightness(1); }
            50% { transform: scale(1.08); filter: brightness(1.25) contrast(1.1); }
        }

        @keyframes forestWisdom {
            0%, 100% { transform: scale(1) rotate(0deg); filter: brightness(1) sepia(0%); }
            33% { transform: scale(1.05) rotate(1deg); filter: brightness(1.1) sepia(10%); }
            66% { transform: scale(1.03) rotate(-1deg); filter: brightness(1.15) sepia(5%); }
        }

        .mood-icon {
            font-size: 2.5rem;
            display: block;
            margin-bottom: 1rem;
        }

        .mood-title {
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: inherit;
        }

        .mood-desc {
            font-size: 0.9rem;
            color: var(--text-muted);
            line-height: 1.4;
        }

        .mood-card.selected .mood-desc {
            color: rgba(255, 255, 255, 0.9);
        }

        /* 响应式 */
        @media (max-width: 768px) {
            .mood-grid, .scene-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .preference-grid {
                grid-template-columns: 1fr;
                gap: 2rem;
                max-width: 400px;
            }
            
            .preference-card {
                padding: 2rem 1.5rem;
                min-height: 180px;
            }
            
            .slider-container {
                margin: 2rem 0;
            }
        }

        /* 偏好设置样式 */
        .preference-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 3rem;
            margin: 3rem 0;
            max-width: 1200px;
            margin-left: auto;
            margin-right: auto;
        }

        .preference-card {
            padding: 3rem 2.5rem;
            text-align: center;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
            min-height: 200px;
        }

        .preference-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, var(--forest-green), var(--warm-green), var(--leaf-green));
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .preference-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 24px rgba(34, 139, 34, 0.15);
        }

        .preference-card:hover::before {
            opacity: 1;
        }

        .preference-title {
            font-size: 1.4rem;
            font-weight: 600;
            margin-bottom: 2.5rem;
            color: var(--text-primary);
            position: relative;
        }

        .preference-title::after {
            content: '';
            position: absolute;
            bottom: -8px;
            left: 50%;
            transform: translateX(-50%);
            width: 30px;
            height: 2px;
            background: linear-gradient(90deg, var(--forest-green), var(--warm-green));
            border-radius: 1px;
        }

        .slider-container {
            margin: 3rem 0;
            position: relative;
        }

        .slider-value {
            position: absolute;
            top: -40px;
            left: 50%;
            transform: translateX(-50%);
            background: linear-gradient(135deg, var(--forest-green), var(--warm-green));
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 15px;
            font-size: 0.9rem;
            font-weight: 600;
            opacity: 0;
            transition: all 0.3s ease;
            pointer-events: none;
            box-shadow: 0 4px 12px rgba(34, 139, 34, 0.3);
            white-space: nowrap;
            min-width: 60px;
            text-align: center;
        }

        .slider-value::after {
            content: '';
            position: absolute;
            top: 100%;
            left: 50%;
            transform: translateX(-50%);
            border: 4px solid transparent;
            border-top-color: var(--forest-green);
        }

        .slider:hover + .slider-value,
        .slider:focus + .slider-value {
            opacity: 1;
            transform: translateX(-50%) translateY(-5px) !important;
        }

        .slider {
            width: 100%;
            height: 6px;
            border-radius: 50px;
            background: linear-gradient(90deg, 
                rgba(34, 139, 34, 0.2) 0%, 
                rgba(143, 188, 143, 0.3) 50%, 
                rgba(34, 139, 34, 0.2) 100%);
            outline: none;
            -webkit-appearance: none;
            margin: 1.5rem 0;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .slider:hover {
            background: linear-gradient(90deg, 
                rgba(34, 139, 34, 0.3) 0%, 
                rgba(143, 188, 143, 0.4) 50%, 
                rgba(34, 139, 34, 0.3) 100%);
        }

        .slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--forest-green), var(--warm-green));
            cursor: pointer;
            box-shadow: 0 2px 8px rgba(34, 139, 34, 0.4), 0 0 0 3px rgba(255, 255, 255, 0.8);
            transition: all 0.3s ease;
        }

        .slider::-webkit-slider-thumb:hover {
            transform: scale(1.15);
            box-shadow: 0 4px 12px rgba(34, 139, 34, 0.6), 0 0 0 4px rgba(255, 255, 255, 0.9);
        }

        .slider::-moz-range-thumb {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--forest-green), var(--warm-green));
            cursor: pointer;
            border: 3px solid rgba(255, 255, 255, 0.8);
            box-shadow: 0 2px 8px rgba(34, 139, 34, 0.4);
            transition: all 0.3s ease;
        }

        .slider::-moz-range-thumb:hover {
            transform: scale(1.15);
            box-shadow: 0 4px 12px rgba(34, 139, 34, 0.6);
        }

        .slider-labels {
            display: flex;
            justify-content: space-between;
            margin-top: 1.5rem;
            font-size: 0.95rem;
            color: var(--text-muted);
        }

        .slider-labels span {
            padding: 0.5rem 1rem;
            background: rgba(34, 139, 34, 0.08);
            border-radius: 14px;
            transition: all 0.3s ease;
            font-weight: 500;
        }

        .slider-labels span:hover {
            background: rgba(34, 139, 34, 0.15);
            color: var(--forest-dark);
            transform: translateY(-1px);
        }

        /* 特殊要求样式 */
        .requirement-container {
            margin-top: 2rem;
        }

        .requirement-input {
            width: 100%;
            padding: 1.5rem;
            border: 2px solid var(--border-natural);
            border-radius: 15px;
            background: var(--bg-warm);
            color: var(--text-primary);
            font-family: inherit;
            font-size: 1rem;
            line-height: 1.6;
            resize: vertical;
            transition: all 0.3s ease;
        }

        .requirement-input:focus {
            outline: none;
            border-color: var(--forest-green);
            box-shadow: 0 0 0 3px rgba(34, 139, 34, 0.1);
        }

        .requirement-tags {
            margin-top: 1.5rem;
        }

        .requirement-tags h5 {
            color: var(--text-secondary);
            margin-bottom: 1rem;
            font-weight: 500;
        }

        .tag-list {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
        }

        .requirement-tag {
            padding: 0.5rem 1rem;
            background: var(--bg-warm);
            border: 1px solid var(--border-natural);
            border-radius: 25px;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .requirement-tag:hover {
            background: rgba(34, 139, 34, 0.1);
            border-color: var(--forest-green);
            transform: translateY(-1px);
        }

        .requirement-tag.selected {
            background: linear-gradient(45deg, var(--forest-green), var(--warm-green));
            color: white;
            border-color: var(--forest-green);
        }

        /* 基酒布局 - 气泡模式下不需要特殊grid */
        .ingredient-list.spirits-grid {
            /* 气泡模式下所有标签都是绝对定位，不需要特殊布局 */
        }

        .spirits-grid .ingredient-tag {
            /* 气泡模式下统一样式 */
        }

        /* 推荐流程区域 */
        .recommendation-section {
            padding: 4rem 0;
            opacity: 0;
            transform: translateY(50px);
            transition: all 0.8s ease;
        }

        .recommendation-section.visible {
            opacity: 1;
            transform: translateY(0);
        }

        .section-title {
            font-size: 2.5rem;
            font-weight: 700;
            text-align: center;
            margin-bottom: 1rem;
            background: linear-gradient(135deg, var(--forest-dark) 0%, var(--forest-green) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        /* 分析区域标题特殊样式 */
        #shakerAnalysisSection .section-title {
            font-size: 1.8rem;
            font-weight: 500;
            line-height: 1.6;
            margin-bottom: 2.5rem;
            padding: 2rem 3rem;
            max-width: 800px;
            margin-left: auto;
            margin-right: auto;
            background: linear-gradient(135deg, 
                rgba(255, 255, 255, 0.95) 0%, 
                rgba(248, 245, 240, 0.9) 50%,
                rgba(232, 245, 232, 0.85) 100%);
            border-radius: 30px;
            border: 1px solid rgba(143, 188, 143, 0.2);
            box-shadow: 
                0 20px 60px rgba(34, 139, 34, 0.08),
                0 8px 25px rgba(0, 0, 0, 0.05),
                inset 0 1px 0 rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(20px);
            color: var(--text-primary);
            -webkit-text-fill-color: var(--text-primary);
            background-clip: initial;
            -webkit-background-clip: initial;
            display: block;
            position: relative;
            transition: all 0.4s ease;
            text-align: center;
            letter-spacing: 0.3px;
            animation: gentleGlow 4s ease-in-out infinite;
        }

        #shakerAnalysisSection .section-title:hover {
            transform: translateY(-3px);
            box-shadow: 
                0 25px 70px rgba(34, 139, 34, 0.12),
                0 10px 30px rgba(0, 0, 0, 0.08),
                inset 0 1px 0 rgba(255, 255, 255, 0.9);
        }

        #shakerAnalysisSection .section-title::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, 
                rgba(143, 188, 143, 0.05) 0%, 
                rgba(34, 139, 34, 0.02) 100%);
            border-radius: 25px;
            z-index: -1;
        }

        .section-subtitle {
            font-size: 1.1rem;
            color: var(--text-secondary);
            text-align: center;
            margin-bottom: 3rem;
            font-style: italic;
        }

        /* 选择区域样式 */
        .choice-section {
            padding: 4rem 0;
            min-height: 100vh;
            display: flex;
            align-items: center;
        }

        /* 步骤容器 - 垂直滚动布局 */
        .steps-container {
            max-width: 800px;
            margin: 0 auto;
            min-height: 100vh;
        }

        /* 步骤自动切换动画 */
        .step-content {
            opacity: 0;
            transform: translateY(50px) scale(0.95);
            transition: all 0.8s cubic-bezier(0.4, 0, 0.2, 1);
            pointer-events: none;
        }

        .step-content.active {
            opacity: 1;
            transform: translateY(0) scale(1);
            pointer-events: auto;
        }

        .step-content.completed {
            opacity: 0.3;
            transform: translateY(-20px) scale(0.9);
            pointer-events: none;
        }

        .step-progress {
            display: flex;
            justify-content: center;
            align-items: center;
            margin-bottom: 3rem;
            gap: 1rem;
        }

        .progress-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: var(--border-glass);
            transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }

        .progress-dot::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(45deg, var(--primary-purple), var(--primary-blue));
            border-radius: 50%;
            transform: scale(0);
            transition: transform 0.5s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .progress-dot.active {
            background: var(--primary-purple);
            box-shadow: 0 0 30px rgba(108, 92, 231, 0.8);
            transform: scale(1.3);
        }

        .progress-dot.active::before {
            transform: scale(1);
            animation: pulse 2s infinite;
        }

        .progress-dot.completed {
            background: var(--primary-blue);
            box-shadow: 0 0 20px rgba(116, 185, 255, 0.6);
        }

        .progress-dot.completed::before {
            transform: scale(1);
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.2); opacity: 0.7; }
        }

        .progress-line {
            width: 40px;
            height: 2px;
            background: var(--border-glass);
            transition: all 0.8s ease;
            position: relative;
            overflow: hidden;
            border-radius: 1px;
        }

        .progress-line::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, var(--primary-purple), var(--primary-blue), transparent);
            transition: left 0.8s ease;
        }

        .progress-line.active {
            background: linear-gradient(90deg, var(--primary-purple), var(--primary-blue));
            box-shadow: 0 0 10px rgba(108, 92, 231, 0.5);
        }

        .progress-line.active::before {
            left: 100%;
        }

        /* 步骤内容 */
        .step-content {
            display: none;
            animation: fadeInUp 0.6s ease;
        }

        .step-content.active {
            display: block;
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .step-title {
            font-size: 1.8rem;
            font-weight: 600;
            text-align: center;
            margin-bottom: 2rem;
            color: var(--text-primary);
        }

        .step-description {
            text-align: center;
            color: var(--text-secondary);
            margin-bottom: 2rem;
        }

        /* 选项网格 */
        .options-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin: 2rem 0;
        }

        .option-card {
            padding: 1.5rem;
            background: var(--bg-warm);
            border: 1px solid var(--border-natural);
            border-radius: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
            box-shadow: var(--shadow-soft);
        }

        .option-card:hover {
            background: var(--bg-glass-hover);
            transform: translateY(-3px);
            border-color: var(--warm-green);
            box-shadow: var(--shadow-warm);
        }

        .option-card.selected {
            background: linear-gradient(135deg, rgba(143, 188, 143, 0.2) 0%, rgba(154, 205, 50, 0.2) 100%);
            border-color: var(--forest-green);
            box-shadow: 0 8px 25px rgba(34, 139, 34, 0.3);
        }

        .option-icon {
            font-size: 2.5rem;
            margin-bottom: 1rem;
            display: block;
        }

        .option-title {
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: var(--text-primary);
        }

        .option-desc {
            font-size: 0.9rem;
            color: var(--text-muted);
            line-height: 1.4;
        }

        /* 材料选择 - 主题容器横向布局 */
        .ingredients-section {
            display: flex;
            flex-direction: row;
            gap: 1.5rem;
            margin: 2rem 0;
            overflow-x: auto;
            padding: 1rem 0;
            justify-content: center;
            background: transparent !important;
            border: none !important;
            backdrop-filter: none !important;
        }

        .ingredient-category {
            position: relative;
            flex: 1;
            min-width: 300px;
            height: 220px;
            background: var(--bg-glass);
            border: 2px solid var(--border-glass);
            border-radius: 20px;
            backdrop-filter: blur(10px);
            padding: 1rem;
            display: flex;
            flex-direction: column;
        }

        /* 正常容器样式 */
        .ingredient-category[data-theme="spirits"] {
            background: linear-gradient(135deg, rgba(139, 69, 19, 0.08), rgba(160, 82, 45, 0.12));
            border-color: rgba(139, 69, 19, 0.3);
        }

        .ingredient-category[data-theme="mixers"] {
            background: linear-gradient(135deg, rgba(34, 139, 34, 0.08), rgba(50, 205, 50, 0.12));
            border-color: rgba(34, 139, 34, 0.3);
        }

        .ingredient-category[data-theme="tools"] {
            background: linear-gradient(135deg, rgba(70, 130, 180, 0.08), rgba(100, 149, 237, 0.12));
            border-color: rgba(70, 130, 180, 0.3);
        }

        /* 响应式设计 */
        @media (max-width: 768px) {
            .ingredients-section {
                flex-direction: column;
                gap: 1.5rem;
                max-width: unset;
            }
            
            .ingredient-category {
                min-width: unset;
                width: 100%;
                min-height: 350px;
            }
        }

        .category-title {
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 1rem;
            color: var(--text-primary);
            text-align: center;
            position: relative;
            z-index: 10;
        }

        .ingredient-list {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            padding: 0.8rem 0 0 0;
            flex: 1;
            align-content: flex-start;
        }

        .ingredient-tag {
            padding: 0.5rem 1rem;
            background: var(--bg-secondary);
            border: 1px solid var(--border-glass);
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.9rem;
            white-space: nowrap;
            user-select: none;
        }

        .ingredient-tag:hover {
            transform: translateY(-2px) scale(1.02);
            box-shadow: 0 3px 8px rgba(0, 0, 0, 0.15);
        }

        /* 基酒标签选中效果 - 棕色系 */
        .ingredient-category[data-theme="spirits"] .ingredient-tag:hover {
            border-color: rgba(139, 69, 19, 0.6);
            background: rgba(139, 69, 19, 0.1);
        }

        .ingredient-category[data-theme="spirits"] .ingredient-tag.selected {
            background: linear-gradient(135deg, rgba(139, 69, 19, 0.2), rgba(160, 82, 45, 0.3));
            border-color: rgba(139, 69, 19, 0.6);
            color: rgba(101, 45, 12, 0.9);
            box-shadow: 0 0 8px rgba(139, 69, 19, 0.4);
            transform: translateY(-1px);
            animation: selectShake 0.5s ease-in-out;
        }

        /* 调味料标签选中效果 - 绿色系 */
        .ingredient-category[data-theme="mixers"] .ingredient-tag:hover {
            border-color: rgba(34, 139, 34, 0.6);
            background: rgba(34, 139, 34, 0.1);
        }

        .ingredient-category[data-theme="mixers"] .ingredient-tag.selected {
            background: linear-gradient(135deg, rgba(34, 139, 34, 0.2), rgba(50, 205, 50, 0.3));
            border-color: rgba(34, 139, 34, 0.6);
            color: rgba(25, 100, 25, 0.9);
            box-shadow: 0 0 8px rgba(34, 139, 34, 0.4);
            transform: translateY(-1px);
            animation: selectShake 0.5s ease-in-out;
        }

        /* 工具标签选中效果 - 蓝色系 */
        .ingredient-category[data-theme="tools"] .ingredient-tag:hover {
            border-color: rgba(70, 130, 180, 0.6);
            background: rgba(70, 130, 180, 0.1);
        }

        .ingredient-category[data-theme="tools"] .ingredient-tag.selected {
            background: linear-gradient(135deg, rgba(70, 130, 180, 0.2), rgba(100, 149, 237, 0.3));
            border-color: rgba(70, 130, 180, 0.6);
            color: rgba(45, 85, 120, 0.9);
            box-shadow: 0 0 8px rgba(70, 130, 180, 0.4);
            transform: translateY(-1px);
            animation: selectShake 0.5s ease-in-out;
        }

        /* 选中抖动动画 */
        @keyframes selectShake {
            0% { transform: translateY(-1px) translateX(0); }
            25% { transform: translateY(-1px) translateX(-2px); }
            50% { transform: translateY(-1px) translateX(2px); }
            75% { transform: translateY(-1px) translateX(-1px); }
            100% { transform: translateY(-1px) translateX(0); }
        }

        /* 偏好设置 */
        .preferences-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 2rem;
            margin: 2rem 0;
        }

        .preference-item {
            padding: 1.5rem;
            background: var(--bg-glass);
            border: 1px solid var(--border-glass);
            border-radius: 16px;
        }

        .preference-label {
            font-size: 1rem;
            font-weight: 500;
            margin-bottom: 1rem;
            color: var(--text-primary);
            text-align: center;
        }

        .slider-container {
            position: relative;
            margin: 1rem 0;
        }

        .slider {
            width: 100%;
            height: 6px;
            border-radius: 3px;
            background: var(--bg-secondary);
            outline: none;
            -webkit-appearance: none;
        }

        .slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: var(--primary-purple);
            cursor: pointer;
            box-shadow: 0 0 10px rgba(108, 92, 231, 0.5);
        }

        .slider::-moz-range-thumb {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: var(--primary-purple);
            cursor: pointer;
            border: none;
            box-shadow: 0 0 10px rgba(108, 92, 231, 0.5);
        }

        .slider-labels {
            display: flex;
            justify-content: space-between;
            margin-top: 0.5rem;
            font-size: 0.8rem;
            color: var(--text-muted);
        }

        /* 按钮样式 */
        .btn {
            padding: 1rem 2rem;
            border: none;
            border-radius: 50px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }

        .btn-primary {
            background: var(--primary-gradient);
            color: white;
            box-shadow: 0 4px 20px rgba(108, 92, 231, 0.4);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 30px rgba(108, 92, 231, 0.6);
        }

        .btn-secondary {
            background: var(--bg-glass);
            color: var(--text-primary);
            border: 1px solid var(--border-glass);
        }

        .btn-secondary:hover {
            background: var(--bg-glass-hover);
            border-color: var(--primary-purple);
        }

        .step-navigation {
            display: flex;
            justify-content: center;
            gap: 1rem;
            margin-top: 3rem;
        }

        /* 加载状态 */
        .loading-section {
            display: none;
            text-align: center;
            padding: 4rem 0;
        }

        .loading-animation {
            width: 80px;
            height: 80px;
            margin: 0 auto 2rem;
            border: 4px solid var(--border-glass);
            border-top: 4px solid var(--primary-purple);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .loading-title {
            font-size: 1.5rem;
            font-weight: 600;
            margin-bottom: 1rem;
        }

        .loading-subtitle {
            color: var(--text-secondary);
        }

        /* Shaker分析区域 */
        .shaker-analysis-section {
            display: none;
            padding: 5rem 0 6rem 0;
            background: linear-gradient(135deg, 
                var(--bg-primary) 0%, 
                rgba(248, 245, 240, 0.8) 30%,
                var(--bg-secondary) 70%, 
                rgba(232, 245, 232, 0.9) 100%);
            min-height: 70vh;
            position: relative;
        }

        .shaker-analysis-section::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: 
                radial-gradient(circle at 20% 30%, rgba(143, 188, 143, 0.05) 0%, transparent 50%),
                radial-gradient(circle at 80% 70%, rgba(34, 139, 34, 0.03) 0%, transparent 50%);
            pointer-events: none;
        }

        .shaker-analysis-container {
            max-width: 900px;
            margin: 0 auto;
            text-align: center;
            padding: 2rem;
            position: relative;
            z-index: 1;
        }

        .shaker-avatar {
            font-size: 4rem;
            margin-bottom: 1rem;
            animation: gentlePulse 2s ease-in-out infinite;
        }

        .shaker-analysis-text {
            font-size: 1.4rem;
            line-height: 1.8;
            color: var(--text-primary);
            margin: 2rem auto;
            max-width: 700px;
            min-height: 120px;
            padding: 3rem 2.5rem;
            background: linear-gradient(135deg, 
                rgba(255, 255, 255, 0.95) 0%, 
                rgba(248, 245, 240, 0.9) 50%, 
                rgba(232, 245, 232, 0.85) 100%);
            border-radius: 30px;
            border: 1px solid rgba(143, 188, 143, 0.2);
            backdrop-filter: blur(20px);
            box-shadow: 
                0 20px 60px rgba(34, 139, 34, 0.08),
                0 8px 25px rgba(0, 0, 0, 0.05),
                inset 0 1px 0 rgba(255, 255, 255, 0.8);
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            font-weight: 400;
            letter-spacing: 0.3px;
            text-align: center;
            position: relative;
            overflow: hidden;
            animation: gentleGlow 4s ease-in-out infinite;
            transition: all 0.3s ease;
        }

        .shaker-analysis-text:hover {
            transform: translateY(-2px);
            box-shadow: 
                0 25px 70px rgba(34, 139, 34, 0.12),
                0 10px 30px rgba(0, 0, 0, 0.08),
                inset 0 1px 0 rgba(255, 255, 255, 0.9);
        }

        .shaker-analysis-text::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 1px;
            background: linear-gradient(90deg, 
                transparent 0%, 
                rgba(143, 188, 143, 0.3) 50%, 
                transparent 100%);
        }

        .shaker-analysis-text::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 1px;
            background: linear-gradient(90deg, 
                transparent 0%, 
                rgba(143, 188, 143, 0.2) 50%, 
                transparent 100%);
        }

        /* 分段分析样式 */
        .analysis-segments {
            max-width: 600px;
            margin: 0 auto;
            padding: 1rem 0;
        }

        .analysis-segment {
            background: linear-gradient(135deg, rgba(245, 245, 220, 0.9), rgba(143, 188, 143, 0.1));
            border: 2px solid rgba(143, 188, 143, 0.3);
            border-radius: 20px;
            padding: 1.5rem;
            margin-bottom: 1rem;
            backdrop-filter: blur(15px);
            box-shadow: 0 8px 32px rgba(34, 139, 34, 0.1);
            opacity: 0;
            transform: translateY(20px);
            transition: all 0.6s ease-out;
        }

        .analysis-segment.show {
            opacity: 1;
            transform: translateY(0);
        }

        .segment-header {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            margin-bottom: 0.75rem;
        }

        .segment-icon {
            font-size: 1.5rem;
            opacity: 0.8;
        }

        .segment-title {
            font-size: 1rem;
            font-weight: 600;
            color: var(--forest-green);
            margin: 0;
        }

        .segment-content {
            font-size: 1.1rem;
            line-height: 1.6;
            color: var(--text-secondary);
            margin: 0;
            padding-left: 2.25rem;
            font-family: 'Inter', serif;
            letter-spacing: 0.3px;
        }

        /* 本地分析标识 */
        .local-analysis-badge {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            background: var(--forest-green);
            color: white;
            padding: 0.25rem 0.75rem;
            border-radius: 12px;
            font-size: 0.8rem;
            font-weight: 500;
            margin-bottom: 1rem;
            opacity: 0.8;
        }

        .local-analysis-badge::before {
            content: "⚡";
            font-size: 0.9rem;
        }

        /* 高级回顾卡片样式 */
        .review-cards-container {
            max-width: 500px;
            margin: 2rem auto;
            padding: 0 1rem;
            position: relative;
            min-height: 200px;
        }

        .review-card {
            position: absolute;
            top: 0;
            left: 50%;
            transform: translateX(-50%) translateY(40px) scale(0.9);
            width: calc(100% - 2rem);
            max-width: 400px;
            background: linear-gradient(135deg, 
                rgba(255, 255, 255, 0.98) 0%, 
                rgba(248, 250, 252, 0.95) 100%);
            border: 2px solid transparent;
            border-radius: 20px;
            padding: 2rem;
            box-shadow: 
                0 20px 40px rgba(0,0,0,0.1),
                0 8px 16px rgba(143, 188, 143, 0.15),
                inset 0 1px 0 rgba(255,255,255,0.8);
            opacity: 0;
            transition: all 0.8s cubic-bezier(0.4, 0.0, 0.2, 1);
            backdrop-filter: blur(10px);
        }

        .review-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            border-radius: 20px;
            background: linear-gradient(135deg, 
                rgba(143, 188, 143, 0.1) 0%, 
                rgba(34, 139, 34, 0.05) 100%);
            z-index: -1;
        }

        .review-card.show {
            transform: translateX(-50%) translateY(0) scale(1);
            opacity: 1;
        }

        .review-card.slide-out {
            transform: translateX(-150%) translateY(-20px) scale(0.95) rotateZ(-5deg);
            opacity: 0;
            transition: all 0.6s cubic-bezier(0.6, 0.0, 0.4, 1);
        }

        .review-card-header {
            display: flex;
            align-items: center;
            margin-bottom: 1.25rem;
            position: relative;
        }

        .review-card-icon {
            font-size: 2.5rem;
            margin-right: 1rem;
            filter: drop-shadow(0 4px 8px rgba(0,0,0,0.15));
            animation: warmIconBreath 4s ease-in-out infinite;
            transition: all 0.3s ease;
        }

        .review-card-icon:hover {
            transform: scale(1.1);
            filter: drop-shadow(0 6px 12px rgba(143, 188, 143, 0.3));
        }

        @keyframes warmIconBreath {
            0%, 100% { 
                transform: translateY(0px) scale(1);
                opacity: 0.9;
            }
            50% { 
                transform: translateY(-2px) scale(1.02);
                opacity: 1;
            }
        }

        .review-card-title {
            font-size: 1.2rem;
            font-weight: 700;
            color: var(--forest-green);
            margin: 0;
            letter-spacing: 0.5px;
            text-shadow: 0 1px 2px rgba(0,0,0,0.1);
        }

        .review-card-content {
            font-size: 1.15rem;
            color: var(--text-dark);
            line-height: 1.6;
            margin: 0;
            font-weight: 500;
            text-align: center;
            position: relative;
        }

        .review-card-content.empty {
            color: #8B7355;
            font-style: italic;
            opacity: 0.9;
        }

        .review-card-content::after {
            content: '';
            position: absolute;
            bottom: -10px;
            left: 50%;
            transform: translateX(-50%);
            width: 40px;
            height: 2px;
            background: linear-gradient(90deg, 
                transparent 0%, 
                var(--accent-gold) 50%, 
                transparent 100%);
            opacity: 0.6;
        }

        /* 打字机效果 */
        .review-card-content.typing {
            overflow: hidden;
            white-space: nowrap;
            border-right: 2px solid var(--forest-green);
            animation: typing 1.5s steps(40, end), blink-caret 0.75s step-end infinite;
        }

        .review-card-content.typing.multiline {
            white-space: normal;
            border-right: none;
        }

        .review-card-content .typing-line {
            display: block;
            overflow: hidden;
            white-space: nowrap;
            opacity: 0;
        }

        .review-card-content .typing-line.active {
            opacity: 1;
            border-right: 2px solid var(--forest-green);
            animation: typing 1.2s steps(30, end), blink-caret 0.75s step-end infinite;
        }

        .review-card-content .typing-line.completed {
            opacity: 1;
            border-right: none;
        }

        @keyframes typing {
            from { width: 0; }
            to { width: 100%; }
        }

        @keyframes blink-caret {
            from, to { border-color: transparent; }
            50% { border-color: var(--forest-green); }
        }

        /* 温暖的标题显示效果 */
        .review-card-title.warm-reveal {
            opacity: 0;
            transform: translateY(10px);
            animation: warmReveal 1.2s ease-out forwards;
        }

        @keyframes warmReveal {
            0% {
                opacity: 0;
                transform: translateY(10px);
                filter: blur(2px);
            }
            60% {
                opacity: 0.7;
                transform: translateY(-2px);
                filter: blur(0px);
            }
            100% {
                opacity: 1;
                transform: translateY(0);
                filter: blur(0px);
            }
        }

        /* 真正的打字机效果 */
        .review-card-content.real-typing {
            position: relative;
            overflow: hidden;
        }

        .review-card-content .typing-text {
            display: inline;
            opacity: 0;
        }

        .review-card-content .typing-text.visible {
            opacity: 1;
            animation: charGlow 0.3s ease-out;
        }

        .review-card-content .typing-cursor {
            display: inline-block;
            width: 2px;
            height: 1.2em;
            background: linear-gradient(45deg, var(--forest-green), var(--accent-gold));
            margin-left: 2px;
            animation: cursorBlink 1s infinite, cursorGlow 2s ease-in-out infinite alternate;
            box-shadow: 0 0 8px rgba(143, 188, 143, 0.6);
        }

        @keyframes charGlow {
            0% {
                text-shadow: 0 0 5px rgba(143, 188, 143, 0.8);
                transform: scale(1.05);
            }
            100% {
                text-shadow: 0 0 2px rgba(143, 188, 143, 0.3);
                transform: scale(1);
            }
        }

        @keyframes cursorBlink {
            0%, 50% { opacity: 1; }
            51%, 100% { opacity: 0.3; }
        }

        @keyframes cursorGlow {
            0% {
                box-shadow: 0 0 8px rgba(143, 188, 143, 0.6);
                background: linear-gradient(45deg, var(--forest-green), var(--accent-gold));
            }
            100% {
                box-shadow: 0 0 15px rgba(143, 188, 143, 0.9), 0 0 25px rgba(218, 165, 32, 0.5);
                background: linear-gradient(45deg, #4CAF50, #FFD700);
            }
        }

        /* 温暖的内容容器 */
        .review-card-content.typing-container {
            min-height: 1.5em;
            line-height: 1.6;
        }

        /* 选择摘要区域样式 */
        .choices-summary {
            margin-bottom: 2rem;
            padding: 1.5rem;
            background: rgba(255, 255, 255, 0.7);
            border-radius: 16px;
            border: 1px solid rgba(143, 188, 143, 0.2);
            backdrop-filter: blur(10px);
            opacity: 0;
            transform: translateY(-20px);
            transition: all 0.6s ease-out;
        }

        .choices-summary.show {
            opacity: 1;
            transform: translateY(0);
        }

        .summary-title {
            font-size: 1rem;
            font-weight: 600;
            color: var(--forest-green);
            margin-bottom: 1rem;
            text-align: center;
            opacity: 0.8;
        }

        .summary-cards {
            display: flex;
            flex-wrap: wrap;
            gap: 0.75rem;
            justify-content: center;
            align-items: center;
        }

        /* 摘要卡片样式 */
        .summary-card {
            display: inline-flex;
            align-items: center;
            padding: 0.5rem 1rem;
            background: rgba(143, 188, 143, 0.1);
            border: 1px solid rgba(143, 188, 143, 0.3);
            border-radius: 20px;
            font-size: 0.9rem;
            color: var(--text-dark);
            transition: all 0.3s ease;
            cursor: default;
            position: relative;
            overflow: hidden;
        }

        .summary-card:hover {
            background: rgba(143, 188, 143, 0.2);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(143, 188, 143, 0.2);
        }

        .summary-card-icon {
            font-size: 1rem;
            margin-right: 0.5rem;
            opacity: 0.8;
        }

        .summary-card-content {
            font-weight: 500;
            max-width: 200px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        /* 飘移动画 */
        .review-card.floating {
            position: fixed;
            z-index: 1000;
            pointer-events: none;
            transition: all 1.5s cubic-bezier(0.25, 0.46, 0.45, 0.94);
        }

        /* 向上飘移的特殊动画 */
        .review-card.floating-up {
            animation: floatUp 1.5s cubic-bezier(0.25, 0.46, 0.45, 0.94) forwards;
        }

        @keyframes floatUp {
            0% {
                transform: translateX(-50%) translateY(0) scale(1);
                opacity: 1;
            }
            30% {
                transform: translateX(-50%) translateY(-20px) scale(0.9);
                opacity: 0.9;
            }
            70% {
                transform: translateX(-50%) translateY(-60px) scale(0.5);
                opacity: 0.7;
            }
            100% {
                transform: translateX(-50%) translateY(-100px) scale(0.3);
                opacity: 0.3;
            }
        }

        .review-card.floating.arrived {
            opacity: 0;
            transform: scale(0.8);
        }

        /* Shaker思考区域样式 */
        .shaker-thinking-area {
            position: relative;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 380px; /* 更紧凑的高度 */
            margin-bottom: 1.5rem;
            padding: 1.5rem 1rem; /* 更紧凑的内边距 */
        }

        .shaker-avatar-large {
            font-size: 4rem;
            filter: drop-shadow(0 4px 12px rgba(0,0,0,0.15));
            animation: shakerBreath 3s ease-in-out infinite;
            z-index: 1;
        }

        @keyframes shakerBreath {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        /* 思考泡泡容器 */
        .thought-bubbles-container {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            pointer-events: none;
        }

        /* 思考泡泡样式 - 森林主题 */
        .thought-bubble {
            position: absolute;
            background: linear-gradient(135deg, rgba(248, 255, 248, 0.98), rgba(255, 255, 255, 0.95));
            border: 2px solid rgba(143, 188, 143, 0.6);
            border-radius: 20px;
            padding: 1rem 1.4rem;
            box-shadow: 
                0 8px 32px rgba(143, 188, 143, 0.15),
                0 4px 16px rgba(34, 139, 34, 0.1),
                inset 0 1px 0 rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(15px);
            max-width: 220px;
            opacity: 0;
            transform: scale(0.6) translateY(30px);
            transition: all 1.2s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            z-index: 10;
            animation: gentleFloat 4s ease-in-out infinite;
        }

        .thought-bubble.show {
            opacity: 1;
            transform: scale(1) translateY(0);
            animation: gentleFloat 4s ease-in-out infinite, forestGlow 3s ease-in-out infinite;
        }

        .thought-bubble.hide {
            opacity: 0;
            transform: scale(0.8) translateY(-20px);
            transition: all 1s ease-in;
            animation: none;
        }

        /* 轻柔的浮动动画 */
        @keyframes gentleFloat {
            0%, 100% { 
                transform: translateY(0px);
            }
            25% { 
                transform: translateY(-3px);
            }
            50% { 
                transform: translateY(-6px);
            }
            75% { 
                transform: translateY(-3px);
            }
        }

        /* 森林主题发光效果 */
        @keyframes forestGlow {
            0%, 100% { 
                box-shadow: 
                    0 8px 32px rgba(143, 188, 143, 0.15),
                    0 4px 16px rgba(34, 139, 34, 0.1),
                    inset 0 1px 0 rgba(255, 255, 255, 0.8);
            }
            50% { 
                box-shadow: 
                    0 12px 40px rgba(143, 188, 143, 0.25),
                    0 6px 20px rgba(34, 139, 34, 0.15),
                    inset 0 1px 0 rgba(255, 255, 255, 0.9);
            }
        }

        /* 光标闪烁动画 */
        @keyframes cursorBlink {
            0%, 50% { opacity: 1; }
            51%, 100% { opacity: 0; }
        }



        /* 泡泡内容 */
        .thought-bubble-header {
            display: flex;
            align-items: center;
            margin-bottom: 0.8rem;
        }

        .thought-bubble-icon {
            font-size: 1.4rem;
            margin-right: 0.8rem;
            animation: iconPulse 2s ease-in-out infinite;
        }

        @keyframes iconPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        .thought-bubble-title {
            font-size: 1rem;
            font-weight: 700;
            color: var(--forest-green);
            margin: 0;
            text-shadow: 0 1px 2px rgba(255, 255, 255, 0.8);
        }

        .thought-bubble-content {
            font-size: 1rem;
            color: var(--forest-green);
            line-height: 1.5;
            margin: 0;
            font-weight: 500;
            text-shadow: 0 1px 1px rgba(255, 255, 255, 0.6);
        }

        .thought-bubble-content.empty {
            color: var(--forest-green);
            font-style: italic;
            opacity: 0.7;
        }

        /* 自适应泡泡布局 - 根据屏幕大小动态调整 */
        .thought-bubble {
            /* 移除固定位置，改用动态计算 */
        }

        /* 大屏幕布局 (>1200px) */
        @media (min-width: 1200px) {
            .thought-bubble.position-top-right {
                top: 20px;
                right: 5%;
            }
            .thought-bubble.position-top-left {
                top: 20px;
                left: 5%;
            }
            .thought-bubble.position-right {
                top: 35%;
                right: 2%;
                transform: translateY(-50%) scale(0.8) translateY(20px);
            }
            .thought-bubble.position-left {
                top: 35%;
                left: 2%;
                transform: translateY(-50%) scale(0.8) translateY(20px);
            }
            .thought-bubble.position-bottom {
                bottom: 30px;
                left: 50%;
                transform: translateX(-50%) scale(0.8) translateY(20px);
            }
        }

        /* 中等屏幕布局 (768px - 1200px) */
        @media (min-width: 768px) and (max-width: 1199px) {
            .thought-bubble.position-top-right {
                top: 25px;
                right: 3%;
            }
            .thought-bubble.position-top-left {
                top: 25px;
                left: 3%;
            }
            .thought-bubble.position-right {
                top: 40%;
                right: 1%;
                transform: translateY(-50%) scale(0.8) translateY(20px);
            }
            .thought-bubble.position-left {
                top: 40%;
                left: 1%;
                transform: translateY(-50%) scale(0.8) translateY(20px);
            }
            .thought-bubble.position-bottom {
                bottom: 35px;
                left: 50%;
                transform: translateX(-50%) scale(0.8) translateY(20px);
            }
        }

        /* 小屏幕布局 (<=768px) - 垂直堆叠 */
        @media (max-width: 767px) {
            .thought-bubble {
                position: relative !important;
                top: auto !important;
                left: auto !important;
                right: auto !important;
                bottom: auto !important;
                transform: none !important;
                margin: 0.8rem auto;
                display: block;
                max-width: 90%;
            }
            
            .thought-bubbles-container {
                position: relative !important;
                display: flex;
                flex-direction: column;
                align-items: center;
                gap: 0.8rem;
            }
        }

        /* 通用的显示状态 */
        .thought-bubble.position-right.show {
            transform: translateY(-50%) scale(1) translateY(0);
        }

        .thought-bubble.position-left.show {
            transform: translateY(-50%) scale(1) translateY(0);
        }

        .thought-bubble.position-bottom.show {
            transform: translateX(-50%) scale(1) translateY(0);
        }

        /* 移动端显示状态 */
        @media (max-width: 767px) {
            .thought-bubble.show {
                transform: none !important;
                opacity: 1;
            }
        }

        /* 响应式思考区域设计 */
        @media (min-width: 1200px) {
            .shaker-thinking-area {
                min-height: 400px;
                padding: 2rem;
            }
        }

        @media (min-width: 768px) and (max-width: 1199px) {
            .shaker-thinking-area {
                min-height: 380px;
                padding: 1.5rem;
            }
        }

        @media (max-width: 767px) {
            .shaker-thinking-area {
                min-height: auto; /* 自动高度 */
                padding: 1rem;
                flex-direction: column;
            }
            
            .shaker-avatar-large {
                font-size: 3rem;
                margin-bottom: 1rem;
            }
            
            .thought-bubble {
                max-width: 90%;
                padding: 0.8rem 1.2rem;
                font-size: 0.9rem;
            }
        }

        /* 卡片进入动画序列 */
        .review-card.entering {
            animation: cardEnter 0.8s cubic-bezier(0.4, 0.0, 0.2, 1) forwards;
        }

        @keyframes cardEnter {
            0% {
                transform: translateX(-50%) translateY(60px) scale(0.8);
                opacity: 0;
                filter: blur(4px);
            }
            60% {
                transform: translateX(-50%) translateY(-5px) scale(1.02);
                opacity: 0.8;
                filter: blur(0px);
            }
            100% {
                transform: translateX(-50%) translateY(0) scale(1);
                opacity: 1;
                filter: blur(0px);
            }
        }

        /* 卡片离开动画序列 */
        .review-card.leaving {
            animation: cardLeave 0.6s cubic-bezier(0.6, 0.0, 0.4, 1) forwards;
        }

        @keyframes cardLeave {
            0% {
                transform: translateX(-50%) translateY(0) scale(1);
                opacity: 1;
            }
            100% {
                transform: translateX(-150%) translateY(-30px) scale(0.9) rotateZ(-8deg);
                opacity: 0;
                filter: blur(2px);
            }
        }

        /* 响应式设计 */
        @media (max-width: 768px) {
            .review-cards-container {
                padding: 0 0.5rem;
                max-width: 350px;
            }
            
            .review-card {
                padding: 1.75rem;
                max-width: 320px;
            }
            
            .review-card-icon {
                font-size: 2rem;
            }
            
            .review-card-title {
                font-size: 1.1rem;
            }
            
            .review-card-content {
                font-size: 1rem;
            }
        }

        .typing-cursor {
            display: inline-block;
            width: 2px;
            height: 1.2em;
            background: var(--forest-green);
            animation: blink 1s infinite;
            margin-left: 2px;
        }

        @keyframes gentlePulse {
            0%, 100% { transform: scale(1); opacity: 0.8; }
            50% { transform: scale(1.05); opacity: 1; }
        }

        @keyframes blink {
            0%, 50% { opacity: 1; }
            51%, 100% { opacity: 0; }
        }

        /* 调制动画区域 - 修复内容显示 */
        .cocktail-making-section {
            display: none;
            padding: 2rem 0 6rem 0;
            background: var(--bg-primary);
            min-height: auto;
            overflow: visible;
            /* 移除垂直居中，让内容自然流动 */
            flex-direction: column;
        }
        
        .cocktail-making-section.visible {
            display: flex;
        }

        .making-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 1.5rem;
            margin-top: 2rem;
            min-height: auto;
            overflow: visible;
            width: 100%;
            max-width: 1200px;
            margin-left: auto;
            margin-right: auto;
            /* 移除高度限制，让内容自然显示 */
            height: auto;
        }

        .cocktail-making-card {
            position: relative;
            background: linear-gradient(135deg, rgba(245, 245, 220, 0.8), rgba(143, 188, 143, 0.2));
            border-radius: 25px;
            padding: 1.5rem;
            border: 2px solid rgba(143, 188, 143, 0.4);
            backdrop-filter: blur(15px);
            min-height: 460px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-start;
            overflow: visible;
            box-shadow: 0 12px 40px rgba(34, 139, 34, 0.15);
            transition: all 0.3s ease;
        }
        
        .cocktail-making-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 60px rgba(34, 139, 34, 0.25);
        }

        .cocktail-making-card.making {
            background: linear-gradient(135deg, rgba(34, 139, 34, 0.1), rgba(143, 188, 143, 0.2));
        }

        /* 调酒杯动画 */
        .cocktail-glass {
            font-size: 4rem;
            margin-bottom: 1rem;
            transition: all 0.3s ease;
        }

        .cocktail-glass.making {
            animation: elegantShake 1.2s ease-in-out infinite, 
                       glowPulse 2s ease-in-out infinite;
        }

        @keyframes elegantShake {
            0%, 100% { 
                transform: translateY(0) rotate(0deg) scale(1);
            }
            25% { 
                transform: translateY(-8px) rotate(-3deg) scale(1.05);
            }
            50% { 
                transform: translateY(-4px) rotate(0deg) scale(1.1);
            }
            75% { 
                transform: translateY(-8px) rotate(3deg) scale(1.05);
            }
        }

        @keyframes glowPulse {
            0%, 100% { 
                filter: drop-shadow(0 0 10px rgba(76, 175, 80, 0.3));
                transform: scale(1);
            }
            50% { 
                filter: drop-shadow(0 0 20px rgba(76, 175, 80, 0.6));
                transform: scale(1.05);
            }
        }

        @keyframes enhancedFall {
            0% {
                top: -20px;
                opacity: 0;
                transform: scale(0.5);
            }
            20% {
                opacity: 1;
                transform: scale(1);
            }
            80% {
                top: 80%;
                opacity: 1;
            }
            100% {
                top: 100%;
                opacity: 0;
                transform: scale(0.8);
            }
        }

        @keyframes rotate360 {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        @keyframes sparkle {
            0%, 100% { 
                filter: brightness(1) drop-shadow(0 2px 4px rgba(0,0,0,0.2));
            }
            50% { 
                filter: brightness(1.3) drop-shadow(0 4px 8px rgba(76, 175, 80, 0.4));
            }
        }

        /* 食材下落动画 */
        .ingredients-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            overflow: hidden;
        }

        .falling-ingredient {
            position: absolute;
            font-size: 1.5rem;
            animation: fallAndRotate 2s ease-in forwards;
        }

        @keyframes fallAndRotate {
            0% {
                top: -50px;
                opacity: 1;
                transform: rotate(0deg);
            }
            100% {
                top: 60%;
                opacity: 0.8;
                transform: rotate(360deg);
            }
        }

        /* 进度条 */
        .making-progress {
            width: 100%;
            height: 8px;
            background: rgba(143, 188, 143, 0.3);
            border-radius: 4px;
            margin: 1rem 0;
            overflow: hidden;
        }

        .making-progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--forest-green), var(--leaf-green));
            border-radius: 4px;
            width: 0%;
            transition: width 0.3s ease;
            box-shadow: 0 0 10px rgba(34, 139, 34, 0.5);
        }

        .making-status {
            font-size: 1rem;
            color: var(--text-secondary);
            margin-bottom: 1rem;
        }

        /* 发光效果 */
        .cocktail-making-card.glowing {
            box-shadow: 0 0 30px rgba(34, 139, 34, 0.3);
            animation: gentleGlow 2s ease-in-out infinite;
        }

        @keyframes gentleGlow {
            0%, 100% { box-shadow: 0 0 20px rgba(34, 139, 34, 0.2); }
            50% { box-shadow: 0 0 40px rgba(34, 139, 34, 0.4); }
        }

        /* 推荐内容显示 */
        .recommendation-content {
            display: none;
            text-align: left;
            width: 100%;
        }

        .recommendation-content.visible {
            display: block;
            animation: fadeInUp 0.6s ease-out;
        }

        /* 简洁推荐卡片样式 - 修复内容截断问题 */
        .simple-cocktail-card {
            background: white;
            border-radius: 16px;
            padding: 20px;
            border: 1px solid #e5e7eb;
            /* 增加最小高度，确保内容完整显示 */
            min-height: 450px;
            max-height: calc((100vh - 200px) / 1.1);
            height: auto;
            display: flex;
            flex-direction: column;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
            cursor: pointer;
            position: relative;
            /* 允许内容滚动而不是截断 */
            overflow: visible;
        }
        
        .simple-cocktail-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }

        /* 制作进度区域 */
        .making-progress-section {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100%;
            text-align: center;
        }

        .making-progress-section .cocktail-glass-icon {
            font-size: 3rem;
            margin-bottom: 1rem;
        }

        .making-status-text {
            font-size: 1rem;
            color: #6b7280;
            margin-bottom: 1rem;
        }

        .simple-progress-bar {
            width: 80%;
            height: 6px;
            background: #f3f4f6;
            border-radius: 3px;
            overflow: hidden;
        }

        .simple-progress-bar .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #10b981, #34d399);
            border-radius: 3px;
            width: 0%;
            transition: width 0.3s ease;
        }

        /* 推荐内容区域 */
        .recommendation-content-area {
            display: flex;
            flex-direction: column;
            height: 100%;
        }

        .alcohol-badge {
            position: absolute;
            top: 12px;
            right: 12px;
            background: #10b981;
            color: white;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 500;
        }

        .cocktail-glass-large {
            font-size: 4rem;
            text-align: center;
            margin: 1rem 0;
        }

        .cocktail-name-cn {
            font-size: 1.5rem;
            font-weight: 600;
            color: #1f2937;
            margin: 0.5rem 0 0.25rem 0;
            text-align: center;
        }

        .cocktail-name-en {
            font-size: 1rem;
            color: #9ca3af;
            font-style: italic;
            margin: 0 0 1rem 0;
            text-align: center;
        }

        .reason-section, .ingredients-section, .taste-section {
            margin: 0.75rem 0;
            display: flex;
            flex-wrap: wrap;
            align-items: flex-start;
        }

        .reason-icon, .ingredients-icon, .taste-icon {
            margin-right: 0.5rem;
            font-size: 0.875rem;
        }

        .reason-label, .ingredients-label, .taste-label {
            font-weight: 500;
            color: #374151;
            margin-right: 0.5rem;
            font-size: 0.875rem;
        }

        .recommendation-reason, .taste-profile {
            flex: 1;
            color: #6b7280;
            font-size: 0.875rem;
            line-height: 1.4;
        }

        .ingredients-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            flex: 1;
        }

        .recommendation-content-area .ingredient-tag {
            background: #f3f4f6;
            color: #374151;
            padding: 2px 8px;
            border-radius: 8px;
            font-size: 0.75rem;
            border: none;
        }

        .cocktail-info {
            display: flex;
            justify-content: space-between;
            margin: 1rem 0;
            padding: 0.75rem 0;
            border-top: 1px solid #f3f4f6;
        }

        .info-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
        }

        .info-icon {
            font-size: 1.25rem;
            margin-bottom: 0.25rem;
        }

        .info-label {
            font-size: 0.75rem;
            color: #9ca3af;
            margin-bottom: 0.25rem;
        }

        .info-value {
            font-size: 0.875rem;
            font-weight: 500;
            color: #374151;
        }

        .view-details-btn {
            background: #10b981;
            color: white;
            border: none;
            border-radius: 8px;
            padding: 0.75rem 1.5rem;
            font-size: 0.875rem;
            font-weight: 500;
            cursor: pointer;
            transition: background-color 0.2s;
            margin-top: auto;
        }

        .view-details-btn:hover {
            background: #059669;
        }

        /* 卡片头部 */
        .card-header {
            position: relative;
            padding: 2.5rem 2rem 1.5rem;
            text-align: center;
            background: linear-gradient(135deg, 
                rgba(251, 191, 36, 0.08), 
                rgba(252, 211, 77, 0.05),
                rgba(254, 240, 138, 0.03)
            );
            border-bottom: 1px solid rgba(251, 191, 36, 0.1);
        }

        .cocktail-glass-container {
            position: relative;
            display: inline-block;
            margin-bottom: 0.5rem;
        }

        .cocktail-glass-icon {
            font-size: 4rem;
            display: block;
            transition: all 0.4s ease;
            filter: drop-shadow(0 6px 12px rgba(251, 146, 60, 0.2));
            animation: gentle-float 3s ease-in-out infinite;
        }
        
        @keyframes gentle-float {
            0%, 100% { transform: translateY(0) rotate(0deg); }
            50% { transform: translateY(-8px) rotate(2deg); }
        }

        /* 调酒动效 */
        .making-animation {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            pointer-events: none;
        }

        .making-animation.shake::before {
            content: '🥄';
            font-size: 1.5rem;
            animation: stirring 1.5s ease-in-out infinite;
        }

        .making-animation.stir::before {
            content: '🌪️';
            font-size: 1.2rem;
            animation: swirling 2s linear infinite;
        }

        .making-animation.garnish::before {
            content: '🍋';
            font-size: 1rem;
            animation: garnishing 1.8s ease-in-out infinite;
        }

        @keyframes stirring {
            0%, 100% { transform: rotate(0deg) scale(1); opacity: 0.7; }
            50% { transform: rotate(180deg) scale(1.2); opacity: 1; }
        }

        @keyframes swirling {
            0% { transform: rotate(0deg) scale(0.8); opacity: 0.6; }
            100% { transform: rotate(360deg) scale(0.8); opacity: 0.6; }
        }

        @keyframes garnishing {
            0%, 100% { transform: translateY(0) rotate(0deg); opacity: 0.8; }
            50% { transform: translateY(-10px) rotate(180deg); opacity: 1; }
        }

        /* 制作进度区域 */
        .making-progress-section {
            padding: 0 2rem 1.5rem;
            text-align: center;
        }

        .making-status-text {
            font-size: 0.9rem;
            color: #64748b;
            margin-bottom: 0.75rem;
            font-weight: 500;
        }

        .modern-progress-bar {
            width: 100%;
            height: 6px;
            background: rgba(226, 232, 240, 0.8);
            border-radius: 3px;
            overflow: hidden;
            position: relative;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #22c55e, #16a34a);
            border-radius: 3px;
            width: 0%;
            transition: width 0.3s ease;
            position: relative;
        }

        .progress-fill::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.4), transparent);
            animation: shimmer 2s infinite;
        }

        @keyframes shimmer {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }

        /* 酒精度标签 */
        .alcohol-badge {
            position: absolute;
            top: 1rem;
            right: 1rem;
            background: linear-gradient(135deg, rgba(34, 197, 94, 0.9), rgba(16, 185, 129, 0.8));
            color: white;
            padding: 0.4rem 0.8rem;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 600;
            box-shadow: 0 2px 8px rgba(34, 197, 94, 0.3);
        }

        /* 推荐内容区域 - 森林温暖风格 */
        .recommendation-content-area {
            flex: 1;
            padding: 1rem;
            display: flex;
            flex-direction: column;
            gap: 0.6rem;
            overflow: visible;
            position: relative;
            /* 确保内容完整显示 */
            min-height: 350px;
            height: auto;
            box-sizing: border-box;
            background: linear-gradient(135deg, rgba(245, 245, 220, 0.3), rgba(143, 188, 143, 0.1));
            border-radius: 12px;
        }
        
        /* 移除右上角酒精度标签，改为底部显示 */
        .alcohol-badge {
            display: none; /* 隐藏原来的右上角标签 */
            box-shadow: 0 2px 6px rgba(34, 197, 94, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        /* 鸡尾酒名称区域 */
        .cocktail-header {
            margin-bottom: 0.6rem;
            /* 移除右边距，不再需要为酒精度标签预留空间 */
        }
        
        .cocktail-name-cn {
            font-size: 1.5rem;
            font-weight: 600;
            color: #1f2937;
            margin: 0 0 0.3rem 0;
            line-height: 1.3;
        }
        
        .cocktail-name-en {
            font-size: 1rem;
            color: #a16207;
            margin: 0;
            font-style: italic;
            line-height: 1.2;
            font-weight: 400;
        }
        
        /* 信息区域通用样式 */
        .info-section {
            margin-bottom: 0.5rem;
        }
        
        .info-label {
            display: flex;
            align-items: center;
            font-size: 0.9rem;
            font-weight: 500;
            color: #4b5563;
            margin-bottom: 0.4rem;
        }
        
        .info-icon {
            font-size: 0.85rem;
            margin-right: 0.4rem;
        }
        
        .info-content {
            font-size: 0.9rem;
            color: #6b7280;
            line-height: 1.5;
            margin: 0;
        }
        
        /* 材料列表 */
        .ingredients-list {
            display: flex;
            flex-wrap: wrap;
            gap: 0.4rem;
        }
        
        .ingredients-list .ingredient-tag {
            background: #dcfce7;
            color: #166534;
            padding: 0.3rem 0.6rem;
            border-radius: 6px;
            font-size: 0.8rem;
            font-weight: 500;
        }
        
        /* 顶部区域布局 - 居中显示 */
        .cocktail-header {
            text-align: center;
            margin-bottom: 1rem;
        }
        
        .cocktail-header .cocktail-name-cn {
            margin-bottom: 0.3rem;
        }
        
        .cocktail-header .cocktail-name-en {
            margin: 0;
        }
        
        /* 酒精度标签样式 */
        .alcohol-tag {
            display: flex;
            align-items: center;
            gap: 6px;
            background: rgba(34, 197, 94, 0.1);
            border: 1px solid rgba(34, 197, 94, 0.3);
            border-radius: 20px;
            padding: 6px 12px;
            font-size: 0.85rem;
            color: #16a34a;
            white-space: nowrap;
        }
        
        .alcohol-tag .bubble-icon {
            font-size: 1rem;
        }
        
        /* 底部信息 - 单行布局 */
        .bottom-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin: 1.5rem 0 1rem 0;
            padding: 0;
        }
        
        /* 左侧：时间和难度 */
        .bottom-left {
            display: flex;
            align-items: center;
            gap: 20px;
        }
        
        /* 右侧：详情按钮 */
        .bottom-right {
            display: flex;
            align-items: center;
        }
        
        .time-info,
        .difficulty-info,
        .alcohol-info {
            display: flex;
            align-items: center;
            gap: 0.4rem;
        }
        
        .time-info .info-icon,
        .difficulty-info .info-icon,
        .alcohol-info .info-icon {
            font-size: 1rem;
            color: #ef4444;
        }
        
        .alcohol-info .info-icon {
            color: #22c55e; /* 酒精度用绿色图标 */
        }
        
        .bubble-icon {
            font-size: 1.1rem;
            color: #22c55e;
        }
        
        .time-info .info-value,
        .difficulty-info .info-value,
        .alcohol-info .info-value {
            font-size: 0.9rem;
            color: #374151;
            font-weight: 500;
            display: inline !important;
            visibility: visible !important;
            opacity: 1 !important;
        }
        
        .time-info .info-label,
        .difficulty-info .info-label,
        .alcohol-info .info-label {
            display: none;
        }
        
        /* 查看详情按钮 */
        .details-btn {
            background: #22c55e;
            color: white;
            border: none;
            padding: 0.4rem 0.8rem;
            border-radius: 6px;
            font-size: 0.75rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
            width: auto;
            min-width: 60px;
            box-shadow: 0 1px 3px rgba(34, 197, 94, 0.3);
        }
        
        .details-btn:hover {
            background: #16a34a;
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(34, 197, 94, 0.3);
        }

        /* 详情弹窗样式 */
        .cocktail-details-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }
        
        .cocktail-details-modal.show {
            opacity: 1;
            visibility: visible;
        }
        
        .modal-backdrop {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(4px);
        }
        
        .modal-content {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(0.9);
            background: white;
            border-radius: 16px;
            max-width: 500px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.15);
            transition: transform 0.3s ease;
        }
        
        .cocktail-details-modal.show .modal-content {
            transform: translate(-50%, -50%) scale(1);
        }
        
        /* 基本信息卡片网格 */
        .info-cards-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 1rem;
            margin-top: 1rem;
        }
        
        .info-card {
            background: linear-gradient(135deg, rgba(34, 197, 94, 0.1), rgba(16, 185, 129, 0.05));
            border: 1px solid rgba(34, 197, 94, 0.2);
            border-radius: 12px;
            padding: 1rem;
            display: flex;
            align-items: center;
            gap: 0.75rem;
            transition: all 0.3s ease;
        }
        
        .info-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(34, 197, 94, 0.15);
        }
        
        .info-card .info-icon {
            font-size: 1.5rem;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(34, 197, 94, 0.1);
            border-radius: 8px;
        }
        
        .info-card .info-content {
            flex: 1;
        }
        
        .info-card .info-label {
            font-size: 0.8rem;
            color: #6b7280;
            margin-bottom: 0.25rem;
        }
        
        .info-card .info-value {
            font-size: 1rem;
            font-weight: 600;
            color: #1f2937;
        }
        
        /* 制作方法样式 */
        .instructions-list {
            margin-top: 1rem;
        }
        
        .instruction-step {
            display: flex;
            align-items: flex-start;
            gap: 1rem;
            margin-bottom: 1rem;
            padding: 1rem;
            background: linear-gradient(135deg, rgba(245, 245, 220, 0.3), rgba(143, 188, 143, 0.1));
            border-radius: 12px;
            border-left: 4px solid #22c55e;
        }
        
        .step-number {
            width: 28px;
            height: 28px;
            background: #22c55e;
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            font-size: 0.9rem;
            flex-shrink: 0;
        }
        
        .step-text {
            flex: 1;
            line-height: 1.6;
            color: #374151;
        }
        
        /* 响应式调整 */
        @media (max-width: 768px) {
            .info-cards-grid {
                grid-template-columns: 1fr;
                gap: 0.75rem;
            }
            
            .info-card {
                padding: 0.75rem;
            }
            
            .instruction-step {
                padding: 0.75rem;
                gap: 0.75rem;
            }
        }
        
        .modal-header {
            padding: 1.5rem;
            border-bottom: 1px solid #e5e7eb;
            position: relative;
        }
        
        .modal-header h2 {
            margin: 0 0 0.5rem 0;
            color: #1f2937;
            font-size: 1.5rem;
            font-weight: 600;
        }
        
        .modal-header .english-name {
            margin: 0;
            color: #a16207;
            font-style: italic;
            font-size: 1rem;
        }
        
        .close-btn {
            position: absolute;
            top: 1rem;
            right: 1rem;
            background: none;
            border: none;
            font-size: 1.5rem;
            color: #6b7280;
            cursor: pointer;
            width: 2rem;
            height: 2rem;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
        }
        
        .close-btn:hover {
            background: #f3f4f6;
            color: #374151;
        }
        
        .modal-body {
            padding: 1.5rem;
        }
        
        .detail-section {
            margin-bottom: 1.5rem;
        }
        
        .detail-section:last-child {
            margin-bottom: 0;
        }
        
        .detail-section h3 {
            margin: 0 0 0.75rem 0;
            color: #374151;
            font-size: 1.1rem;
            font-weight: 600;
        }
        
        .detail-section p {
            margin: 0;
            color: #6b7280;
            line-height: 1.6;
        }
        
        .info-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 0.5rem;
        }
        
        .info-grid .info-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.5rem 0;
        }
        
        .info-grid .label {
            color: #6b7280;
            font-size: 0.9rem;
        }
        
        .info-grid .value {
            color: #374151;
            font-weight: 500;
        }
        
        .ingredients-detail {
            display: grid;
            grid-template-columns: 1fr;
            gap: 0.5rem;
        }
        
        .ingredient-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.5rem 0.75rem;
            background: #f9fafb;
            border-radius: 8px;
            border-left: 3px solid #22c55e;
        }
        
        .ingredient-name {
            color: #374151;
            font-weight: 500;
        }
        
        .ingredient-amount {
            color: #6b7280;
            font-size: 0.9rem;
        }

        .cocktail-title-section {
            text-align: center;
            margin-bottom: 0.5rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid rgba(251, 191, 36, 0.15);
        }

        .cocktail-name-cn {
            font-size: 1.6rem;
            font-weight: 700;
            color: #92400e;
            margin: 0 0 0.4rem 0;
            line-height: 1.3;
            text-shadow: 0 1px 2px rgba(251, 146, 60, 0.1);
        }

        .cocktail-name-en {
            font-size: 1rem;
            color: #a16207;
            font-style: italic;
            margin: 0;
            font-weight: 500;
            opacity: 0.8;
        }

        /* 推荐理由区域 */
        .recommendation-reason-section {
            display: flex;
            align-items: flex-start;
            gap: 0.5rem;
            padding: 1rem;
            background: linear-gradient(135deg, 
                rgba(254, 240, 138, 0.3), 
                rgba(253, 230, 138, 0.2)
            );
            border-radius: 16px;
            border: 1px solid rgba(251, 191, 36, 0.2);
        }

        .reason-icon {
            font-size: 1.1rem;
            margin-top: 0.1rem;
        }

        .reason-label {
            font-size: 0.9rem;
            font-weight: 600;
            color: #92400e;
            white-space: nowrap;
            margin-top: 0.1rem;
        }

        .recommendation-reason {
            font-size: 0.9rem;
            color: #a16207;
            line-height: 1.5;
            flex: 1;
        }

        /* 材料区域 */
        .ingredients-section {
            display: flex;
            align-items: flex-start;
            gap: 0.5rem;
            padding: 1rem;
            background: linear-gradient(135deg, 
                rgba(220, 252, 231, 0.4), 
                rgba(187, 247, 208, 0.3)
            );
            border-radius: 16px;
            border: 1px solid rgba(34, 197, 94, 0.2);
        }

        .ingredients-icon {
            font-size: 1.1rem;
            margin-top: 0.1rem;
        }

        .ingredients-label {
            font-size: 0.9rem;
            font-weight: 600;
            color: #166534;
            white-space: nowrap;
            margin-top: 0.1rem;
        }

        .ingredients-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 0.4rem;
            flex: 1;
        }

        .recommendation-content-area .ingredient-tag {
            background: linear-gradient(135deg, #dcfce7, #bbf7d0);
            color: #166534;
            padding: 0.3rem 0.6rem;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 500;
            border: 1px solid rgba(34, 197, 94, 0.3);
        }

        /* 口感区域 */
        .taste-section {
            display: flex;
            align-items: flex-start;
            gap: 0.5rem;
            padding: 1rem;
            background: linear-gradient(135deg, 
                rgba(254, 243, 199, 0.4), 
                rgba(253, 230, 138, 0.3)
            );
            border-radius: 16px;
            border: 1px solid rgba(245, 158, 11, 0.2);
        }

        .taste-icon {
            font-size: 1.1rem;
            margin-top: 0.1rem;
        }

        .taste-label {
            font-size: 0.9rem;
            font-weight: 600;
            color: #92400e;
            white-space: nowrap;
            margin-top: 0.1rem;
        }

        .taste-profile {
            font-size: 0.9rem;
            color: #a16207;
            line-height: 1.5;
            flex: 1;
        }

        .cocktail-info {
            display: flex;
            justify-content: space-between;
            gap: 1rem;
            margin-top: 0.5rem;
        }

        .info-item {
            flex: 1;
            text-align: center;
            padding: 0.5rem;
            background: rgba(248, 250, 252, 0.6);
            border-radius: 8px;
            font-size: 0.8rem;
        }

        .info-icon {
            display: block;
            font-size: 1.2rem;
            margin-bottom: 0.25rem;
        }

        .info-label {
            color: #64748b;
            font-size: 0.7rem;
            margin-bottom: 0.1rem;
        }

        .info-value {
            color: #1e293b;
            font-weight: 600;
        }

        .action-button-container {
            margin-top: auto;
            padding-top: 1rem;
        }

        .view-details-btn {
            width: 100%;
            background: linear-gradient(135deg, #22c55e, #16a34a);
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 12px;
            font-size: 0.9rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 12px rgba(34, 197, 94, 0.3);
        }

        .view-details-btn:hover {
            background: linear-gradient(135deg, #16a34a, #15803d);
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(34, 197, 94, 0.4);
        }

        /* 隐藏状态 */
        .recommendation-content-area > * {
            opacity: 0;
            transform: translateY(10px);
            transition: all 0.4s ease;
        }

        .recommendation-content-area.visible > * {
            opacity: 1;
            transform: translateY(0);
        }

        /* 轻微弹跳动画 */
        @keyframes gentle-bounce {
            0%, 100% { transform: translateY(0) scale(1); }
            50% { transform: translateY(-3px) scale(1.05); }
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .cocktail-name {
            font-size: 1.5rem;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 0.5rem;
        }

        .cocktail-reason {
            font-size: 1rem;
            color: var(--text-secondary);
            margin-bottom: 1rem;
            font-style: italic;
        }

        .cocktail-recipe {
            font-size: 0.9rem;
            color: var(--text-muted);
        }

        /* 中等屏幕优化 */
        @media (max-width: 1024px) and (min-width: 769px) {
            .making-grid {
                gap: 1rem;
            }
            
            .simple-cocktail-card {
                min-height: 400px;
                max-height: none;
            }
        }

        /* 响应式调整 - 优化移动端布局 */
        @media (max-width: 768px) {
            .making-grid {
                grid-template-columns: 1fr;
                gap: 1rem;
                max-height: none;
            }
            
            .simple-cocktail-card {
                min-height: auto;
                max-height: none;
                padding: 1rem;
            }
            
            .cocktail-making-section {
                min-height: auto;
                padding: 1rem 0 3rem 0;
            }
            

            
            .cocktail-glass {
                font-size: 3rem;
            }
            
            .shaker-analysis-text {
                font-size: 1.1rem;
                padding: 1.5rem;
            }
        }

        /* 结果展示 */
        .results-section {
            display: none;
            padding: 4rem 0;
        }

        .results-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 2rem;
            margin-top: 3rem;
        }

        .cocktail-card {
            padding: 2rem;
            background: var(--bg-glass);
            border: 1px solid var(--border-glass);
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .cocktail-card:hover {
            transform: translateY(-5px);
            background: var(--bg-glass-hover);
            box-shadow: var(--shadow-glow);
        }

        .cocktail-title {
            font-size: 1.3rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: var(--text-primary);
        }

        .cocktail-subtitle {
            font-style: italic;
            color: var(--text-secondary);
            margin-bottom: 1rem;
        }

        .cocktail-reason {
            color: var(--text-secondary);
            margin-bottom: 1.5rem;
            line-height: 1.5;
        }

        .cocktail-meta {
            display: flex;
            justify-content: space-between;
            font-size: 0.9rem;
            color: var(--text-muted);
        }

        /* 响应式设计 */
        @media (max-width: 768px) {
            .container {
                padding: 0 1rem;
            }
            
            .hero-title {
                font-size: 2.5rem;
            }
            
            .options-grid {
                grid-template-columns: 1fr;
            }
            
            .ingredients-section {
                grid-template-columns: 1fr;
            }
            
            .preferences-grid {
                grid-template-columns: 1fr;
            }
            
            .results-grid {
                grid-template-columns: 1fr;
            }
            
            .step-navigation {
                flex-direction: column;
                align-items: center;
            }
        }

        /* 隐藏类 */
        .hidden {
            display: none !important;
        }
    </style>
</head>
<body>
    <!-- 背景动效 -->
    <div class="bg-animation"></div>

    <!-- 头部导航 - 移除黑色背景 -->
    <header class="header">
        <div class="container">
            <a href="#" class="logo">
                <span class="logo-icon">🍸</span>
                <span>Shaker</span>
            </a>
                </div>
    </header>

        <!-- 主内容 -->
    <main class="main-content">
        <!-- 英雄区域 -->
        <section class="hero-section" id="heroSection">
            <div class="container">
                <h1 class="hero-title">
                    <span class="title-leaf">🌿</span><span class="gradient-text">Shaker</span> 你的调酒师
                </h1>
                <p class="hero-subtitle">
                    在我的小脑袋瓜里，有你最完美的那一杯，它懂你，让我来告诉你。
                </p>
                <a href="#sceneSection" class="hero-cta">
                    <span>🍸</span>
                    开始寻找之旅
                </a>
                </div>
        </section>

        <!-- 右侧进度指示器 -->
        <div class="progress-sidebar">
            <div class="progress-line-main">
                <div class="progress-indicator"></div>
                </div>
                </div>

        <!-- 场景选择区域 -->
        <section class="choice-section" id="sceneSection">
        <div class="container">
                                <h2 class="section-title">✨ 选择你的时光</h2>
                <p class="section-subtitle">每一个时刻，都值得用一杯特别的酒来纪念</p>
                <div class="scene-grid" id="sceneOptions">
                    <div class="scene-card" data-value="聚会派对">
                        <span class="scene-icon">🎉</span>
                        <h4 class="scene-title">聚会派对</h4>
                        <p class="scene-desc">朋友聚会、生日庆祝、社交活动</p>
            </div>
                    <div class="scene-card" data-value="浪漫约会">
                        <span class="scene-icon">💕</span>
                        <h4 class="scene-title">浪漫约会</h4>
                        <p class="scene-desc">情侣约会、纪念日、浪漫晚餐</p>
                    </div>
                    <div class="scene-card" data-value="独处放松">
                        <span class="scene-icon">🧘</span>
                        <h4 class="scene-title">独处放松</h4>
                        <p class="scene-desc">下班后、阅读时光、放松心情</p>
                    </div>
                    <div class="scene-card" data-value="商务会面">
                        <span class="scene-icon">🤝</span>
                        <h4 class="scene-title">商务会面</h4>
                        <p class="scene-desc">商务聚餐、工作庆祝、客户招待</p>
                    </div>
                    <div class="scene-card" data-value="夜晚时光">
                        <span class="scene-icon">🌙</span>
                        <h4 class="scene-title">夜晚时光</h4>
                        <p class="scene-desc">夜店聚会、深夜聊天、不眠夜</p>
                    </div>
                    <div class="scene-card" data-value="午后惬意">
                        <span class="scene-icon">☀️</span>
                        <h4 class="scene-title">午后惬意</h4>
                        <p class="scene-desc">下午茶时光、悠闲午后、享受生活</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- 心情选择区域 -->
        <section class="choice-section" id="moodSection">
            <div class="container">
                <h2 class="section-title">💫 描述你的心情</h2>
                <p class="section-subtitle">选择1-3个最符合你当前状态的心情</p>
                                <div class="mood-grid" id="moodOptions">
                    <div class="mood-card" data-value="春日愉悦">
                        <span class="mood-icon">🌻</span>
                        <h4 class="mood-title">春日愉悦</h4>
                        <p class="mood-desc">心情如春花般绽放，充满活力</p>
        </div>
                    <div class="mood-card" data-value="雨后忧郁">
                        <span class="mood-icon">🌧️</span>
                        <h4 class="mood-title">雨后忧郁</h4>
                        <p class="mood-desc">如雨后森林般沉静，需要抚慰</p>
    </div>
                    <div class="mood-card" data-value="夏日激情">
                        <span class="mood-icon">☀️</span>
                        <h4 class="mood-title">夏日激情</h4>
                        <p class="mood-desc">如火焰般热烈，充满期待</p>
                    </div>
                    <div class="mood-card" data-value="秋叶宁静">
                        <span class="mood-icon">🍂</span>
                        <h4 class="mood-title">秋叶宁静</h4>
                        <p class="mood-desc">如秋日般平和，寻求内心平衡</p>
                    </div>
                    <div class="mood-card" data-value="山峰自信">
                        <span class="mood-icon">⛰️</span>
                        <h4 class="mood-title">山峰自信</h4>
                        <p class="mood-desc">如高山般坚定，充满力量</p>
                    </div>
                    <div class="mood-card" data-value="深林沉思">
                        <span class="mood-icon">🌳</span>
                        <h4 class="mood-title">深林沉思</h4>
                        <p class="mood-desc">如古树般深邃，专注思考</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- 材料选择区域 -->
        <section class="choice-section" id="ingredientSection">
        <div class="container">
                <h2 class="section-title">🍹 选择材料</h2>
                <p class="section-subtitle">选择你拥有或喜欢的调酒材料</p>
                <div class="ingredients-section">
                    <div class="ingredient-category glass-card" data-theme="spirits">
                        <h4 class="category-title">🥃 基酒</h4>
                        <div class="ingredient-list" data-category="spirits">
                            <span class="ingredient-tag" data-value="威士忌">威士忌</span>
                            <span class="ingredient-tag" data-value="伏特加">伏特加</span>
                            <span class="ingredient-tag" data-value="金酒">金酒</span>
                            <span class="ingredient-tag" data-value="龙舌兰">龙舌兰</span>
                            <span class="ingredient-tag" data-value="朗姆酒">朗姆酒</span>
                            <span class="ingredient-tag" data-value="白兰地">白兰地</span>
                    </div>
                    </div>
                    <div class="ingredient-category glass-card" data-theme="mixers">
                        <h4 class="category-title">🍋 调味料</h4>
                        <div class="ingredient-list" data-category="mixers">
                            <span class="ingredient-tag" data-value="柠檬汁">柠檬汁</span>
                            <span class="ingredient-tag" data-value="青柠汁">青柠汁</span>
                            <span class="ingredient-tag" data-value="橙汁">橙汁</span>
                            <span class="ingredient-tag" data-value="苏打水">苏打水</span>
                            <span class="ingredient-tag" data-value="汤力水">汤力水</span>
                            <span class="ingredient-tag" data-value="薄荷">薄荷</span>
                            <span class="ingredient-tag" data-value="蜂蜜">蜂蜜</span>
                            <span class="ingredient-tag" data-value="糖浆">糖浆</span>
                    </div>
                    </div>
                    <div class="ingredient-category glass-card" data-theme="tools">
                        <h4 class="category-title">🧊 工具</h4>
                        <div class="ingredient-list" data-category="tools">
                            <span class="ingredient-tag" data-value="调酒器">调酒器</span>
                            <span class="ingredient-tag" data-value="量杯">量杯</span>
                            <span class="ingredient-tag" data-value="搅拌棒">搅拌棒</span>
                            <span class="ingredient-tag" data-value="过滤器">过滤器</span>
                            <span class="ingredient-tag" data-value="冰块">冰块</span>
                    </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- 偏好设置区域 -->
        <section class="choice-section" id="preferenceSection">
        <div class="container">
                <h2 class="section-title">✨ 偏好设置</h2>
                <p class="section-subtitle">调整你的口味偏好，让每一杯都更合你心意</p>
                
                <div class="preference-grid">
                    <div class="preference-card glass-card">
                        <h4 class="preference-title">甜度</h4>
                        <div class="slider-container">
                            <input type="range" min="0" max="10" value="5" class="slider" id="sweetnessSlider">
                            <div class="slider-value" id="sweetnessValue">适中</div>
                            <div class="slider-labels">
                                <span>清淡</span>
                                <span>适中</span>
                                <span>浓郁</span>
                    </div>
                    </div>
                    </div>

                    <div class="preference-card glass-card">
                        <h4 class="preference-title">酒精度</h4>
                        <div class="slider-container">
                            <input type="range" min="0" max="10" value="5" class="slider" id="alcoholSlider">
                            <div class="slider-value" id="alcoholValue">中度</div>
                            <div class="slider-labels">
                                <span>低度</span>
                                <span>中度</span>
                                <span>高度</span>
                    </div>
                    </div>
                    </div>
                    
                    <div class="preference-card glass-card">
                        <h4 class="preference-title">口感</h4>
                        <div class="slider-container">
                            <input type="range" min="0" max="10" value="5" class="slider" id="textureSlider">
                            <div class="slider-value" id="textureValue">平衡</div>
                            <div class="slider-labels">
                                <span>清爽</span>
                                <span>平衡</span>
                                <span>浓厚</span>
                </div>
            </div>
        </div>
    </div>
            </div>
        </section>

        <!-- 特殊要求区域 -->
        <section class="choice-section" id="requirementSection">
        <div class="container">
                <h2 class="section-title">💭 特殊要求</h2>
                <p class="section-subtitle">告诉我们你的特别需求，让调酒更贴心</p>
                
                <div class="requirement-container">
                    <textarea 
                        id="specialRequirement" 
                        class="requirement-input" 
                        placeholder="比如：我希望有薄荷的清香，或者想要一杯能让人放松的酒..."
                        rows="4"
                    ></textarea>
                    
                    <div class="requirement-tags">
                        <h5>快速选择：</h5>
                        <div class="tag-list">
                            <span class="requirement-tag" data-value="不含咖啡因">不含咖啡因</span>
                            <span class="requirement-tag" data-value="低糖">低糖</span>
                            <span class="requirement-tag" data-value="颜值要高">颜值要高</span>
                            <span class="requirement-tag" data-value="制作简单">制作简单</span>
                            <span class="requirement-tag" data-value="有层次感">有层次感</span>
                            <span class="requirement-tag" data-value="适合拍照">适合拍照</span>
        </div>
    </div>
    </div>
            </div>
        </section>

        <!-- 获取推荐区域 -->
        <section class="choice-section" id="recommendSection">
        <div class="container">
                <h2 class="section-title">🎭 答案即将揭晓</h2>
                <p class="section-subtitle">寻找之旅即将结束，让我在小脑袋瓜里找到属于你的那一杯</p>
                <div style="text-align: center; margin: 3rem 0;">
                    <button class="hero-cta" onclick="getRecommendation()">
                        <span>✨</span>
                        揭晓答案
                    </button>
            </div>
            </div>
        </section>
                    <div class="step-content" id="step3">
                        <h3 class="step-title">选择可用材料</h3>
                        <p class="step-description">选择你目前拥有或容易获得的材料</p>
                        <div class="ingredients-section">
                            <div class="ingredient-category glass-card" data-theme="spirits">
                                <h4 class="category-title">🥃 基酒</h4>
                                <div class="ingredient-list" data-category="spirits">
                                    <span class="ingredient-tag" data-value="威士忌">威士忌</span>
                                    <span class="ingredient-tag" data-value="伏特加">伏特加</span>
                                    <span class="ingredient-tag" data-value="金酒">金酒</span>
                                    <span class="ingredient-tag" data-value="朗姆酒">朗姆酒</span>
                                    <span class="ingredient-tag" data-value="龙舌兰">龙舌兰</span>
                                    <span class="ingredient-tag" data-value="白兰地">白兰地</span>
                                </div>
                            </div>
                            <div class="ingredient-category glass-card" data-theme="mixers">
                                <h4 class="category-title">🍋 调料</h4>
                                <div class="ingredient-list" data-category="mixers">
                                    <span class="ingredient-tag" data-value="柠檬汁">柠檬汁</span>
                                    <span class="ingredient-tag" data-value="青柠汁">青柠汁</span>
                                    <span class="ingredient-tag" data-value="橙汁">橙汁</span>
                                    <span class="ingredient-tag" data-value="苏打水">苏打水</span>
                                    <span class="ingredient-tag" data-value="汤力水">汤力水</span>
                                    <span class="ingredient-tag" data-value="薄荷叶">薄荷叶</span>
                                    <span class="ingredient-tag" data-value="糖浆">糖浆</span>
                                    <span class="ingredient-tag" data-value="蜂蜜">蜂蜜</span>
                                </div>
                            </div>
                            <div class="ingredient-category glass-card" data-theme="tools">
                                <h4 class="category-title">🛠️ 工具</h4>
                                <div class="ingredient-list" data-category="tools">
                                    <span class="ingredient-tag" data-value="调酒器">调酒器</span>
                                    <span class="ingredient-tag" data-value="量杯">量杯</span>
                                    <span class="ingredient-tag" data-value="搅拌棒">搅拌棒</span>
                                    <span class="ingredient-tag" data-value="滤网">滤网</span>
                                    <span class="ingredient-tag" data-value="冰块">冰块</span>
                                </div>
                            </div>
                        </div>
                        <div class="step-navigation">
                            <button class="btn btn-secondary" onclick="prevStep()">← 上一步</button>
                            <button class="btn btn-primary" onclick="nextStep()">下一步 →</button>
        </div>
    </div>

                    <!-- 步骤4: 偏好设置 -->
                    <div class="step-content" id="step4">
                        <h3 class="step-title">设置口味偏好</h3>
                        <p class="step-description">调整滑块来设置你的口味偏好</p>
                        <div class="preferences-grid">
                            <div class="preference-item glass-card">
                                <div class="preference-label">酒精度</div>
                                <div class="slider-container">
                                    <input type="range" min="0" max="100" value="50" class="slider" id="alcoholLevel">
                                    <div class="slider-labels">
                                        <span>无酒精</span>
                                        <span>中度</span>
                                        <span>高度</span>
                                    </div>
                                </div>
                            </div>
                            <div class="preference-item glass-card">
                                <div class="preference-label">甜度</div>
                                <div class="slider-container">
                                    <input type="range" min="0" max="100" value="50" class="slider" id="sweetness">
                                    <div class="slider-labels">
                                        <span>不甜</span>
                                        <span>微甜</span>
                                        <span>很甜</span>
                                    </div>
                                </div>
                            </div>
                            <div class="preference-item glass-card">
                                <div class="preference-label">酸度</div>
                                <div class="slider-container">
                                    <input type="range" min="0" max="100" value="50" class="slider" id="acidity">
                                    <div class="slider-labels">
                                        <span>不酸</span>
                                        <span>适中</span>
                                        <span>很酸</span>
                                    </div>
                                </div>
                            </div>
                            <div class="preference-item glass-card">
                                <div class="preference-label">口感风格</div>
                                <div class="options-grid" style="grid-template-columns: repeat(2, 1fr); gap: 0.5rem; margin-top: 1rem;">
                                    <div class="option-card" data-value="清爽" style="padding: 0.8rem;">
                                        <h4 class="option-title" style="margin: 0; font-size: 0.9rem;">清爽</h4>
                                    </div>
                                    <div class="option-card" data-value="浓郁" style="padding: 0.8rem;">
                                        <h4 class="option-title" style="margin: 0; font-size: 0.9rem;">浓郁</h4>
                                    </div>
                                    <div class="option-card" data-value="顺滑" style="padding: 0.8rem;">
                                        <h4 class="option-title" style="margin: 0; font-size: 0.9rem;">顺滑</h4>
                                    </div>
                                    <div class="option-card" data-value="刺激" style="padding: 0.8rem;">
                                        <h4 class="option-title" style="margin: 0; font-size: 0.9rem;">刺激</h4>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <!-- 材料选择后自动推进 -->
                        <div class="step-navigation">
                            <button class="btn btn-secondary" onclick="prevStep()">← 上一步</button>
                            <button class="btn btn-primary" onclick="nextStep()">继续设置偏好 →</button>
                        </div>
                    </div>

                    <!-- 步骤5: 特殊要求 -->
                    <div class="step-content" id="step5">
                        <h3 class="step-title">特殊要求 (可选)</h3>
                        <p class="step-description">有什么特别的要求或想法吗？</p>
                        <div class="glass-card" style="padding: 2rem; margin: 2rem 0;">
                            <textarea 
                                id="specialRequirements" 
                                placeholder="例如：希望颜值高一些、适合拍照、口感清淡、无需复杂工具等..."
                                style="width: 100%; height: 120px; background: var(--bg-secondary); border: 1px solid var(--border-glass); border-radius: 12px; padding: 1rem; color: var(--text-primary); font-family: inherit; font-size: 1rem; resize: vertical;"
                            ></textarea>
                        </div>
                        <div class="step-navigation">
                            <button class="btn btn-secondary" onclick="prevStep()">← 上一步</button>
                            <button class="btn btn-primary" onclick="getRecommendation()">🎯 获取推荐</button>
                        </div>
                    </div>
                </div>
            </div>
        </section>

    <!-- 加载状态 -->
        <section class="loading-section" id="loadingSection">
        <div class="container">
                <div class="loading-animation"></div>
                <h2 class="loading-title">AI 正在为你推荐...</h2>
                <p class="loading-subtitle">基于你的偏好分析最适合的鸡尾酒配方</p>
            </div>
        </section>



        <!-- Shaker分析区域 -->
        <section class="shaker-analysis-section" id="shakerAnalysisSection">
            <div class="container">
                <div class="shaker-analysis-container">
                    <!-- Shaker思考区域 -->
                    <div class="shaker-thinking-area">
                        <div class="shaker-avatar-large">🧙‍♂️</div>
                        
                        <!-- 思考泡泡容器 -->
                        <div class="thought-bubbles-container" id="thoughtBubblesContainer">
                            <!-- 思考泡泡将在这里动态生成 -->
                        </div>
                    </div>
                    
                    <h2 class="section-title" id="analysisTitle">让我想想你刚才说了什么...</h2>
                    
                    <!-- 分段分析展示区域 -->
                    <div class="analysis-segments" id="analysisSegments">
                        <!-- 分段内容将在这里动态生成 -->
                    </div>
                    
                    <!-- 传统分析文本区域（保持兼容性） -->
                    <div class="shaker-analysis-text" id="shakerAnalysisText" style="display: none;">
                        <span class="typing-cursor" id="typingCursor"></span>
                    </div>
                </div>
            </div>
        </section>

        <!-- 调制动画区域 -->
        <section class="cocktail-making-section" id="cocktailMakingSection">
            <div class="container">
                <h2 class="section-title">正在为你调制鸡尾酒...</h2>
                <div class="making-grid" id="makingGrid">
                    <!-- 调制卡片将在这里动态生成 -->
                </div>
            </div>
        </section>

        <!-- 推荐结果 -->
        <section class="results-section" id="resultsSection">
        <div class="container">
                <h2 class="section-title">为你推荐的鸡尾酒</h2>
                <div class="results-grid" id="resultsGrid">
                    <!-- 结果将在这里动态填充 -->
        </div>
                <div style="text-align: center; margin-top: 3rem;">
                    <button class="btn btn-secondary" onclick="startRecommendation()">🔄 重新推荐</button>
    </div>
    </div>
        </section>
    </main>

    <script>
        // 使用模块化的本地分析生成器（已在js/local-analysis.js中定义）

        // 使用模块化的回顾卡片生成器（已在js/review-card-generator.js中定义）


        // 思考泡泡生成器
        class ThoughtBubbleGenerator {
            constructor() {
                this.positions = ['top-right', 'top-left', 'right', 'left', 'bottom'];
                this.currentPositionIndex = 0;
            }
            
            // 根据泡泡数量智能分配位置
            getOptimalPositions(bubbleCount) {
                if (bubbleCount <= 2) {
                    return ['top-left', 'top-right'];
                } else if (bubbleCount <= 3) {
                    return ['top-left', 'top-right', 'bottom'];
                } else if (bubbleCount <= 4) {
                    return ['top-left', 'top-right', 'left', 'right'];
                } else {
                    return ['top-left', 'top-right', 'left', 'right', 'bottom'];
                }
            }
            
            generateBubbles(userInput) {
                const bubbles = [];
                
                // 先收集所有需要显示的泡泡
                const bubbleData = [
                    { type: 'scene', value: userInput.scene, icon: '⭐' },
                    { type: 'moods', value: userInput.moods, icon: '💫' },
                    { type: 'ingredients', value: userInput.ingredients, icon: '🍋' },
                    { type: 'preferences', value: userInput.preferences, icon: '🍸' },
                    { type: 'special', value: userInput.special_requirements, icon: '✨' }
                ];
                
                // 过滤出有内容的泡泡，如果没有内容也保留（显示兜底文案）
                const validBubbles = bubbleData.filter(bubble => {
                    if (bubble.type === 'ingredients') {
                        return true; // 材料泡泡总是显示
                    }
                    if (bubble.type === 'preferences') {
                        return true; // 偏好泡泡总是显示
                    }
                    return true; // 所有泡泡都显示
                });
                
                // 获取最优位置分配
                const optimalPositions = this.getOptimalPositions(validBubbles.length);
                
                // 创建泡泡并分配位置
                validBubbles.forEach((bubbleData, index) => {
                    const position = optimalPositions[index] || 'bottom';
                    const bubble = this.createBubbleWithPosition(
                        bubbleData.type, 
                        bubbleData.value, 
                        bubbleData.icon, 
                        position
                    );
                    bubbles.push(bubble);
                });
                
                return bubbles;
            }
            
            createBubble(type, value, icon) {
                const position = this.getNextPosition();
                const content = this.formatContent(type, value);
                const title = this.getTitle(type);
                
                return {
                    type,
                    icon,
                    title,
                    content,
                    position,
                    isEmpty: !value || (Array.isArray(value) && value.length === 0)
                };
            }
            
            createBubbleWithPosition(type, value, icon, position) {
                const content = this.formatContent(type, value);
                const title = this.getTitle(type);
                
                return {
                    type,
                    icon,
                    title,
                    content,
                    position,
                    isEmpty: !value || (Array.isArray(value) && value.length === 0)
                };
            }
            
            getNextPosition() {
                const position = this.positions[this.currentPositionIndex];
                this.currentPositionIndex = (this.currentPositionIndex + 1) % this.positions.length;
                return position;
            }
            
            getTitle(type) {
                const titles = {
                    'scene': '场景',
                    'moods': '心情',
                    'ingredients': '材料',
                    'preferences': '偏好',
                    'special': '要求'
                };
                return titles[type] || type;
            }
            
            formatContent(type, value) {
                if (!value || (Array.isArray(value) && value.length === 0) || 
                    (typeof value === 'string' && value.trim() === '')) {
                    return this.getEmptyText(type);
                }
                
                switch (type) {
                    case 'scene':
                        return this.getShakerSceneThought(value);
                    case 'moods':
                        return this.getShakerMoodThought(value);
                    case 'ingredients':
                        return this.getShakerIngredientThought(value);
                    case 'preferences':
                        return this.getShakerPreferenceThought(value);
                    case 'special':
                        return this.getShakerSpecialThought(value);
                    default:
                        return value;
                }
            }
            
            // Shaker场景思考
            getShakerSceneThought(scene) {
                const thoughts = [
                    `${scene}...多么美妙的时刻！我知道该调什么了✨`,
                    `想在${scene}享用呢～我脑海中已经有画面了🌟`,
                    `${scene}让我想起了特别的味道...会很棒的💫`,
                    `${scene}的时候...让我用最贴心的方式呵护你🎭`,
                    `${scene}有它独特的魅力，让我陪伴你度过🌙`,
                    `${scene}时最需要理解和陪伴...温暖你的心💕`,
                    `我能看到你在${scene}的样子...很美呢🌸`
                ];
                return this.getRandomThought(thoughts);
            }

            // Shaker心情思考
            getShakerMoodThought(moods) {
                const moodStr = Array.isArray(moods) ? moods.join('、') : moods;
                const thoughts = [
                    `${moodStr}的感觉...我完全理解！让我温柔捕捉💫`,
                    `想要${moodStr}呢～我会用最贴心的配方拥抱你💕`,
                    `${moodStr}让我想起特别的香气...抚慰心灵✨`,
                    `感受到${moodStr}了～让我用酒来陪伴温暖你🌟`,
                    `${moodStr}的心境...我能看到你内心的色彩💖`,
                    `${moodStr}心情让我心疼...最温柔的治愈🌸`,
                    `${moodStr}...我懂，让这杯酒给你力量💝`
                ];
                return this.getRandomThought(thoughts);
            }

            // Shaker材料思考
            getShakerIngredientThought(ingredients) {
                const parts = [];
                if (ingredients.spirits && ingredients.spirits.length > 0) {
                    parts.push(ingredients.spirits.join('、'));
                }
                if (ingredients.mixers && ingredients.mixers.length > 0) {
                    parts.push(ingredients.mixers.join('、'));
                }
                
                if (parts.length > 0) {
                    const ingredientStr = parts.join('和');
                    const thoughts = [
                        `准备了${ingredientStr}呢！让我发挥创意🍋`,
                        `${ingredientStr}...很好的选择！会很精彩✨`,
                        `看到${ingredientStr}，直觉告诉我会很特别🌟`,
                        `${ingredientStr}...让我完美融合它们💫`,
                        `有了${ingredientStr}，能想象丰富口感了🎭`
                    ];
                    return this.getRandomThought(thoughts);
                } else {
                    return this.getRandomThought([
                        '让我自由选择材料！最好的创作来自直觉✨',
                        '没有限制...我最喜欢了！用经验挑选🌟',
                        '相信我的专业判断～选最适合的💫'
                    ]);
                }
            }

            // Shaker偏好思考
            getShakerPreferenceThought(preferences) {
                const thoughts = [
                    `注意到你的偏好了...精确调配🍸`,
                    `根据你的喜好...能感受到品味✨`,
                    `偏好告诉了我很多...创造独特配方💫`,
                    `从选择中读出了你的理解...很合拍🌟`,
                    `偏好让我更了解你...心灵的交流💕`
                ];
                return this.getRandomThought(thoughts);
            }

            // Shaker特殊要求思考
            getShakerSpecialThought(special) {
                const thoughts = [
                    `特别要求：${special} ✨ 喜欢挑战！`,
                    `${special}...有趣的要求！创新机会🌟`,
                    `关于"${special}"...已经有想法了💫`,
                    `${special}...想起特别技巧，来展示🎭`,
                    `要求"${special}"收到！挑战更有趣✨`
                ];
                return this.getRandomThought(thoughts);
            }

            // 获取随机思考内容
            getRandomThought(thoughts) {
                return thoughts[Math.floor(Math.random() * thoughts.length)];
            }

            getEmptyText(type) {
                const emptyTexts = {
                    'scene': this.getRandomThought([
                        '嗯...还没想好在什么场合喝呢～不过没关系，我会为你选择最适合的氛围！💫',
                        '场景嘛...有时候最美的时刻是意外降临的，让我来创造一个特别的时刻吧！✨',
                        '没有特定场景也很好呢～这样我就能调制一杯适合任何时刻的万能酒！🌟'
                    ]),
                    'moods': this.getRandomThought([
                        '心情嘛...随意就好啦💕 有时候最好的心情是在品尝美酒时自然流露的！',
                        '没有特定心情？那就让这杯酒来为你带来惊喜的心境吧！✨',
                        '心情是会变化的...让我调制一杯能够适应你任何心境的酒！💫'
                    ]),
                    'ingredients': this.getRandomThought([
                        '让我来自由发挥吧！✨ 有时候最好的创作来自于调酒师的直觉和经验！',
                        '没有材料限制...这是我最喜欢的挑战！让我用最棒的组合来惊艳你！🌟',
                        '相信我的选择～我会用最适合的材料为你调制完美的酒！💫'
                    ]),
                    'preferences': this.getRandomThought([
                        '相信我的专业判断～😊 我会根据你的整体需求来调配最合适的口感！',
                        '没有特定偏好也很好～这样我就能展示我的调酒艺术了！✨',
                        '让我来为你探索新的味觉体验吧！有时候惊喜比预期更美妙！💫'
                    ]),
                    'special': this.getRandomThought([
                        '没有特别要求...很好很好！这样我就能专注于调制最经典完美的酒了！✨',
                        '简单就是美～有时候最朴素的要求能带来最纯粹的享受！💫',
                        '没有限制的创作...让我用最纯粹的调酒技艺来感动你吧！🌟'
                    ])
                };
                return emptyTexts[type] || '让我好好想想...🤔';
            }
            

            
            hasIngredients(ingredients) {
                if (!ingredients) return false;
                const { spirits, mixers, tools } = ingredients;
                return (spirits && spirits.length > 0) || (mixers && mixers.length > 0) || (tools && tools.length > 0);
            }
            
            hasPreferences(preferences) {
                if (!preferences) return false;
                return preferences.alcohol_level || preferences.sweetness || preferences.style;
            }
        }
        
        const thoughtBubbleGenerator = new ThoughtBubbleGenerator();

        // 全局状态
        let currentStep = 1;
        let userInput = {
            scene: '',
            moods: [],
            ingredients: {
                spirits: [],
                mixers: [],
                tools: []
            },
            preferences: {
                alcohol_level: 50,
                sweetness: 50,
                acidity: 50,
                style: ''
            },
            special_requirements: ''
        };

        // 页面加载完成后执行
        document.addEventListener('DOMContentLoaded', function() {
            initializeApp();
            setupScrollEffects();
            setupSliders();
        });

        // 初始化应用
        function initializeApp() {
            setupScrollEffects();
            setupIntersectionObserver();
            setupEventListeners();
            updateProgressBar(); // 初始化进度条
            // initializeBubblePhysics(); // 关闭气泡物理效果，使用正常布局
        }

        // 设置滚动效果
        function setupScrollEffects() {
            const header = document.querySelector('.header');
            
            window.addEventListener('scroll', () => {
                if (window.scrollY > 100) {
                    header.classList.add('scrolled');
                } else {
                    header.classList.remove('scrolled');
                }
                
                // 更新进度条
                updateProgressBar();
            });
        }

        // 更新进度条
        function updateProgressBar() {
            const sections = [
                'sceneSection',
                'moodSection', 
                'ingredientSection',
                'preferenceSection',
                'requirementSection',
                'recommendSection'
            ];
            
            const indicator = document.querySelector('.progress-indicator');
            let activeSection = 0;
            
            // 找到当前在视窗中的区域
            sections.forEach((sectionId, index) => {
                const section = document.getElementById(sectionId);
                if (section) {
                    const rect = section.getBoundingClientRect();
                    const windowHeight = window.innerHeight;
                    
                    // 如果区域在视窗中间部分
                    if (rect.top <= windowHeight / 2 && rect.bottom >= windowHeight / 2) {
                        activeSection = index;
                    }
                }
            });
            
            // 更新进度条位置
            if (indicator) {
                const progress = (activeSection / (sections.length - 1)) * 100;
                indicator.style.top = `${progress}%`;
            }
        }

        // 设置滚动动画观察器
        function setupIntersectionObserver() {
            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        entry.target.classList.add('visible');
                    }
                });
            }, { threshold: 0.1 });

            document.querySelectorAll('.features-section, .recommendation-section').forEach(el => {
                observer.observe(el);
            });
        }

        // 设置事件监听器
        function setupEventListeners() {
        // 场景选择
            document.querySelector('.scene-grid').addEventListener('click', handleSceneSelection);
            
            // 心情选择
            document.querySelector('.mood-grid').addEventListener('click', handleMoodSelection);
            
            // 材料选择
            document.querySelectorAll('.ingredient-list').forEach(list => {
                list.addEventListener('click', handleIngredientSelection);
            });
            
            // 口感风格选择
            document.querySelector('#step4 .options-grid').addEventListener('click', handleStyleSelection);
            
            // 偏好滑块
            document.querySelectorAll('.slider').forEach(slider => {
                slider.addEventListener('input', handlePreferenceChange);
            });
            
            // 特殊要求便捷输入
            document.querySelector('.requirement-tags .tag-list').addEventListener('click', handleRequirementTagClick);
        }

                        // 处理场景选择
        function handleSceneSelection(e) {
            const card = e.target.closest('.scene-card');
            if (!card) return;
            
            const scene = card.dataset.value;
            
            if (card.classList.contains('selected')) {
                // 如果已选中，则取消选中
                card.classList.remove('selected');
                userInput.scene = '';
            } else {
                // 清除其他选择
                document.querySelectorAll('.scene-card').forEach(c => {
                    c.classList.remove('selected');
                });
                
                // 选择当前卡片
                card.classList.add('selected');
                userInput.scene = scene;
            }
            
            console.log('选择的场景:', userInput.scene);
        }

                        // 处理心情选择
        function handleMoodSelection(e) {
            const card = e.target.closest('.mood-card');
            if (!card) return;
            
                const mood = card.dataset.value;
                
                if (card.classList.contains('selected')) {
                    // 取消选择
                    card.classList.remove('selected');
                if (userInput.moods) {
                    userInput.moods = userInput.moods.filter(m => m !== mood);
                }
            } else if (!userInput.moods || userInput.moods.length < 3) {
                    // 添加选择
                    card.classList.add('selected');
                if (!userInput.moods) userInput.moods = [];
                userInput.moods.push(mood);
            }
            
            console.log('选择的心情:', userInput.moods);
        }

        // 处理材料选择
        function handleIngredientSelection(e) {
            const tag = e.target.closest('.ingredient-tag');
            if (!tag) return;
            
            const category = e.currentTarget.dataset.category;
            const value = tag.dataset.value;
            
            tag.classList.toggle('selected');
            
            if (tag.classList.contains('selected')) {
                userInput.ingredients[category].push(value);
                } else {
                userInput.ingredients[category] = userInput.ingredients[category].filter(item => item !== value);
            }
        }

        // 处理口感风格选择
        function handleStyleSelection(e) {
            const card = e.target.closest('.option-card');
            if (!card) return;
            
                // 清除其他选择
            document.querySelectorAll('#step4 .options-grid .option-card').forEach(c => {
                    c.classList.remove('selected');
                });
                
                // 选择当前卡片
                card.classList.add('selected');
            userInput.preferences.style = card.dataset.value;
        }

        // 处理偏好变化
        function handlePreferenceChange(e) {
            const slider = e.target;
            const value = parseInt(slider.value);
            userInput.preferences[slider.id] = value;
        }

        // 处理特殊要求便捷输入
        function handleRequirementTagClick(e) {
            const tag = e.target.closest('.requirement-tag');
            if (!tag) return;
            
            const value = tag.dataset.value;
            const textarea = document.getElementById('specialRequirement');
            const currentText = textarea.value.trim();
            
            // 如果文本框为空，直接添加
            if (!currentText) {
                textarea.value = value;
            } else {
                // 如果已有内容，用逗号分隔添加
                textarea.value = currentText + '，' + value;
            }
            
            // 触发变化事件并聚焦到文本框
            textarea.dispatchEvent(new Event('input'));
            textarea.focus();
            
            // 添加视觉反馈
            tag.style.transform = 'scale(0.95)';
            setTimeout(() => {
                tag.style.transform = '';
            }, 150);
        }

        // 设置滑动条智能反馈
        function setupSliders() {
            const sliders = [
                { 
                    id: 'sweetnessSlider', 
                    valueId: 'sweetnessValue',
                    labels: ['清淡', '微甜', '轻甜', '适中', '偏甜', '中甜', '浓甜', '很甜', '超甜', '极甜', '浓郁']
                },
                { 
                    id: 'alcoholSlider', 
                    valueId: 'alcoholValue',
                    labels: ['无酒精', '微量', '轻度', '低度', '偏低', '中度', '偏中', '偏高', '高度', '很高', '极高']
                },
                { 
                    id: 'textureSlider', 
                    valueId: 'textureValue',
                    labels: ['清爽', '轻盈', '顺滑', '平衡', '醇厚', '丰富', '浓郁', '厚重', '浓厚', '粘稠', '浓重']
                }
            ];

            sliders.forEach(sliderConfig => {
                const slider = document.getElementById(sliderConfig.id);
                const valueDisplay = document.getElementById(sliderConfig.valueId);
                
                if (slider && valueDisplay) {
                    // 初始化显示
                    updateSliderValue(slider, valueDisplay, sliderConfig.labels);
                    
                    // 监听变化 - 滑动时显示数值并更新
                    slider.addEventListener('input', () => {
                        updateSliderValue(slider, valueDisplay, sliderConfig.labels);
                        valueDisplay.style.opacity = '1';
                        valueDisplay.style.transform = 'translateX(-50%) translateY(-5px)';
                        
                        // 0.5秒后自动隐藏
                        clearTimeout(slider.hideTimeout);
                        slider.hideTimeout = setTimeout(() => {
                            if (!slider.matches(':hover')) {
                                valueDisplay.style.opacity = '0';
                                valueDisplay.style.transform = 'translateX(-50%)';
                            }
                        }, 500);
                    });
                    
                    // 鼠标移入显示数值
                    slider.addEventListener('mouseenter', () => {
                        clearTimeout(slider.hideTimeout);
                        valueDisplay.style.opacity = '1';
                        valueDisplay.style.transform = 'translateX(-50%) translateY(-5px)';
                    });
                    
                    // 鼠标移出隐藏数值
                    slider.addEventListener('mouseleave', () => {
                        valueDisplay.style.opacity = '0';
                        valueDisplay.style.transform = 'translateX(-50%)';
                    });
                }
            });
        }

        function updateSliderValue(slider, valueDisplay, labels) {
            const value = parseInt(slider.value);
            const label = labels[value] || labels[Math.floor(labels.length / 2)];
            valueDisplay.textContent = label;
            
            // 根据数值更新位置，并限制在容器范围内
            const percentage = (value / (slider.max - slider.min)) * 100;
            
            // 限制在10%到90%之间，避免超出容器边界
            const clampedPercentage = Math.max(10, Math.min(90, percentage));
            valueDisplay.style.left = clampedPercentage + '%';
            
            // 确保文字始终水平显示
            valueDisplay.style.transform = 'translateX(-50%)';
            valueDisplay.style.whiteSpace = 'nowrap';
        }

        // 初始化气泡物理效果 - 绝对无重叠的简单网格布局
        function initializeBubblePhysics() {
            const categories = document.querySelectorAll('.ingredient-category');
            
            categories.forEach(category => {
                const tags = category.querySelectorAll('.ingredient-tag');
                const container = category.querySelector('.ingredient-list');
                
                // 等待布局完成
                setTimeout(() => {
                    layoutBubblesNoOverlap(tags, container);
                }, 300);
            });
        }
        
        // 改进的自然分布布局算法
        function layoutBubblesNoOverlap(tags, container) {
            const containerWidth = container.offsetWidth - 30;
            const containerHeight = container.offsetHeight - 30;
            
            // 计算每个标签的实际尺寸，确保文字完整显示
            const tagInfos = Array.from(tags).map(tag => {
                const text = tag.textContent.trim();
                // 增加宽度计算，确保文字完整显示
                const width = Math.max(80, text.length * 12 + 30);
                const height = 40;
                return { tag, width, height, text };
            });
            
            const margin = 12;
            const positions = [];
            
            // 动态换行布局 - 从底部开始，自然换行
            let currentX = margin;
            let currentY = containerHeight - 50; // 从底部开始
            const rowHeight = 55; // 行间距
            
            tagInfos.forEach((info, index) => {
                const { tag, width, height } = info;
                
                // 检查当前行是否能放下这个标签
                if (currentX + width + margin > containerWidth) {
                    // 换到上一行
                    currentX = margin;
                    currentY -= rowHeight;
                    
                    // 如果超出顶部，重新从底部右侧开始
                    if (currentY < 0) {
                        currentY = containerHeight - 50;
                        currentX = containerWidth * 0.6; // 从右侧60%位置开始
                    }
                }
                
                // 添加一些随机偏移让布局更自然
                const xOffset = (Math.random() - 0.5) * 12; // ±6px
                const yOffset = (Math.random() - 0.5) * 12; // ±6px
                
                const finalX = Math.max(margin, Math.min(
                    containerWidth - width - margin,
                    currentX + xOffset
                ));
                
                const finalY = Math.max(margin, Math.min(
                    containerHeight - height - margin,
                    currentY + yOffset
                ));
                
                // 设置位置
                tag.style.left = finalX + 'px';
                tag.style.top = finalY + 'px';
                
                // 添加随机动画延迟
                tag.style.animationDelay = (Math.random() * 3) + 's';
                
                // 记录位置
                positions.push({ x: finalX, y: finalY, width, height });
                
                // 更新X位置
                currentX += width + margin;
            });
        }



        // 重置所有选择
        function resetSelections() {
            userInput = {
                scene: '',
                moods: [],
                ingredients: { spirits: [], mixers: [], tools: [] },
                preferences: { alcohol_level: 50, sweetness: 50, acidity: 50, style: '' },
                special_requirements: ''
            };
            
            // 清除所有选择状态
            document.querySelectorAll('.option-card').forEach(card => {
                    card.classList.remove('selected');
            });
            document.querySelectorAll('.ingredient-tag').forEach(tag => {
                tag.classList.remove('selected');
            });
        }

        // 下一步
        function nextStep() {
            if (currentStep < 5) {
                currentStep++;
                showStep(currentStep);
                updateStepProgress();
            }
        }

        // 上一步
        function prevStep() {
            if (currentStep > 1) {
                currentStep--;
                showStep(currentStep);
                updateStepProgress();
            }
        }

        // 显示指定步骤
        function showStep(step) {
            // 隐藏所有步骤
            document.querySelectorAll('.step-content').forEach(content => {
                content.classList.remove('active');
            });
            
            // 显示当前步骤
            document.getElementById(`step${step}`).classList.add('active');
        }

        // 更新步骤进度
        function updateStepProgress() {
            const dots = document.querySelectorAll('.progress-dot');
            const lines = document.querySelectorAll('.progress-line');
            
            dots.forEach((dot, index) => {
                const step = index + 1;
                dot.classList.remove('active', 'completed');
                
                if (step < currentStep) {
                    dot.classList.add('completed');
                } else if (step === currentStep) {
                    dot.classList.add('active');
                }
            });
            
            lines.forEach((line, index) => {
                line.classList.remove('active');
                if (index < currentStep - 1) {
                    line.classList.add('active');
                }
            });
        }

        // 获取分段图标
        function getSegmentIcon(focus) {
            const icons = {
                'scene': '🎭',
                'mood': '💫',
                'ingredients': '🍋',
                'preparation': '🍸',
                'general': '✨'
            };
            return icons[focus] || '✨';
        }

        // 更新分析标题，根据用户选择生成温暖贴心的话
        function updateAnalysisTitle(requestData) {
            const titleElement = document.getElementById('analysisTitle');
            if (!titleElement) return;
            
            // 收集用户的选择信息
            const choices = [];
            
            if (requestData.scene) {
                choices.push(`在${requestData.scene}的时候`);
            }
            
            if (requestData.moods && requestData.moods.length > 0) {
                choices.push(`想要${requestData.moods.join('、')}的感觉`);
            }
            
            if (requestData.special_requirements) {
                choices.push(`特别要求${requestData.special_requirements}`);
            }
            
            // 根据选择生成温暖的话
            let message = '';
            if (choices.length === 0) {
                const emptyMessages = [
                    '虽然你没有具体要求，但我能感受到你的期待...',
                    '有时候最美的惊喜来自于未知，让我为你创造...',
                    '你的信任让我很感动，我会用心为你调制...',
                    '没关系，让我用直觉来理解你真正想要的...'
                ];
                message = emptyMessages[Math.floor(Math.random() * emptyMessages.length)];
            } else if (choices.length === 1) {
                const singleMessages = [
                    `我理解你${choices[0]}的想法，让我好好想想...`,
                    `${choices[0]}...我能感受到你内心的渴望...`,
                    `关于${choices[0]}，我已经有了一些温暖的想法...`,
                    `${choices[0]}让我想起了很多美好的可能性...`
                ];
                message = singleMessages[Math.floor(Math.random() * singleMessages.length)];
            } else {
                const multiMessages = [
                    `你告诉我${choices.join('，')}...我都记在心里了...`,
                    `从${choices.join('，')}中，我读出了你的心情...`,
                    `${choices.join('，')}...每个细节都让我更懂你...`,
                    `你的${choices.join('，')}都很打动我，让我用心回应...`
                ];
                message = multiMessages[Math.floor(Math.random() * multiMessages.length)];
            }
            
            titleElement.textContent = message;
        }

        // 温暖话语体验 - 与思考泡泡同步但独立进行
        async function showLocalStoryExperience(requestData) {
            console.log('💕 开始温暖话语体验');
            
            const titleElement = document.getElementById('analysisTitle');
            if (!titleElement) return;
            
            // 开始温暖话语的完整故事
            await showWarmStorySequence(requestData, titleElement);
            
            console.log('💕 温暖话语体验完成');
        }
        
        // 温暖话语序列 - 精简的三段式故事
        async function showWarmStorySequence(requestData, titleElement) {
            // 调整字体样式 - 更小更精致
            titleElement.style.fontSize = '1.1rem';
            titleElement.style.lineHeight = '1.6';
            titleElement.style.maxWidth = '600px';
            titleElement.style.margin = '0 auto';
            
            // 第一段：温暖串联用户选择的小故事
            const storyText = generateConnectedStory(requestData);
            await typewriterStoryText(titleElement, storyText, 120); // 更慢的打字速度
            await new Promise(resolve => setTimeout(resolve, 4000)); // 更长的停留时间
            
            // 第二段：调酒师的理解和共鸣
            const empathyText = generateEmpathy(requestData);
            await typewriterStoryText(titleElement, empathyText, 120);
            await new Promise(resolve => setTimeout(resolve, 4000));
            
            // 第三段：期待感，准备揭晓
            const finalAnticipationText = generateFinalAnticipation(requestData);
            await typewriterStoryText(titleElement, finalAnticipationText, 120);
            await new Promise(resolve => setTimeout(resolve, 3000));
        }
        
        // 生成温暖开场 - 让用户感到被理解和欢迎
        function generateWarmOpening(requestData) {
            // 根据用户是否有选择来个性化开场
            const hasScene = requestData.scene;
            const hasMoods = requestData.moods && requestData.moods.length > 0;
            const hasSpecial = requestData.special_requirements;
            
            if (hasScene && hasMoods) {
                const sceneTexts = {
                    '浪漫晚餐': [
                        '浪漫的夜晚总是让人心动，你选择在这样特别的时刻来到这里，我能感受到你内心的温柔...',
                        '浪漫晚餐...多么美好的时光！我仿佛能看到烛光摇曳，你们相视而笑的画面...',
                        '在浪漫的晚餐时光里，每一杯酒都应该是爱的见证，让我为这份美好添上完美的注脚...'
                    ],
                    '朋友聚会': [
                        '和朋友在一起的时光总是那么珍贵，我能感受到你们之间的友谊和欢声笑语...',
                        '朋友聚会...这是多么温暖的场景！真正的友谊就像好酒一样，越品越香...',
                        '有朋友相伴的夜晚从不孤单，让我为你们的友谊调制一杯特别的酒...'
                    ],
                    '独自放松': [
                        '独处的时光同样珍贵，这是与自己对话的美好时刻，我很欣赏你懂得享受独处...',
                        '一个人的时光也可以很精彩，让我陪伴你度过这个安静而美好的夜晚...',
                        '独自品酒是一种优雅的生活态度，我能感受到你内心的从容和智慧...'
                    ]
                };
                
                const sceneMessages = sceneTexts[requestData.scene] || [
                    `${requestData.scene}...这是一个特别的时刻，我能感受到你对这个场合的重视和期待...`
                ];
                return sceneMessages[Math.floor(Math.random() * sceneMessages.length)];
            }
            
            if (hasMoods) {
                const moodStr = requestData.moods.join('、');
                const moodTexts = [
                    `想要${moodStr}的感觉...我完全理解，每个人都有属于自己的情感节拍，让我用酒来回应你的心境...`,
                    `${moodStr}...这些情感都很珍贵，它们构成了你独特的内心世界，我想用最贴心的方式来理解你...`,
                    `感受到你想要${moodStr}的心情了，情感是最真实的语言，让我用调酒的艺术来与你对话...`
                ];
                return moodTexts[Math.floor(Math.random() * moodTexts.length)];
            }
            
            // 没有具体选择时的温暖开场
            const generalTexts = [
                '每个人来到这里都有自己的故事，虽然你没有告诉我太多，但我能感受到你内心的期待...',
                '有时候最美的相遇不需要太多言语，你的到来就是对我最大的信任，让我用心为你服务...',
                '生活中总有一些时刻需要一杯好酒来陪伴，无论你此刻的心情如何，我都想为你带来温暖...'
            ];
            return generalTexts[Math.floor(Math.random() * generalTexts.length)];
        }
        
        // 生成鼓励话语 - 针对具体选择给予肯定和鼓励
        function generateEncouragement(requestData) {
            const encouragements = [];
            
            if (requestData.scene) {
                const sceneEncouragement = {
                    '浪漫晚餐': [
                        '你懂得在重要的时刻为爱情加分，这份用心让人感动。真正的浪漫不在于奢华，而在于那份真诚的心意...',
                        '选择在浪漫晚餐时品酒，说明你是一个懂得生活情趣的人。这样的细致和用心，一定会让这个夜晚更加难忘...'
                    ],
                    '朋友聚会': [
                        '能够珍惜友谊的人总是让人敬佩，你选择和朋友分享美好时光，这份真诚的友情比任何酒都要珍贵...',
                        '真正的朋友就像陈年好酒，越久越香。你们的友谊一定经历了时间的考验，值得用最好的酒来庆祝...'
                    ],
                    '独自放松': [
                        '懂得独处的人往往内心丰富，你选择给自己一个安静的时刻，这是对自己最好的关爱...',
                        '独自品酒需要勇气和智慧，你愿意与自己对话，这份内省的能力很珍贵...'
                    ]
                };
                
                const messages = sceneEncouragement[requestData.scene];
                if (messages) {
                    encouragements.push(messages[Math.floor(Math.random() * messages.length)]);
                }
            }
            
            if (requestData.moods && requestData.moods.length > 0) {
                const moodEncouragement = [
                    '你很诚实地表达了自己的情感需求，这种真诚很难得。情感没有对错，每一种感受都值得被温柔对待...',
                    '能够清楚地知道自己想要什么感觉，说明你很了解自己。这种自我认知是一种智慧...',
                    '你的情感很丰富，这让你的生活更有层次。让我用酒来回应你内心的每一个音符...'
                ];
                encouragements.push(moodEncouragement[Math.floor(Math.random() * moodEncouragement.length)]);
            }
            
            if (requestData.special_requirements) {
                const specialEncouragement = [
                    `你的特殊要求"${requestData.special_requirements}"很有意思，这说明你对自己的需求很明确。我欣赏这种坦诚...`,
                    `关于"${requestData.special_requirements}"这个要求，我能感受到你的用心。每个细节都体现了你对品质的追求...`
                ];
                encouragements.push(specialEncouragement[Math.floor(Math.random() * specialEncouragement.length)]);
            }
            
            if (encouragements.length === 0) {
                const defaultEncouragement = [
                    '虽然你没有说太多，但我能感受到你是一个有品味的人。有时候，简单就是最好的选择...',
                    '你的信任就是对我最大的鼓励。让我用我的专业和热情来回报这份信任...',
                    '每个人都有自己独特的品味，我相信你一定有着不凡的鉴赏力...'
                ];
                return defaultEncouragement[Math.floor(Math.random() * defaultEncouragement.length)];
            }
            
            return encouragements[Math.floor(Math.random() * encouragements.length)];
        }
        
        // 生成调酒师感悟 - 分享专业见解，建立情感连接
        function generateBartenderInsight(requestData) {
            const insights = [
                '在我多年的调酒经历中，我发现每个人都有属于自己的味觉记忆。有些人喜欢清淡如水的简单，有些人偏爱浓烈如火的激情...',
                '调酒其实是一门关于理解的艺术。不仅要理解酒的特性，更要理解人的心境。每一杯酒都承载着调酒师对客人的理解和关怀...',
                '我常常觉得，好的鸡尾酒就像一首诗，有着层次分明的韵律。从第一口的惊艳，到回味时的温柔，每一个瞬间都有它的意义...',
                '这些年来，我见过太多人带着不同的心情来到吧台。有人为了庆祝，有人为了忘却，有人只是想要一个安静的角落...',
                '真正的调酒师不只是在调制饮品，更是在调制情感。每一种配料的选择，都是对客人心境的回应...'
            ];
            
            // 根据用户选择添加个性化感悟
            if (requestData.scene === '浪漫晚餐') {
                const romanticInsights = [
                    '爱情是世界上最美的调味料，它能让最简单的酒变得甘甜。我见过无数对恋人在这里分享美好时光，每一次都让我相信爱情的力量...',
                    '浪漫不在于酒有多昂贵，而在于那份用心。我记得有一对情侣，他们只点了最简单的酒，但那种相视而笑的温柔，比任何珍贵的酒都要动人...'
                ];
                insights.push(...romanticInsights);
            }
            
            if (requestData.scene === '朋友聚会') {
                const friendshipInsights = [
                    '友谊是最珍贵的财富，我见过许多朋友在这里举杯相聚。真正的友谊就像陈年的威士忌，时间越久，味道越醇厚...',
                    '和朋友分享一杯酒，分享的不只是酒的味道，更是彼此的人生。我常常被那些真挚的友情所感动...'
                ];
                insights.push(...friendshipInsights);
            }
            
            if (requestData.scene === '独自放松') {
                const solitudeInsights = [
                    '独处是一种勇气，也是一种智慧。我很欣赏那些能够享受独处时光的人，他们往往有着丰富的内心世界...',
                    '一个人品酒需要的不是孤独，而是与自己的对话。在安静的时刻，我们能听到内心最真实的声音...'
                ];
                insights.push(...solitudeInsights);
            }
            
            return insights[Math.floor(Math.random() * insights.length)];
        }
        
        // 生成期待感 - 营造揭秘前的氛围
        function generateAnticipation(requestData) {
            const anticipationTexts = [
                '现在，让我为你揭开今晚的惊喜。我精心挑选了三款鸡尾酒，每一款都有它独特的故事和魅力...',
                '经过深思熟虑，我为你准备了三个选择。它们就像三种不同的人生体验，等待着你去发现...',
                '我的直觉告诉我，这三款酒中一定有一款会深深打动你。让我们一起来看看它们吧...',
                '三款特别调制的鸡尾酒即将登场，每一款都承载着我对你的理解和祝福...',
                '准备好迎接惊喜了吗？这三杯酒不仅仅是饮品，更是我想要与你分享的故事...'
            ];
            
            // 根据用户选择添加个性化期待
            if (requestData.scene) {
                const sceneAnticipation = {
                    '浪漫晚餐': [
                        '为了这个浪漫的夜晚，我特别选择了三款能够增添爱意的鸡尾酒。它们将为你们的晚餐增添更多甜蜜...',
                        '爱情需要仪式感，这三杯酒就是我为你们准备的浪漫见证...'
                    ],
                    '朋友聚会': [
                        '友谊值得庆祝，这三款酒将为你们的聚会带来更多欢声笑语...',
                        '好朋友配好酒，让这三杯特调为你们的友谊干杯...'
                    ],
                    '独自放松': [
                        '独处的时光需要好酒相伴，这三款精选将陪伴你度过美好的夜晚...',
                        '给自己一个完美的夜晚，这三杯酒是我对你的温柔关怀...'
                    ]
                };
                
                const sceneTexts = sceneAnticipation[requestData.scene];
                if (sceneTexts) {
                    anticipationTexts.push(...sceneTexts);
                }
            }
            
            return anticipationTexts[Math.floor(Math.random() * anticipationTexts.length)];
        }
        
        // 生成串联故事 - 将用户选择串联成温暖的小故事（控制在两行内）
        function generateConnectedStory(requestData) {
            const scene = requestData.scene;
            const moods = requestData.moods && requestData.moods.length > 0 ? requestData.moods.join('、') : null;
            const special = requestData.special_requirements;
            
            // 根据不同组合生成串联故事
            if (scene && moods) {
                const stories = {
                    '浪漫晚餐': [
                        `在这个浪漫的夜晚，你想要${moods}的感觉...我能想象烛光下你们温柔的笑容`,
                        `浪漫晚餐配上${moods}的心境，这样的夜晚值得用最美的酒来纪念`
                    ],
                    '朋友聚会': [
                        `和朋友聚会时想要${moods}的感觉，这份真挚的友情让人感动`,
                        `朋友间的${moods}时光总是珍贵，让我为这份友谊调制特别的酒`
                    ],
                    '独自放松': [
                        `独处时想要${moods}的感觉，这样安静的时光很珍贵`,
                        `一个人的${moods}时光也很美好，让我陪你度过这个夜晚`
                    ]
                };
                
                const sceneStories = stories[scene] || [`在${scene}时想要${moods}的感觉，我完全理解你的心境`];
                return sceneStories[Math.floor(Math.random() * sceneStories.length)];
            }
            
            if (scene) {
                const sceneStories = {
                    '浪漫晚餐': '浪漫的晚餐时光，每一个细节都值得用心对待',
                    '朋友聚会': '和朋友在一起的时光总是那么温暖珍贵',
                    '独自放松': '独处的时光同样美好，这是与自己对话的时刻'
                };
                return sceneStories[scene] || `${scene}的时光很特别，我想为你调制合适的酒`;
            }
            
            if (moods) {
                return `想要${moods}的感觉...我能感受到你此刻的心境`;
            }
            
            if (special) {
                return `你的特别要求"${special}"让我印象深刻，我会用心满足你的需求`;
            }
            
            return '虽然你没说太多，但我能感受到你内心的期待';
        }
        
        // 生成共鸣理解 - 调酒师的温暖理解（控制在两行内）
        function generateEmpathy(requestData) {
            const empathyTexts = [
                '每个人都有属于自己的故事，我想用一杯好酒来回应你的心情',
                '调酒不只是技艺，更是一种理解和陪伴的艺术',
                '好的鸡尾酒就像温暖的拥抱，能够抚慰人心',
                '我相信每一杯用心调制的酒，都能传递温暖和理解'
            ];
            
            // 根据场景添加个性化理解
            if (requestData.scene === '浪漫晚餐') {
                empathyTexts.push('爱情需要仪式感，让我为你们的浪漫时光增添甜蜜');
            } else if (requestData.scene === '朋友聚会') {
                empathyTexts.push('真正的友谊值得庆祝，让我为你们的友情干杯');
            } else if (requestData.scene === '独自放松') {
                empathyTexts.push('独处是一种智慧，我很欣赏你懂得享受这样的时光');
            }
            
            return empathyTexts[Math.floor(Math.random() * empathyTexts.length)];
        }
        
        // 生成最终期待 - 简洁的揭晓前奏（控制在两行内）
        function generateFinalAnticipation(requestData) {
            const anticipationTexts = [
                '现在，让我为你揭晓今晚的惊喜...三杯特别的鸡尾酒',
                '准备好了吗？我为你精心挑选了三款不同风格的酒',
                '基于我对你的理解，这三杯酒一定有一款会打动你',
                '让我为你呈现三杯承载着温暖和理解的鸡尾酒'
            ];
            
            return anticipationTexts[Math.floor(Math.random() * anticipationTexts.length)];
        }
        
        // 生成阶段2文本 - 思考分析
        function generateStage2Text(requestData) {
            const analysisTexts = [
                '让我仔细分析你的需求...每种心情都有它专属的味道',
                '基于你的选择，我开始构思完美的配方组合',
                '你的偏好让我想起了几种经典的调酒技法',
                '从你的描述中，我感受到了一种特别的氛围',
                '让我用我的专业经验来解读你内心的渴望'
            ];
            
            // 根据具体选择添加个性化分析
            if (requestData.scene) {
                const sceneAnalysis = [
                    `${requestData.scene}的氛围需要温柔的口感...`,
                    `在${requestData.scene}时，酒精度要恰到好处...`,
                    `${requestData.scene}这个场景让我想到了某种特别的香气...`
                ];
                return sceneAnalysis[Math.floor(Math.random() * sceneAnalysis.length)];
            }
            
            return analysisTexts[Math.floor(Math.random() * analysisTexts.length)];
        }
        
        // 生成阶段3文本 - 期待铺垫
        function generateStage3Text(requestData) {
            const expectationTexts = [
                '基于你的需求，我想到了三种完美的搭配...',
                '我已经有了灵感！三杯不同风格的鸡尾酒正在我脑海中成形',
                '让我为你精心调制三杯特别的酒...每一杯都有它的故事',
                '三种不同的可能性...我相信其中一杯会完美契合你的心境',
                '准备好了吗？我要为你呈现三杯承载着我理解的鸡尾酒'
            ];
            return expectationTexts[Math.floor(Math.random() * expectationTexts.length)];
        }
        
        // 故事文字打字机效果
        async function typewriterStoryText(element, text, speed = 60) {
            element.textContent = '';
            element.style.borderRight = '2px solid var(--forest-green)';
            
            for (let i = 0; i < text.length; i++) {
                element.textContent += text[i];
                
                // 标点符号后稍作停顿
                if (text[i] === '，' || text[i] === '。' || text[i] === '...') {
                    await new Promise(resolve => setTimeout(resolve, speed * 3));
                } else {
                    await new Promise(resolve => setTimeout(resolve, speed));
                }
            }
            
            // 移除光标
            setTimeout(() => {
                element.style.borderRight = 'none';
            }, 1000);
        }
        
        // 只获取推荐的API调用
        async function getRecommendationsOnly(requestData) {
            console.log('🍸 调用推荐API...');
            
            return new Promise((resolve, reject) => {
                fetch('https://shaker-cocktail-app-production.up.railway.app/api/stream-recommendation', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Accept': 'text/event-stream',
                        'Cache-Control': 'no-cache'
                    },
                    body: JSON.stringify(requestData)
                })
                .then(response => {
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    
                    const reader = response.body.getReader();
                    const decoder = new TextDecoder();
                    const recommendations = [];
                    
                    function readStream() {
                        return reader.read().then(({ done, value }) => {
                            if (done) {
                                console.log('✅ 推荐API调用完成');
                                resolve(recommendations);
                                return;
                            }
                            
                            const chunk = decoder.decode(value);
                            const lines = chunk.split('\n');
                            
                            for (const line of lines) {
                                if (line.startsWith('data: ')) {
                                    try {
                                        const data = JSON.parse(line.slice(6));
                                        
                                        if (data.type === 'recommendation') {
                                            // 从 data.content.recommendations 中提取推荐数据
                                            if (data.content && data.content.recommendations && data.content.recommendations.length > 0) {
                                                const recommendation = data.content.recommendations[0];
                                                recommendations.push(recommendation);
                                                console.log(`🍸 收到推荐 ${recommendations.length}:`, recommendation.name?.chinese || recommendation.name);
                                            }
                                        }
                                        
                                        if (data.type === 'complete') {
                                            console.log('✅ 推荐完成，共收到:', recommendations.length);
                                            resolve(recommendations);
                                            return;
                                        }
                                    } catch (e) {
                                        console.warn('解析数据失败:', line);
                                    }
                                }
                            }
                            
                            return readStream();
                        });
                    }
                    
                    return readStream();
                })
                .catch(error => {
                    console.error('❌ 推荐API调用失败:', error);
                    reject(error);
                });
            });
        }
        
                // 依次翻卡片展示推荐结果
        async function showRecommendationsSequentially(recommendations) {
            console.log('🃏 开始翻卡片展示推荐结果，共', recommendations.length, '个推荐');
            
            if (!recommendations || recommendations.length === 0) {
                console.error('❌ 没有推荐数据');
                return;
            }
            
            // 更新标题
            const makingTitle = document.querySelector('#cocktailMakingSection .section-title');
            if (makingTitle) {
                makingTitle.textContent = '为你推荐的鸡尾酒';
            }
            
                        // 依次展示每张卡片
            for (let i = 0; i < Math.min(recommendations.length, 3); i++) {
                const recommendation = recommendations[i];
                console.log(`🍸 开始展示第${i + 1}张卡片:`, recommendation.name?.chinese || recommendation.chinese || recommendation.name);
                
                // 每张卡片延迟展示，营造逐个揭晓的效果
                setTimeout(async () => {
                await showSimpleRecommendation(recommendation, i);
                }, i * 2000); // 每张卡片间隔2秒
            }
            
            console.log('✅ 所有卡片翻开完成');
        }

        // 简单展示推荐（无复杂动画）
        async function showSimpleRecommendation(recommendation, index) {
            console.log(`🍸 展示简单推荐 ${index + 1}:`, recommendation);
            
            // 如果推荐数据为空，使用备用数据
            if (!recommendation || typeof recommendation !== 'object') {
                console.warn('⚠️ 推荐数据为空，使用备用数据:', index);
                const fallbackNames = ['经典马提尼', '威士忌酸', '莫吉托'];
                const fallbackEnNames = ['Classic Martini', 'Whiskey Sour', 'Mojito'];
                recommendation = {
                    name: { chinese: fallbackNames[index], english: fallbackEnNames[index] },
                    reason: '根据你的选择为你特别推荐',
                    ingredients: ['基酒', '调味料', '装饰'],
                    taste_profile: '口感平衡，适合品尝',
                    alcohol_content: '适中(约20%)',
                    prep_time: '3分钟',
                    difficulty: '简单'
                };
            }
            
            // 确保卡片存在
            let cardElement = document.getElementById(`makingCard${index}`);
            
            if (!cardElement) {
                console.warn('⚠️ 卡片元素不存在，重新创建:', index);
                const makingGrid = document.getElementById('makingGrid');
                cardElement = createMakingCard(index);
                makingGrid.appendChild(cardElement);
            }
            
            // 1. 开始简单进度条
            startSimpleProgress(index);
            
            // 2. 快速完成进度条（1秒）
            await new Promise(resolve => {
                setTimeout(() => {
                    completeSimpleProgress(index);
                    resolve();
                }, 1000); // 1秒完成
            });
            
            // 3. 直接切换显示内容（无翻转动画）
            switchToContent(index);
            
            // 4. 填充推荐内容
            fillRecommendationContent(recommendation, index);
            
            // 5. 强制确保内容可见（备用方案）
            setTimeout(() => {
                const contentArea = document.getElementById(`recommendationContent${index}`);
                if (contentArea) {
                    contentArea.style.display = 'flex';
                    contentArea.style.opacity = '1';
                    contentArea.style.visibility = 'visible';
                    contentArea.classList.add('visible'); // 添加visible类以显示子元素
                    console.log(`🔧 强制显示内容区域 ${index}`);
                }
            }, 100);
        }

        // 打字机效果展示推荐内容（简洁版）
        async function displayRecommendationWithTypewriter(recommendation, index) {
            console.log(`🎨 打字机展示推荐内容 ${index}:`, recommendation);
            
            const contentArea = document.getElementById(`recommendationContent${index}`);
            
            if (!contentArea) {
                console.error('❌ 内容区域不存在:', index);
                return;
            }
            
            // 显示内容区域
            contentArea.style.display = 'block';
            contentArea.style.opacity = '1';
            
            // 解析推荐数据
            const cocktailNameCn = recommendation.name?.chinese || recommendation.chinese || '神秘鸡尾酒';
            const cocktailNameEn = recommendation.name?.english || recommendation.english || 'Mystery Cocktail';
            const reason = recommendation.reason || '为你特别调制';
            const ingredients = recommendation.recipe?.ingredients || recommendation.ingredients || [];
            const tasteProfile = recommendation.taste_profile || '口感独特，值得品尝';
            const prepTime = recommendation.prep_time || '5分钟';
            const difficulty = recommendation.recipe?.difficulty || recommendation.difficulty || '简单';
            // 优化酒精度显示
            let alcoholContent = recommendation.alcohol_content || '中度(约15%)';
            if (alcoholContent.includes('适中')) {
                alcoholContent = alcoholContent.replace('适中', '中度');
            }
            if (!alcoholContent.includes('%') && !alcoholContent.includes('度')) {
                alcoholContent = `${alcoholContent}(约15%)`;
            }
            
            // 更新底部酒精度信息
            const alcoholInfo = document.getElementById(`alcoholContent${index}`);
            if (alcoholInfo) {
                alcoholInfo.textContent = alcoholContent;
            }
            
            // 逐个展示元素（简洁版，更快节奏）
            await typewriterElement(`nameCn${index}`, cocktailNameCn, 60);
            await new Promise(resolve => setTimeout(resolve, 200));
            
            await typewriterElement(`nameEn${index}`, cocktailNameEn, 50);
            await new Promise(resolve => setTimeout(resolve, 300));
            
            await typewriterElement(`reason${index}`, reason, 50);
            await new Promise(resolve => setTimeout(resolve, 300));
            
            // 展示材料标签
            await displayIngredientTags(ingredients, index);
            await new Promise(resolve => setTimeout(resolve, 300));
            
            await typewriterElement(`taste${index}`, tasteProfile, 50);
            await new Promise(resolve => setTimeout(resolve, 300));
            
            // 展示制作信息
            await displayCocktailInfo(prepTime, difficulty, index);
            await new Promise(resolve => setTimeout(resolve, 200));
            
            // 最后显示查看详情按钮
            await displayActionButton(recommendation, index);
            
            // 添加点击事件监听器
            const card = document.getElementById(`makingCard${index}`);
            if (card) {
                card.addEventListener('click', () => {
                    // 简单的详情展示
                    alert(`${recommendation.name?.chinese || recommendation.chinese}\n\n${recommendation.reason}\n\n材料：${(recommendation.recipe?.ingredients || []).map(ing => typeof ing === 'string' ? ing : `${ing.name} ${ing.amount || ''}`).join('、')}`);
                });
            }
            
            // 添加可见类
            contentArea.classList.add('visible');
        }
        
        // 打字机效果显示单个元素
        async function typewriterElement(elementId, text, speed = 60) {
            const element = document.getElementById(elementId);
            if (!element) return;
            
            element.textContent = '';
            for (let i = 0; i < text.length; i++) {
                element.textContent += text[i];
                await new Promise(resolve => setTimeout(resolve, speed));
            }
        }
        
                // 展示材料标签
        async function displayIngredientTags(ingredients, index) {
            const container = document.getElementById(`ingredients${index}`);
            if (!container) return;
            
                container.innerHTML = '';
                
            for (let i = 0; i < Math.min(ingredients.length, 5); i++) {
                const ingredient = ingredients[i];
                const ingredientName = typeof ingredient === 'string' ? ingredient : ingredient.name || ingredient;
                const ingredientAmount = typeof ingredient === 'object' ? ingredient.amount : '';
                
                const tag = document.createElement('span');
                tag.className = 'ingredient-tag';
                tag.textContent = ingredientAmount ? `${ingredientName} ${ingredientAmount}` : ingredientName;
                tag.style.opacity = '0';
                tag.style.transform = 'translateY(10px) scale(0.9)';
                
                container.appendChild(tag);
                
                // 动画显示
                setTimeout(() => {
                    tag.style.transition = 'all 0.4s cubic-bezier(0.4, 0, 0.2, 1)';
                    tag.style.opacity = '1';
                    tag.style.transform = 'translateY(0) scale(1)';
                }, i * 150);
                
                await new Promise(resolve => setTimeout(resolve, 200));
            }
        }
        
        // 展示制作信息
        async function displayCocktailInfo(prepTime, difficulty, index) {
            const container = document.getElementById(`info${index}`);
            if (!container) return;
            
            container.innerHTML = `
                <div class="info-item">
                    <span class="info-icon">⏰</span>
                    <div class="info-label">制作时间</div>
                    <div class="info-value">${prepTime}</div>
                </div>
                <div class="info-item">
                    <span class="info-icon">📊</span>
                    <div class="info-label">难度</div>
                    <div class="info-value">${difficulty}</div>
                </div>
            `;
            
            // 动画显示
            const items = container.querySelectorAll('.info-item');
            items.forEach((item, i) => {
                item.style.opacity = '0';
                item.style.transform = 'translateY(10px)';
                setTimeout(() => {
                    item.style.transition = 'all 0.3s ease';
                    item.style.opacity = '1';
                    item.style.transform = 'translateY(0)';
                }, i * 150);
            });
        }
        
        // 展示查看详情按钮
        async function displayActionButton(recommendation, index) {
            const container = document.getElementById(`actionButton${index}`);
            if (!container) return;
            
            const button = document.createElement('button');
            button.className = 'view-details-btn';
            button.textContent = '查看详情';
            button.style.opacity = '0';
            button.style.transform = 'translateY(10px)';
            
            button.onclick = () => {
                // 简单的详情展示
                alert(`${recommendation.name?.chinese || recommendation.chinese}\n\n${recommendation.reason}\n\n材料：${(recommendation.recipe?.ingredients || []).map(ing => typeof ing === 'string' ? ing : `${ing.name} ${ing.amount || ''}`).join('、')}`);
            };
            
            container.appendChild(button);
            
            // 动画显示
            setTimeout(() => {
                button.style.transition = 'all 0.4s ease';
                button.style.opacity = '1';
                button.style.transform = 'translateY(0)';
            }, 100);
        }

        // 推荐内容的打字机效果
        async function typewriterRecommendationContent(element, content) {
            const { cocktailName, englishName, reason, ingredientText } = content;
            
            // 创建内容结构
            element.innerHTML = `
                <div class="cocktail-name" style="font-size: 1.5rem; font-weight: bold; margin-bottom: 0.5rem; color: var(--primary-color);"></div>
                <div class="cocktail-name-en" style="font-size: 1rem; opacity: 0.7; margin-bottom: 1rem; font-style: italic;"></div>
                <div class="cocktail-reason" style="margin-bottom: 1rem; font-style: italic; color: var(--text-secondary); line-height: 1.6;"></div>
                <div class="cocktail-recipe" style="font-size: 0.9rem; color: var(--text-muted); line-height: 1.5;"></div>
            `;
            
            const nameEl = element.querySelector('.cocktail-name');
            const nameEnEl = element.querySelector('.cocktail-name-en');
            const reasonEl = element.querySelector('.cocktail-reason');
            const recipeEl = element.querySelector('.cocktail-recipe');
            
            // 依次打字显示每个部分
            await typewriterText(nameEl, cocktailName, 60);
            await new Promise(resolve => setTimeout(resolve, 300));
            
            await typewriterText(nameEnEl, englishName, 50);
            await new Promise(resolve => setTimeout(resolve, 500));
            
            await typewriterText(reasonEl, reason, 80);
            await new Promise(resolve => setTimeout(resolve, 400));
            
            await typewriterText(recipeEl, `配方: ${ingredientText}`, 70);
        }

        // 通用打字机效果
        async function typewriterText(element, text, speed = 60) {
            element.textContent = '';
            
            for (let i = 0; i <= text.length; i++) {
                element.textContent = text.slice(0, i);
                
                const char = text[i - 1];
                let currentSpeed = speed;
                
                // 标点符号停顿
                if (char === '，' || char === '、') {
                    currentSpeed = speed * 2;
                } else if (char === '。' || char === '！' || char === '？') {
                    currentSpeed = speed * 3;
                }
                
                await new Promise(resolve => setTimeout(resolve, currentSpeed));
            }
        }

        // 优化推荐结果展示（保留备用）
        async function showRecommendations(recommendations) {
            console.log('🎉 开始展示推荐结果，共', recommendations.length, '个推荐');
            
            if (!recommendations || recommendations.length === 0) {
                console.error('❌ 没有推荐数据');
                return;
            }
            
            // 更新标题
            const makingTitle = document.querySelector('#cocktailMakingSection .section-title');
            if (makingTitle) {
                makingTitle.textContent = '为你推荐的鸡尾酒';
            }
            
            // 逐个显示推荐结果
            for (let i = 0; i < Math.min(recommendations.length, 3); i++) {
                const recommendation = recommendations[i];
                console.log(`🍸 显示第${i + 1}个推荐:`, recommendation.name || recommendation.chinese);
                
                // 延迟显示，营造逐个揭晓的效果
                setTimeout(() => {
                    displayRecommendationCard(recommendation, i);
                }, i * 1000);
            }
            
            console.log('✅ 推荐结果展示完成');
        }
        
        // 显示单个推荐
        async function displaySingleRecommendation(recommendation, index) {
            const container = document.getElementById('recommendationContainer');
            if (!container) return;
            
            const card = document.createElement('div');
            card.className = 'recommendation-card';
            card.innerHTML = `
                <div class="recommendation-header">
                    <h3 class="recommendation-name">${recommendation.name}</h3>
                    <div class="recommendation-tags">
                        ${recommendation.tags ? recommendation.tags.map(tag => `<span class="tag">${tag}</span>`).join('') : ''}
                    </div>
                </div>
                <div class="recommendation-content">
                    <p class="recommendation-description">${recommendation.description}</p>
                    <div class="recommendation-details">
                        <div class="ingredients">
                            <h4>配料：</h4>
                            <ul>
                                ${recommendation.ingredients ? recommendation.ingredients.map(ing => `<li>${ing}</li>`).join('') : ''}
                            </ul>
                        </div>
                        <div class="preparation">
                            <h4>调制方法：</h4>
                            <p>${recommendation.preparation || '经典调制'}</p>
                        </div>
                    </div>
                </div>
            `;
            
            // 添加入场动画
            card.style.opacity = '0';
            card.style.transform = 'translateY(30px)';
            container.appendChild(card);
            
            // 触发动画
            setTimeout(() => {
                card.style.transition = 'all 0.6s ease-out';
                card.style.opacity = '1';
                card.style.transform = 'translateY(0)';
            }, 100);
        }

        // Shaker思考泡泡展示
        async function showThoughtBubbles(requestData) {
            console.log('💭 开始Shaker思考泡泡展示');
            
            // 生成思考泡泡数据
            const bubbles = thoughtBubbleGenerator.generateBubbles(requestData);
            console.log('💭 生成泡泡数量:', bubbles.length);
            
            // 显示分析区域
            showSection('shakerAnalysisSection');
            
            // 更新底部文字，根据用户选择内容变化（已移到后续流程中）
            // updateAnalysisTitle(requestData);
            
            // 获取泡泡容器
            const container = document.getElementById('thoughtBubblesContainer');
            
            if (!container) {
                console.error('❌ 找不到思考泡泡容器');
                return;
            }
            
            // 清空容器
            container.innerHTML = '';
            
            // 逐个展示思考泡泡（恢复之前的同时展示效果，但优化时间）
            for (let i = 0; i < bubbles.length; i++) {
                const bubbleData = bubbles[i];
                console.log(`💭 展示第${i + 1}个泡泡: ${bubbleData.title}`);
                
                // 创建泡泡元素
                const bubbleElement = createThoughtBubbleElement(bubbleData);
                container.appendChild(bubbleElement);
                
                // 延迟显示动画（间隔显示）
                setTimeout(() => {
                    bubbleElement.classList.add('show');
                }, i * 800 + 500);
                
                // 添加打字机效果（延长阅读时间）
                setTimeout(async () => {
                    const contentElement = bubbleElement.querySelector('.thought-bubble-content');
                    const originalText = contentElement.getAttribute('data-text');
                    await typewriterEffect(contentElement, originalText, 100); // 适中的打字速度
                }, i * 800 + 1500);
                
                // 等待当前泡泡完成（延长停留时间让用户看完）
                await new Promise(resolve => setTimeout(resolve, 3500)); // 增加到3.5秒
            }
            
            // 所有泡泡显示完毕，停留更久让用户充分阅读
            await new Promise(resolve => setTimeout(resolve, 5000)); // 延长到5秒
            
            // 逐个隐藏泡泡（更慢的隐藏节奏）
            const bubbleElements = container.querySelectorAll('.thought-bubble');
            for (let i = 0; i < bubbleElements.length; i++) {
                setTimeout(() => {
                    bubbleElements[i].classList.add('hide');
                }, i * 400);
            }
            
            // 等待所有泡泡隐藏完毕
            await new Promise(resolve => setTimeout(resolve, bubbleElements.length * 400 + 800));
            
            console.log('✅ 思考泡泡展示完毕');
            return { completed: true, bubbleCount: bubbles.length };
        }

        // 创建思考泡泡元素 - 简洁森林版本
        function createThoughtBubbleElement(bubbleData) {
            const bubble = document.createElement('div');
            bubble.className = `thought-bubble position-${bubbleData.position}`;
            bubble.innerHTML = `
                <div class="thought-bubble-header">
                    <span class="thought-bubble-icon">${bubbleData.icon}</span>
                    <h4 class="thought-bubble-title">${bubbleData.title}</h4>
                </div>
                <p class="thought-bubble-content ${bubbleData.isEmpty ? 'empty' : ''}" data-text="${bubbleData.content}"></p>
            `;
            
            return bubble;
        }



        // 温暖的打字机效果（用于泡泡）
        async function typewriterEffect(element, text, speed = 50) {
            element.textContent = '';
            element.style.position = 'relative';
            
            // 添加光标
            const cursor = document.createElement('span');
            cursor.style.cssText = `
                display: inline-block;
                width: 2px;
                height: 1.2em;
                background: linear-gradient(to bottom, #228B22, #32CD32);
                margin-left: 2px;
                animation: cursorBlink 1s infinite;
                border-radius: 1px;
            `;
            element.appendChild(cursor);
            
            for (let i = 0; i <= text.length; i++) {
                const char = text[i];
                element.textContent = text.slice(0, i);
                element.appendChild(cursor);
                
                // 为标点符号添加更长的停顿
                let currentSpeed = speed;
                if (char === '。' || char === '！' || char === '？') {
                    currentSpeed = speed * 2;
                } else if (char === '，' || char === '、') {
                    currentSpeed = speed * 1.5;
                } else if (char === '...' || char === '…') {
                    currentSpeed = speed * 3;
                }
                
                // 随机添加一些"思考"停顿
                if (Math.random() < 0.1) {
                    currentSpeed = speed * 2;
                }
                
                await new Promise(resolve => setTimeout(resolve, currentSpeed));
            }
            
            // 移除光标
            setTimeout(() => {
                if (cursor.parentNode) {
                    cursor.remove();
                }
            }, 1000);
        }

        // 高级回顾卡片展示
        async function showReviewCards(requestData) {
            console.log('🎴 开始高级回顾卡片展示');
            
            // 生成卡片数据
            const cards = reviewCardGenerator.generateCards(requestData);
            console.log('🎴 生成卡片数量:', cards.length);
            
            // 直接显示分析区域（回顾卡片在分析区域内）
            showSection('shakerAnalysisSection');
            
            // 获取容器
            const container = document.getElementById('reviewCardsContainer');
            
            if (!container) {
                console.error('❌ 找不到回顾卡片容器');
                return;
            }
            
            // 显示容器
            container.style.display = 'block';
            
            // 清空容器
            container.innerHTML = '';
            
            // 提前显示摘要区域（为飘移做准备）
            const summaryArea = document.getElementById('choicesSummary');
            if (summaryArea) {
                summaryArea.style.display = 'block';
                setTimeout(() => {
                    summaryArea.classList.add('show');
                }, 100);
            }
            
            // 逐个展示每张卡片
            for (let i = 0; i < cards.length; i++) {
                const cardData = cards[i];
                console.log(`🎴 展示第${i + 1}张卡片: ${cardData.title}`);
                
                // 创建当前卡片
                const cardElement = createReviewCardElement(cardData);
                container.appendChild(cardElement);
                
                // 延迟一下让DOM更新
                await new Promise(resolve => setTimeout(resolve, 50));
                
                // 播放进入动画
                cardElement.classList.add('entering');
                
                // 等待进入动画完成
                await new Promise(resolve => setTimeout(resolve, 800));
                
                // 开始温暖的回忆效果
                const titleElement = cardElement.querySelector('.review-card-title');
                const contentElement = cardElement.querySelector('.review-card-content');
                
                const titleText = titleElement.getAttribute('data-text');
                const contentText = contentElement.getAttribute('data-text');
                
                // 温暖地显示标题
                await warmTitleReveal(titleElement, titleText);
                
                // 短暂停顿
                await new Promise(resolve => setTimeout(resolve, 300));
                
                // 真正的打字机效果
                await realTypewriterEffect(contentElement, contentText, 70);
                
                // 适度的阅读时间
                await new Promise(resolve => setTimeout(resolve, 800));
                
                // 所有卡片都飘移到摘要区域（除了最后一张，最后一张单独处理）
                if (i < cards.length - 1) {
                    // 飘移到摘要区域
                    await floatCardToSummary(cardElement, cardData);
                    
                    // 短暂间隔
                    await new Promise(resolve => setTimeout(resolve, 300));
                }
            }
            
            // 最后一张卡片的特殊处理 - 飘移到摘要区域
            const lastCard = container.querySelector('.review-card');
            if (lastCard) {
                // 额外停留时间
                await new Promise(resolve => setTimeout(resolve, 800));
                
                // 获取最后一张卡片的数据
                const lastCardData = cards[cards.length - 1];
                
                // 飘移到摘要区域
                await floatCardToSummary(lastCard, lastCardData);
            }
            
            console.log('✅ 高级回顾卡片展示完毕');
            return { completed: true, cardCount: cards.length };
        }

        // 创建回顾卡片元素
        function createReviewCardElement(cardData) {
            const card = document.createElement('div');
            card.className = 'review-card';
            card.setAttribute('data-card-type', cardData.type);
            card.innerHTML = `
                <div class="review-card-header">
                    <span class="review-card-icon">${cardData.icon}</span>
                    <h3 class="review-card-title" data-text="${cardData.title}"></h3>
                </div>
                <p class="review-card-content ${cardData.isEmpty ? 'empty' : ''}" data-text="${cardData.content}"></p>
            `;
            return card;
        }

        // 创建摘要卡片
        function createSummaryCard(cardData) {
            const summaryCard = document.createElement('div');
            summaryCard.className = 'summary-card';
            summaryCard.innerHTML = `
                <span class="summary-card-icon">${cardData.icon}</span>
                <span class="summary-card-content" title="${cardData.content}">${cardData.content}</span>
            `;
            return summaryCard;
        }

        // 卡片飘移到摘要区域
        async function floatCardToSummary(cardElement, cardData) {
            console.log('🎈 开始飘移卡片:', cardData.title);
            
            // 获取目标位置
            const summaryArea = document.getElementById('summaryCards');
            if (!summaryArea) {
                console.error('❌ 找不到摘要区域');
                return;
            }
            
            // 获取卡片当前位置
            const cardRect = cardElement.getBoundingClientRect();
            const summaryRect = summaryArea.getBoundingClientRect();
            
            // 设置卡片为固定定位，保持当前位置
            cardElement.classList.add('floating');
            cardElement.style.position = 'fixed';
            cardElement.style.top = cardRect.top + 'px';
            cardElement.style.left = cardRect.left + 'px';
            cardElement.style.width = cardRect.width + 'px';
            cardElement.style.height = cardRect.height + 'px';
            
            // 延迟一下让样式生效
            await new Promise(resolve => setTimeout(resolve, 100));
            
            // 使用CSS动画向上飘移
            cardElement.classList.add('floating-up');
            
            console.log('🎈 开始向上飘移动画');
            
            // 等待飘移动画完成
            await new Promise(resolve => setTimeout(resolve, 1500));
            
            // 在摘要区域创建简化版卡片
            const summaryCard = createSummaryCard(cardData);
            summaryArea.appendChild(summaryCard);
            
            // 移除原卡片
            cardElement.remove();
            
            console.log('✅ 卡片飘移完成');
        }

        // 温暖的标题显示效果
        async function warmTitleReveal(element, text) {
            element.textContent = text;
            element.classList.add('warm-reveal');
            
            // 等待动画完成
            await new Promise(resolve => setTimeout(resolve, 1200));
        }

        // 真正的打字机效果 - 从左到右逐字显示
        async function realTypewriterEffect(element, text, speed = 80) {
            element.innerHTML = '';
            element.classList.add('real-typing', 'typing-container');
            
            // 创建光标
            const cursor = document.createElement('span');
            cursor.className = 'typing-cursor';
            element.appendChild(cursor);
            
            // 逐字显示
            for (let i = 0; i < text.length; i++) {
                const char = text[i];
                const charSpan = document.createElement('span');
                charSpan.className = 'typing-text';
                charSpan.textContent = char;
                
                // 在光标前插入字符
                element.insertBefore(charSpan, cursor);
                
                // 延迟显示字符
                await new Promise(resolve => setTimeout(resolve, 50));
                charSpan.classList.add('visible');
                
                // 根据字符类型调整速度
                let currentSpeed = speed;
                if (char === '，' || char === '。' || char === '！' || char === '？') {
                    currentSpeed = speed * 2.5; // 标点符号后停顿更久
                } else if (char === ' ') {
                    currentSpeed = speed * 0.3; // 空格快一些
                } else if (Math.random() < 0.15) {
                    currentSpeed = speed * 1.8; // 随机停顿，模拟思考
                }
                
                await new Promise(resolve => setTimeout(resolve, currentSpeed));
            }
            
            // 保持光标闪烁一会儿
            await new Promise(resolve => setTimeout(resolve, 800));
            
            // 移除光标
            cursor.remove();
            element.classList.remove('real-typing');
        }

        // 逐字温暖打字效果（备用方案）
        async function slowWarmTyping(element, text, speed = 150) {
            element.textContent = '';
            element.style.borderRight = '2px solid rgba(143, 188, 143, 0.6)';
            
            // 添加随机的停顿，模拟回忆的感觉
            for (let i = 0; i <= text.length; i++) {
                element.textContent = text.slice(0, i);
                
                // 在标点符号处稍作停顿
                const currentChar = text[i - 1];
                let currentSpeed = speed;
                
                if (currentChar === '，' || currentChar === '。' || currentChar === '、') {
                    currentSpeed = speed * 2; // 标点符号后停顿更久
                } else if (currentChar === ' ') {
                    currentSpeed = speed * 0.5; // 空格处稍快
                } else if (Math.random() < 0.1) {
                    currentSpeed = speed * 1.5; // 随机停顿，模拟思考
                }
                
                await new Promise(resolve => setTimeout(resolve, currentSpeed));
            }
            
            // 移除光标
            setTimeout(() => {
                element.style.borderRight = 'none';
            }, 800);
        }

        // 智能分行函数
        function smartLineBreak(text, maxLength) {
            const words = text.split(' ');
            const lines = [];
            let currentLine = '';
            
            for (const word of words) {
                if ((currentLine + word).length <= maxLength) {
                    currentLine += (currentLine ? ' ' : '') + word;
                } else {
                    if (currentLine) {
                        lines.push(currentLine);
                        currentLine = word;
                    } else {
                        lines.push(word);
                    }
                }
            }
            
            if (currentLine) {
                lines.push(currentLine);
            }
            
            return lines;
        }

        // 显示本地预分析
        async function showLocalAnalysis(requestData) {
            console.log('⚡ 显示本地预分析');
            
            // 更新标题
            const analysisTitle = document.getElementById('analysisTitle');
            if (analysisTitle) {
                analysisTitle.textContent = 'Shaker正在理解你的需求...';
            }
            
            // 生成本地分析
            const segments = localAnalysis.generateLocalAnalysis(requestData);
            
            // 获取分段容器
            const segmentsContainer = document.getElementById('analysisSegments');
            if (!segmentsContainer) {
                console.error('❌ 找不到分段容器');
                return;
            }
            
            // 清空容器
            segmentsContainer.innerHTML = '';
            
            // 添加本地分析标识
            const badge = document.createElement('div');
            badge.className = 'local-analysis-badge';
            badge.textContent = '即时分析';
            segmentsContainer.appendChild(badge);
            
            // 逐个显示分段
            for (let i = 0; i < segments.length; i++) {
                const segment = segments[i];
                
                // 创建分段元素
                const segmentElement = document.createElement('div');
                segmentElement.className = 'analysis-segment';
                segmentElement.innerHTML = `
                    <div class="segment-header">
                        <span class="segment-icon">${segment.icon}</span>
                        <h3 class="segment-title">${segment.title}</h3>
                    </div>
                    <p class="segment-content">${segment.content}</p>
                `;
                
                segmentsContainer.appendChild(segmentElement);
                
                // 延迟显示动画
                setTimeout(() => {
                    segmentElement.classList.add('show');
                }, i * 300);
            }
            
            // 等待所有动画完成
            await new Promise(resolve => setTimeout(resolve, segments.length * 300 + 500));
            
            console.log('✅ 本地预分析显示完成');
        }

        // 异步API调用（存储结果）
        async function startStreamRecommendationAsync(requestData) {
            console.log('🔄 启动异步API调用');
            
            const storedResult = {
                analysisSegments: [],
                recommendations: [],
                completed: false
            };
            
            return new Promise((resolve, reject) => {
                fetch('https://shaker-cocktail-app-production.up.railway.app/api/stream-recommendation', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Accept': 'text/event-stream',
                        'Cache-Control': 'no-cache'
                    },
                    body: JSON.stringify(requestData)
                })
                .then(response => {
                    if (!response.ok) {
                        throw new Error(`API调用失败: ${response.status}`);
                    }
                    
                    const reader = response.body.getReader();
                    const decoder = new TextDecoder();
                    let buffer = '';
                    
                    const readStream = async () => {
                        try {
                            while (true) {
                                const { done, value } = await reader.read();
                                
                                if (done) {
                                    console.log('✅ API流式读取完成');
                                    storedResult.completed = true;
                                    resolve(storedResult);
                                    break;
                                }
                                
                                buffer += decoder.decode(value, { stream: true });
                                const lines = buffer.split('\n');
                                buffer = lines.pop() || '';
                                
                                for (const line of lines) {
                                    if (line.trim() && line.startsWith('data: ')) {
                                        try {
                                            const data = JSON.parse(line.slice(6));
                                            
                                            // 存储不同类型的数据
                                            if (data.type === 'segmented_analysis') {
                                                storedResult.analysisSegments = data.segments;
                                                console.log('📦 存储分析数据:', data.segments.length, '段');
                                            } else if (data.type === 'recommendation') {
                                                storedResult.recommendations.push(data);
                                                console.log('📦 存储推荐数据:', storedResult.recommendations.length);
                                            }
                                            
                                        } catch (parseError) {
                                            console.warn('⚠️ 解析API数据失败:', parseError);
                                        }
                                    }
                                }
                            }
                        } catch (error) {
                            console.error('❌ 读取API流失败:', error);
                            reject(error);
                        }
                    };
                    
                    readStream();
                })
                .catch(error => {
                    console.error('❌ API调用失败:', error);
                    reject(error);
                });
            });
        }

        // 展示存储的分析结果
        async function displayStoredAnalysisResult(apiResult) {
            console.log('📊 展示存储的API结果:', apiResult);
            
            // 更新标题
            const analysisTitle = document.getElementById('analysisTitle');
            if (analysisTitle) {
                analysisTitle.textContent = 'Shaker的深度分析';
            }
            
            // 展示分析段落
            if (apiResult.analysisSegments && apiResult.analysisSegments.length > 0) {
                await showAnalysisSegments(apiResult.analysisSegments);
            }
            
            // 等待一下，然后展示推荐
            setTimeout(() => {
                if (apiResult.recommendations && apiResult.recommendations.length > 0) {
                    showSection('cocktailMakingSection');
                    displayRecommendations(apiResult.recommendations);
                }
            }, 1500);
        }

        // 展示分析段落
        async function showAnalysisSegments(segments) {
            const segmentsContainer = document.getElementById('analysisSegments');
            if (!segmentsContainer) return;
            
            segmentsContainer.innerHTML = '';
            
            // 添加AI分析标识
            const aiBadge = document.createElement('div');
            aiBadge.className = 'local-analysis-badge';
            aiBadge.style.background = 'var(--accent-gold)';
            aiBadge.innerHTML = '🤖 AI深度分析';
            segmentsContainer.appendChild(aiBadge);
            
            // 逐个显示分段
            for (let i = 0; i < segments.length; i++) {
                const segment = segments[i];
                const segmentElement = document.createElement('div');
                segmentElement.className = 'analysis-segment';
                segmentElement.innerHTML = `
                    <div class="segment-header">
                        <span class="segment-icon">${getSegmentIcon(segment.focus)}</span>
                        <h3 class="segment-title">${segment.title}</h3>
                    </div>
                    <p class="segment-content">${segment.content}</p>
                `;
                
                segmentsContainer.appendChild(segmentElement);
                
                // 延迟显示动画
                setTimeout(() => {
                    segmentElement.classList.add('show');
                }, i * 300);
            }
        }

        // 展示推荐结果
        function displayRecommendations(recommendations) {
            console.log('🍸 展示推荐结果:', recommendations.length);
            
            recommendations.forEach((recData, index) => {
                setTimeout(() => {
                    handleRecommendationData(recData);
                }, index * 500);
            });
        }

        // 显示指定区域
        function showSection(sectionId) {
            const sections = ['heroSection', 'featuresSection', 'recommendationSection', 'loadingSection', 'shakerAnalysisSection', 'cocktailMakingSection', 'resultsSection'];
            
            sections.forEach(id => {
                const element = document.getElementById(id);
                if (element) {
                if (id === sectionId) {
                    element.style.display = 'block';
                        // 滚动到显示的区域
                        setTimeout(() => {
                            element.scrollIntoView({
                                behavior: 'smooth',
                                block: 'start'
                            });
                        }, 100);
                } else {
                        // 特殊处理：保持分析区域始终可见
                        if (id === 'shakerAnalysisSection') {
                            // 分析区域一旦显示就保持可见
                            const analysisSection = document.getElementById('shakerAnalysisSection');
                            if (analysisSection && analysisSection.style.display === 'block') {
                                return; // 不隐藏已显示的分析区域
                            }
                        }
                        
                        // 保持调制区域在推荐阶段可见
                        if (sectionId === 'cocktailMakingSection' || sectionId === 'resultsSection') {
                            if (id === 'cocktailMakingSection') {
                                return;
                            }
                        }
                    element.style.display = 'none';
                    }
                }
            });
        }

        // 完整故事体验 - 包含思考泡泡和四个阶段的故事
        async function showCompleteStoryExperience(requestData) {
            console.log('🎭 开始完整故事体验');
            
            // 1. 先显示思考泡泡
            await showThoughtBubbles(requestData);
            
            // 2. 思考泡泡结束后，Shaker开始说话 - 第一句：整理思绪
            const titleElement = document.getElementById('analysisTitle');
            if (titleElement) {
                const thinkingTexts = [
                    '好的，让我整理一下思绪...',
                    '嗯...让我想想该怎么为你调制...',
                    '稍等一下，让我梳理一下想法...',
                    '好，让我仔细考虑一下你的需求...'
                ];
                const thinkingText = thinkingTexts[Math.floor(Math.random() * thinkingTexts.length)];
                await typewriterTitleText(titleElement, thinkingText, 80);
                await new Promise(resolve => setTimeout(resolve, 2000));
            }
            
            // 3. 开始四个阶段的温暖故事
            await showWarmStoryExperience(requestData);
            
            // 4. 阶段4：完美结局
            if (titleElement) {
                const stage4Text = '好了！我为你精心调制了三杯鸡尾酒，每一杯都承载着我对你的理解...';
                await typewriterTitleText(titleElement, stage4Text);
                await new Promise(resolve => setTimeout(resolve, 2000));
            }
            
            console.log('✅ 完整故事体验完成');
        }

        // 温暖故事体验 - 四个阶段的故事性内容
        async function showWarmStoryExperience(requestData) {
            console.log('📖 开始温暖故事体验');
            
            const titleElement = document.getElementById('analysisTitle');
            
            if (!titleElement) {
                console.error('❌ 找不到故事展示元素');
                return;
            }
            
            // 隐藏分析文本区域，只用标题展示
            const analysisText = document.getElementById('shakerAnalysisText');
            if (analysisText) {
                analysisText.style.display = 'none';
            }
            
            // 阶段1：回顾阶段 - 温暖回顾用户选择
            const stage1Text = generateStoryStage1(requestData);
            await typewriterTitleText(titleElement, stage1Text);
            await new Promise(resolve => setTimeout(resolve, 2500));
            
            // 阶段2：思考分析 - 基于选择深入分析展现专业性
            const stage2Text = generateStoryStage2(requestData);
            await typewriterTitleText(titleElement, stage2Text);
            await new Promise(resolve => setTimeout(resolve, 3000));
            
            // 阶段3：期待铺垫 - 营造即将揭晓的期待感
            const stage3Text = generateStoryStage3(requestData);
            await typewriterTitleText(titleElement, stage3Text);
            await new Promise(resolve => setTimeout(resolve, 2500));
            
            console.log('✅ 温暖故事体验完成');
        }
        
        // 生成故事阶段1：回顾阶段
        function generateStoryStage1(requestData) {
            const scene = requestData.scene || '未知场景';
            const moods = Array.isArray(requestData.moods) ? requestData.moods.join('、') : '平静';
            
            const templates = [
                `好的，让我回想一下...你告诉我在${scene}的时候，想要${moods}的感觉，这让我想起了那些美好的时光...`,
                `嗯...${scene}，${moods}...我能感受到你内心的渴望，就像森林中的微风轻抚过树叶...`,
                `让我想想...在${scene}时光里，你希望感受${moods}，这份心情我都记在心里了...`
            ];
            
            return templates[Math.floor(Math.random() * templates.length)];
        }
        
        // 生成故事阶段2：思考分析
        function generateStoryStage2(requestData) {
            const preferences = requestData.preferences || {};
            const alcoholLevel = preferences.alcohol_level || '中度';
            const sweetness = preferences.sweetness || '微甜';
            
            const templates = [
                `现在，基于你的偏好...${alcoholLevel}酒精度配上${sweetness}的口感，我想到了几种绝妙的组合。每一种都有它独特的魅力...`,
                `接下来，你喜欢${sweetness}、${alcoholLevel}的调配，这让我联想到森林深处那些隐秘的配方。让我为你精心挑选...`,
                `然后是口味...${alcoholLevel}的烈度，${sweetness}的温柔，这样的平衡就像自然界的和谐，我知道该为你调制什么了...`
            ];
            
            return templates[Math.floor(Math.random() * templates.length)];
        }
        
        // 生成故事阶段3：期待铺垫
        function generateStoryStage3(requestData) {
            const specialReq = requestData.special_requirements;
            
            const templates = [
                `很好...我已经在心中构思好了三杯特别的鸡尾酒，每一杯都承载着我对你的理解。${specialReq ? `特别是你提到的"${specialReq}"，我会特别用心...` : ''}`,
                `完美...三种不同的风味，三种不同的情感表达，我相信其中一定有一杯能触动你的心弦...`,
                `就是这样...就像调酒师的魔法一样，我要为你变出三杯完美的鸡尾酒。准备好迎接惊喜了吗？`
            ];
            
            return templates[Math.floor(Math.random() * templates.length)];
        }
        
        // 标题专用打字机效果 - 自然说话节奏
        async function typewriterTitleText(element, text, speed = 100) {
            // 清空并准备
            element.innerHTML = '';
            
            // 创建优雅的光标
            const cursor = document.createElement('span');
            cursor.className = 'title-cursor';
            cursor.style.cssText = `
                display: inline-block;
                width: 2px;
                height: 1em;
                background: linear-gradient(135deg, var(--forest-green), var(--warm-green));
                margin-left: 4px;
                border-radius: 1px;
                animation: elegantBlink 1s ease-in-out infinite;
                box-shadow: 0 0 6px rgba(143, 188, 143, 0.4);
                vertical-align: baseline;
            `;
            
            element.appendChild(cursor);
            
            for (let i = 0; i <= text.length; i++) {
                element.textContent = text.slice(0, i);
                element.appendChild(cursor);
                
                const char = text[i - 1];
                let currentSpeed = speed;
                
                // 自然说话节奏 - 标点符号停顿
                if (char === '。' || char === '！' || char === '？') {
                    currentSpeed = speed * 6; // 句号停顿更久
                } else if (char === '，' || char === '、') {
                    currentSpeed = speed * 3; // 逗号中等停顿
                } else if (char === '...' || char === '…') {
                    currentSpeed = speed * 8; // 省略号最久
                } else if (char === ' ') {
                    currentSpeed = speed * 0.5; // 空格快一点
                }
                
                // 随机添加自然停顿（模拟思考）
                if (Math.random() < 0.08) {
                    currentSpeed = speed * 2;
                }
                
                await new Promise(resolve => setTimeout(resolve, currentSpeed));
            }
            
            // 保持光标闪烁一会儿，然后淡出
            await new Promise(resolve => setTimeout(resolve, 1200));
            cursor.style.animation = 'fadeOut 1s ease-out forwards';
            setTimeout(() => {
                if (cursor.parentNode) {
                    cursor.remove();
                }
            }, 1000);
        }

        // 故事专用打字机效果 - 更慢更有感情（保留备用）
        async function typewriterStoryText(element, text, speed = 120) {
            element.innerHTML = '';
            
            // 创建优雅的光标
            const cursor = document.createElement('span');
            cursor.className = 'elegant-cursor';
            cursor.style.cssText = `
                display: inline-block;
                width: 3px;
                height: 1.2em;
                background: linear-gradient(135deg, var(--forest-green), var(--warm-green));
                margin-left: 3px;
                border-radius: 2px;
                animation: elegantBlink 1.2s ease-in-out infinite;
                box-shadow: 0 0 8px rgba(143, 188, 143, 0.3);
            `;
            
            element.appendChild(cursor);
            
            for (let i = 0; i <= text.length; i++) {
                element.textContent = text.slice(0, i);
                element.appendChild(cursor);
                
                const char = text[i - 1];
                let currentSpeed = speed;
                
                // 标点符号停顿更久，营造思考感
                if (char === '。' || char === '！' || char === '？') {
                    currentSpeed = speed * 4;
                } else if (char === '，' || char === '、') {
                    currentSpeed = speed * 2;
                } else if (char === '...' || char === '…') {
                    currentSpeed = speed * 5;
                }
                
                await new Promise(resolve => setTimeout(resolve, currentSpeed));
            }
            
            // 优雅地移除光标
            cursor.style.animation = 'fadeOut 0.8s ease-out forwards';
            setTimeout(() => {
                if (cursor.parentNode) {
                    cursor.remove();
                }
            }, 800);
        }

        // 流式推荐状态
        let streamState = {
            analysisText: '',
            currentRecommendationIndex: 0,
            recommendations: [],
            eventSource: null
        };

                // 获取推荐 - 优化后的并行处理流程
        async function getRecommendation() {
            // 收集特殊要求
            userInput.special_requirements = document.getElementById('specialRequirement').value;
            
            // 准备请求数据
            const requestData = {
                scene: userInput.scene,
                moods: userInput.moods,
                ingredients: userInput.ingredients,
                    preferences: {
                    alcohol_level: getAlcoholLevelText(userInput.preferences.alcohol_level),
                    sweetness: getSweetnessText(userInput.preferences.sweetness),
                    acidity: getAcidityText(userInput.preferences.acidity),
                    style: userInput.preferences.style || '清爽'
                },
                special_requirements: userInput.special_requirements
                };

                try {
                console.log('🍸 开始优化后的并行推荐流程:', requestData);
                
                // 重置状态
                streamState.analysisText = '';
                streamState.currentRecommendationIndex = 0;
                streamState.recommendations = [];
                
                // 显示分析区域
                showSection('shakerAnalysisSection');
                
                // 🚀 关键优化：立即并行启动API调用和故事展示
                console.log('🔄 并行启动：API调用 + 故事体验');
                const apiPromise = getRecommendationsOnly(requestData);
                const storyPromise = showCompleteStoryExperience(requestData);
                
                // 等待两者都完成
                console.log('⏳ 等待API和故事体验完成...');
                const [recommendations, _] = await Promise.all([apiPromise, storyPromise]);
                
                console.log('✅ 并行处理完成，API返回:', recommendations.length, '个推荐');
                
                // 滚动到推荐区域
                showSection('cocktailMakingSection');
                setTimeout(() => {
                    const makingSection = document.getElementById('cocktailMakingSection');
                    if (makingSection) {
                        makingSection.scrollIntoView({
                            behavior: 'smooth',
                            block: 'center'
                        });
                    }
                }, 300);
                
                // 初始化等待卡片（根据实际推荐数量）
                const actualCount = Math.min(recommendations.length, 3);
                initializeMakingCards(actualCount);
                
                // 等待2秒让用户看到初始状态，然后开始展示推荐结果
                setTimeout(async () => {
                await showRecommendationsSequentially(recommendations);
                }, 2000);
                
            } catch (error) {
                console.error('❌ 推荐流程失败:', error);
                alert('获取推荐失败，请检查后端服务是否启动');
                showSection('recommendSection');
            }
        }

        // 启动流式推荐 - 使用POST请求而不是GET参数
        async function startStreamRecommendation(requestData) {
            console.log('🚀 启动流式推荐连接...');
            
            return new Promise((resolve, reject) => {
                // 使用fetch进行POST请求来建立SSE连接
                fetch('https://shaker-cocktail-app-production.up.railway.app/api/stream-recommendation', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        'Accept': 'text/event-stream',
                        'Cache-Control': 'no-cache'
                        },
                    body: JSON.stringify(requestData)
                }).then(response => {
                    console.log('📡 收到响应:', response.status, response.statusText);
                    
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    
                    const reader = response.body.getReader();
                    const decoder = new TextDecoder();
                    
                    function readStream() {
                        reader.read().then(({ done, value }) => {
                            if (done) {
                                console.log('🏁 流式读取完成');
                                resolve();
                                return;
                            }
                            
                            const chunk = decoder.decode(value, { stream: true });
                            console.log('📥 收到数据块:', chunk.substring(0, 100) + '...');
                            
                            const lines = chunk.split('\n');
                            
                            for (const line of lines) {
                                if (line.startsWith('data: ')) {
                                    try {
                                        const jsonStr = line.slice(6).trim();
                                        if (jsonStr) {
                                            const data = JSON.parse(jsonStr);
                                            console.log('✅ 解析成功:', data.type, data);
                                            handleStreamData(data);
                                        }
                                    } catch (error) {
                                        console.error('❌ 解析SSE数据失败:', error, 'Line:', line);
                                    }
                                }
                            }
                            
                            readStream();
                        }).catch(error => {
                            console.error('❌ 读取流失败:', error);
                            reject(error);
                        });
                    }
                    
                    readStream();
                }).catch(error => {
                    console.error('❌ 建立流式连接失败:', error);
                    reject(error);
                });
                
                // 设置超时
                setTimeout(() => {
                    console.warn('⏰ 流式连接超时');
                    reject(new Error('连接超时'));
                }, 120000); // 120秒超时
            });
        }

        // 处理流式数据
        function handleStreamData(data) {
            console.log('📦 收到流式数据:', data.type, data);
            
            switch (data.type) {
                case 'connected':
                    console.log('🔗 连接成功:', data.message);
                    break;
                    
                case 'segmented_analysis':
                    console.log('🎯 开始处理分段分析数据');
                    handleSegmentedAnalysis(data);
                    break;
                    
                case 'thought_segment':
                    handleOptimizedThoughtSegment(data);
                    break;
                    
                case 'analysis':
                    handleAnalysisData(data);
                    break;
                    
                case 'phase_transition':
                    handleOptimizedPhaseTransition(data);
                    break;
                    
                case 'recommendation':
                    handleSequentialRecommendationData(data);
                    break;
                    
                case 'complete':
                    handleStreamComplete();
                    break;
                    
                case 'done':
                    console.log('✅ 流式推荐完成');
                    break;
                    
                case 'error':
                    console.error('❌ 服务器错误:', data.message);
                    alert('推荐服务出现错误: ' + data.message);
                    break;
                    
                default:
                    console.warn('🤔 未知数据类型:', data.type, data);
                    break;
            }
        }

        // 处理分段分析（完整版本 - 符合原始需求）
        function handleSegmentedAnalysis(data) {
            console.log('🧠 收到AI分段分析数据:', data);
            
            if (!data.segments || !Array.isArray(data.segments)) {
                console.error('❌ 分段数据格式错误:', data);
                return;
            }
            
            // 更新标题为AI分析
            const analysisTitle = document.getElementById('analysisTitle');
            if (analysisTitle) {
                analysisTitle.textContent = 'Shaker的深度分析';
            }
            
            // 获取分段容器
            const segmentsContainer = document.getElementById('analysisSegments');
            if (!segmentsContainer) {
                console.error('❌ 找不到分段容器');
                return;
            }
            
            // 移除本地分析标识
            const localBadge = segmentsContainer.querySelector('.local-analysis-badge');
            if (localBadge) {
                localBadge.remove();
            }
            
            // 添加AI分析标识
            const aiBadge = document.createElement('div');
            aiBadge.className = 'local-analysis-badge';
            aiBadge.style.background = 'var(--accent-gold)';
            aiBadge.innerHTML = '<span>🤖</span>AI深度分析';
            segmentsContainer.insertBefore(aiBadge, segmentsContainer.firstChild);
            
            // 清空现有分段（保留标识）
            const existingSegments = segmentsContainer.querySelectorAll('.analysis-segment');
            existingSegments.forEach(segment => segment.remove());
            
            // 显示AI分段
            data.segments.forEach((segment, index) => {
                const segmentElement = document.createElement('div');
                segmentElement.className = 'analysis-segment';
                segmentElement.innerHTML = `
                    <div class="segment-header">
                        <span class="segment-icon">${getSegmentIcon(segment.focus)}</span>
                        <h3 class="segment-title">${segment.title}</h3>
                    </div>
                    <p class="segment-content">${segment.content}</p>
                `;
                
                segmentsContainer.appendChild(segmentElement);
                
                // 延迟显示动画
                setTimeout(() => {
                    segmentElement.classList.add('show');
                }, index * 200);
            });
            
            // 强制显示分析区域
            const analysisSection = document.getElementById('shakerAnalysisSection');
            const analysisContent = document.getElementById('shakerAnalysisText');
            
            if (!analysisSection || !analysisContent || !analysisTitle) {
                console.error('❌ DOM元素缺失');
                return;
            }
            
            // 显示分析区域
            analysisSection.style.display = 'block';
            analysisSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
            
            console.log('✅ 开始逐段显示', data.segments.length, '个分段');
            
            // 逐段显示（按照原始需求：4段，每段4秒间隔，250ms打字速度）
            data.segments.forEach((segment, index) => {
                setTimeout(() => {
                    console.log(`🎬 开始显示第${index + 1}段:`, segment.title, segment.content);
                    
                    // 1. 标题切换特效（淡入淡出）
                    analysisTitle.style.transition = 'opacity 0.3s ease';
                    analysisTitle.style.opacity = '0';
                    
                    setTimeout(() => {
                        analysisTitle.textContent = segment.title || '分析中...';
                        analysisTitle.style.opacity = '1';
                        console.log('📝 标题已更新:', segment.title);
                    }, 300);
                    
                    // 2. 清空内容
                    analysisContent.innerHTML = '';
                    console.log('🧹 内容已清空');
                    
                    // 3. 慢速打字显示内容（250ms每字符，符合人类打字速度）
                    setTimeout(() => {
                        console.log('⌨️ 开始打字效果:', segment.content);
                        slowTypeWriter(analysisContent, segment.content, 250, () => {
                            console.log(`✅ 第${index + 1}段分析完成:`, segment.title);
                            
                            // 更新Shaker情感
                            const shakerAvatar = document.querySelector('.shaker-avatar');
                            if (shakerAvatar) {
                                updateShakerEmotion(shakerAvatar, getEmotionByFocus(segment.focus));
                                console.log('😊 Shaker情感已更新:', getEmotionByFocus(segment.focus));
                            }
                        });
                    }, 600);
                    
                }, index * 4000); // 每段间隔4秒（原始需求）
            });
        }

        // 根据分析焦点获取情感
        function getEmotionByFocus(focus) {
            const emotionMap = {
                'scene': 'understanding',
                'mood': 'empathy', 
                'ingredients': 'caring',
                'preparation': 'excitement'
            };
            return emotionMap[focus] || 'understanding';
        }

                // 慢速打字机效果（优化版）
        function slowTypeWriter(element, text, speed = 250, callback) {
            console.log('⌨️ slowTypeWriter 开始:', {element, text, speed});
            
            if (!element) {
                console.error('❌ slowTypeWriter: element为空');
                return;
            }
            
            if (!text) {
                console.error('❌ slowTypeWriter: text为空');
                return;
            }
            
            let index = 0;
            element.innerHTML = '';
            
            const timer = setInterval(() => {
                if (index < text.length) {
                    element.innerHTML += text.charAt(index);
                    index++;
                    
                    // 标点符号后额外停顿
                    const char = text.charAt(index - 1);
                    if (char === '。' || char === '！' || char === '？') {
                        setTimeout(() => {}, speed * 2);
                    } else if (char === '，' || char === '、') {
                        setTimeout(() => {}, speed * 1.5);
                    }
                    } else {
                    clearInterval(timer);
                    console.log('⌨️ slowTypeWriter 完成:', text);
                    if (callback) callback();
                }
            }, speed);
        }

        // 处理逐个推荐数据（新的揭秘逻辑）
        let recommendationQueue = [];
        let currentRevealIndex = 0;

        function handleSequentialRecommendationData(data) {
            console.log('🍸 收到推荐数据（逐个揭秘）:', data.index, data.content);
            
            // 将推荐加入队列
            recommendationQueue[data.index] = {
                index: data.index,
                content: data.content,
                glassType: data.glassType
            };
            
            console.log('📝 推荐队列状态:', recommendationQueue.length, '当前揭秘索引:', currentRevealIndex);
        }

        // 启动逐个揭秘过程
        function startSequentialReveal() {
            console.log('🎬 开始逐个揭秘推荐');
            
            // 确保3个卡片都已创建
            initializeMakingCards();
            
            // 逐个揭秘
            const revealNext = () => {
                if (currentRevealIndex < 3 && recommendationQueue[currentRevealIndex]) {
                    const recommendation = recommendationQueue[currentRevealIndex];
                    
                    console.log(`🎯 揭秘第${currentRevealIndex + 1}个推荐`);
                    
                    // 启动该卡片的调制动画
                    startMakingAnimation(currentRevealIndex);
                    
                    // 4秒后完成并显示内容
                    setTimeout(() => {
                        displayRecommendationInCard(currentRevealIndex, recommendation.content.recommendations[0]);
                        currentRevealIndex++;
                        
                        // 800ms后揭秘下一个
                        setTimeout(revealNext, 800);
                    }, 4000);
                } else {
                    console.log('✅ 所有推荐揭秘完成');
                }
            };
            
            revealNext();
        }

        // 优化的思考片段处理
        function handleOptimizedThoughtSegment(data) {
            console.log('🧠 收到优化思考片段:', data.content);
            
            // 显示分析区域
            showSection('shakerAnalysisSection');
            
            // 更新分析内容
            const analysisContent = document.getElementById('analysisContent');
            const analysisTitle = document.getElementById('analysisTitle');
            
            if (analysisContent && analysisTitle) {
                analysisTitle.textContent = 'Shaker正在理解你的需求';
                
                // 使用打字机效果显示内容
                typeWriterEffect(analysisContent, data.content, 60, () => {
                    console.log('✅ 优化分析显示完成');
                });
                
                // 更新Shaker头像情感
                updateShakerEmotion(data.emotion || 'understanding');
            }
        }

        // 优化的阶段转换处理
        function handleOptimizedPhaseTransition(data) {
            console.log('🔄 优化阶段转换:', data.phase);
            
            if (data.phase === 'recommendations') {
                // 更新分析标题
                const analysisTitle = document.getElementById('analysisTitle');
                if (analysisTitle) {
                    analysisTitle.style.transition = 'opacity 0.3s ease';
                    analysisTitle.style.opacity = '0';
                    
                    setTimeout(() => {
                        analysisTitle.textContent = '✨ 理解完成，开始为你调制';
                        analysisTitle.style.opacity = '1';
                    }, 300);
                }
                
                // 显示调制区域并启动逐个揭秘
                setTimeout(() => {
                    showSection('cocktailMakingSection');
                    
                    // 滚动到调制区域
                    document.getElementById('cocktailMakingSection')?.scrollIntoView({
                        behavior: 'smooth',
                        block: 'center'
                    });
                    
                    // 重置揭秘状态
                    currentRevealIndex = 0;
                    recommendationQueue = [];
                    
                    // 启动逐个揭秘过程
                    setTimeout(() => {
                        startSequentialReveal();
                    }, 1000);
                    
                }, 1000);
            }
        }

        // 优化的推荐数据处理 - 实时展示
        function handleOptimizedRecommendationData(data) {
            console.log('🍸 收到优化推荐:', data.index, data.content);
            
            if (data.content && data.content.recommendations && data.content.recommendations.length > 0) {
                const recommendation = data.content.recommendations[0];
                
                console.log('🎯 推荐详情:', recommendation);
                
                // 立即处理推荐，无延迟
                console.log('⚡ 立即处理推荐:', data.index);
                
                // 确保对应的卡片存在
                let cardElement = document.getElementById(`makingCard${data.index}`);
                if (!cardElement) {
                    console.log('🔧 创建缺失的卡片:', data.index);
                    const makingGrid = document.getElementById('makingGrid');
                    cardElement = createMakingCard(data.index);
                    makingGrid.appendChild(cardElement);
                }
                
                // 立即启动调制动画
                startMakingAnimation(data.index);
                
                // 2秒后显示推荐内容（动画进行中）
                setTimeout(() => {
                    console.log('📝 显示优化推荐内容:', data.index);
                    displayRecommendationInCard(data.index, recommendation);
                }, 2000);
                
            } else {
                console.warn('🤔 推荐数据格式异常:', data);
            }
        }

        // 处理分段思考
        function handleThoughtSegment(data) {
            console.log('🧠 收到思考片段:', data.segment, data.emotion, data.content);
            
            const analysisElement = document.getElementById('shakerAnalysisText');
            const shakerAvatar = document.querySelector('.shaker-avatar');
            const sectionTitle = document.querySelector('#shakerAnalysisSection .section-title');
            
            console.log('🎯 找到元素:', {
                analysisElement: !!analysisElement,
                shakerAvatar: !!shakerAvatar,
                sectionTitle: !!sectionTitle
            });
            
            if (!analysisElement) {
                console.error('❌ 找不到 shakerAnalysisText 元素');
                return;
            }
            
            // 更新标题显示进度
            if (sectionTitle) {
                const titles = [
                    'Shaker正在理解你的选择...',
                    'Shaker正在分析你的心情...',
                    'Shaker正在思考最佳搭配...',
                    'Shaker正在准备推荐...'
                ];
                const titleIndex = Math.min(data.segment, titles.length - 1);
                sectionTitle.textContent = titles[titleIndex];
            }
            
            // 更新Shaker表情
            if (shakerAvatar) {
                updateShakerEmotion(shakerAvatar, data.emotion);
            }
            
            // 累积显示内容，不清除之前的
            const currentContent = analysisElement.textContent || '';
            const newContent = currentContent + (currentContent ? ' ' : '') + data.content;
            
            console.log('⌨️ 开始打字机效果:', data.content.substring(0, 50) + '...');
            
            // 打字机效果显示新内容
            typeWriterEffect(analysisElement, newContent, 80, () => {
                console.log('✅ 思考片段显示完成:', data.segment);
            });
        }

        // 更新Shaker情感表情
        function updateShakerEmotion(avatarElement, emotion) {
            const emotionEmojis = {
                'understanding': '🤗',  // 理解
                'empathy': '🥺',        // 共情
                'caring': '😊',         // 关怀
                'excitement': '✨',     // 兴奋
                'comfort': '🫂'         // 安慰
            };
            
            const emoji = emotionEmojis[emotion] || '🧙‍♂️';
            avatarElement.textContent = emoji;
            
            // 添加情感动画
            avatarElement.style.animation = 'none';
            setTimeout(() => {
                avatarElement.style.animation = 'gentlePulse 2s ease-in-out infinite';
            }, 10);
        }

        // 打字机效果 - 更慢更温暖
        function typeWriterEffect(element, text, speed = 80, callback) {
            let i = 0;
            element.innerHTML = '<span class="typing-cursor"></span>';
            
            function typeChar() {
                if (i < text.length) {
                    const currentText = text.substring(0, i + 1);
                    element.innerHTML = currentText + '<span class="typing-cursor"></span>';
                    i++;
                    
                    // 根据字符调整速度，标点符号停顿更久
                    let charSpeed = speed;
                    const char = text[i - 1];
                    if (char === '。' || char === '！' || char === '？') {
                        charSpeed = speed * 3; // 句号停顿更久
                    } else if (char === '，' || char === '、') {
                        charSpeed = speed * 2; // 逗号适中停顿
                    } else if (char === '.' && text.substring(i-3, i) === '...') {
                        charSpeed = speed * 4; // 省略号停顿很久
                    }
                    
                    setTimeout(typeChar, charSpeed);
                    } else {
                    // 打字完成，移除光标
                    element.innerHTML = text;
                    if (callback) callback();
                }
            }
            
            typeChar();
        }

        // 处理真实API分析数据 - 累积显示
        function handleAnalysisData(data) {
            console.log('🔍 处理分析数据:', data.content);
            
            if (data.content) {
                streamState.analysisText += data.content;
                
                const analysisElement = document.getElementById('shakerAnalysisText');
                if (analysisElement) {
                    // 直接显示累积的内容，保持打字光标
                    analysisElement.innerHTML = streamState.analysisText + '<span class="typing-cursor"></span>';
                    
                    // 自动滚动
                    analysisElement.scrollTop = analysisElement.scrollHeight;
                } else {
                    console.error('❌ 找不到 shakerAnalysisText 元素');
                }
            }
        }

        // 处理阶段转换
        function handlePhaseTransition(data) {
            console.log('🔄 阶段转换:', data.message);
            
            // 更新分析区域标题
            const sectionTitle = document.querySelector('#shakerAnalysisSection .section-title');
            if (sectionTitle) {
                sectionTitle.textContent = '分析完成！准备为你调制鸡尾酒...';
            }
            
            // 移除打字光标
            const analysisElement = document.getElementById('shakerAnalysisText');
            if (analysisElement) {
                const currentText = analysisElement.textContent || streamState.analysisText;
                analysisElement.innerHTML = currentText;
            }
            
            // 平滑滚动到调制区域并显示
            setTimeout(() => {
                showSection('cocktailMakingSection');
                
                // 自动滚动到调制区域
                setTimeout(() => {
                    const makingSection = document.getElementById('cocktailMakingSection');
                    if (makingSection) {
                        makingSection.scrollIntoView({
                            behavior: 'smooth',
                            block: 'center'
                        });
                    }
                }, 300);
                
                initializeMakingCards();
            }, 1500); // 给用户更多时间阅读完整分析
        }

        // 初始化调制卡片 - 支持动态数量
        function initializeMakingCards(recommendationCount = 3) {
            const makingGrid = document.getElementById('makingGrid');
            
            // 总是清空并重新创建，确保状态正确
            makingGrid.innerHTML = '';
            
            // 设置动态布局属性
            makingGrid.setAttribute('data-count', recommendationCount.toString());
            console.log(`🎯 设置调制网格布局为 ${recommendationCount} 个推荐`);
            
            // 创建指定数量的调制卡片
            for (let i = 0; i < recommendationCount; i++) {
                const card = createMakingCard(i);
                makingGrid.appendChild(card);
            }
            
            console.log(`✅ 调制卡片初始化完成 - ${recommendationCount}张空白卡片已创建`);
        }

        // 创建简洁卡片 - 严格按照第二个截图
        function createMakingCard(index) {
            const card = document.createElement('div');
            card.className = 'simple-cocktail-card';
            card.id = `makingCard${index}`;
            
            const glassTypes = ['🍸', '🍹', '🥃'];
            const glass = glassTypes[index % 3];
            
            card.innerHTML = `
                <!-- 制作进度区域 -->
                <div class="making-progress-section" id="progressSection${index}">
                    <div class="cocktail-glass-icon">${glass}</div>
                    <div class="making-status-text" id="statusText${index}">正在调制中...</div>
                    <div class="simple-progress-bar">
                        <div class="progress-fill" id="progressFill${index}"></div>
                </div>
                </div>
                
                <!-- 推荐内容区域 - 极简设计风格 -->
                <div class="recommendation-content-area" id="recommendationContent${index}" style="display: none;">
                    <!-- 移除右上角酒精度标签 -->
                    
                    <!-- 鸡尾酒名称 - 居中显示 -->
                    <div class="cocktail-header">
                        <h3 class="cocktail-name-cn" id="nameCn${index}">鸡尾酒名称</h3>
                        <p class="cocktail-name-en" id="nameEn${index}">Cocktail Name</p>
                    </div>
                    
                    <!-- 推荐理由 -->
                    <div class="info-section">
                        <div class="info-label">
                            <span class="info-icon">✨</span>
                            <span>推荐理由：</span>
                        </div>
                        <p class="info-content" id="reason${index}">为你特别推荐</p>
                    </div>
                    
                    <!-- 主要材料 -->
                    <div class="info-section">
                        <div class="info-label">
                            <span class="info-icon">✓</span>
                            <span>主要材料：</span>
                        </div>
                        <div class="ingredients-list" id="ingredients${index}"></div>
                    </div>
                    
                    <!-- 口感特点 -->
                    <div class="info-section">
                        <div class="info-label">
                            <span class="info-icon">🍷</span>
                            <span>口感特点：</span>
                        </div>
                        <p class="info-content" id="taste${index}">口感独特</p>
                    </div>
                    
                    <!-- 底部信息 - 单行布局 -->
                    <div class="bottom-info">
                        <div class="bottom-left">
                            <div class="time-info">
                                <div class="info-icon">⏱</div>
                                <div class="info-value" id="prepTime${index}">5分钟</div>
                            </div>
                            <div class="difficulty-info">
                                <div class="info-icon">📊</div>
                                <div class="info-value" id="difficulty${index}">简单</div>
                            </div>
                        </div>
                        <div class="bottom-right">
                            <button class="details-btn" id="actionButton${index}">详情</button>
                        </div>
                    </div>
                </div>
            `;
            
            return card;
        }

        // 启动调制动画（增强版）
        function startMakingAnimation(index) {
            console.log(`🎬 启动现代制作动画 ${index}`);
            
            const card = document.getElementById(`makingCard${index}`);
            const glassIcon = document.getElementById(`glassIcon${index}`);
            const makingAnimation = document.getElementById(`makingAnimation${index}`);
            const progressSection = document.getElementById(`progressSection${index}`);
            const statusText = document.getElementById(`statusText${index}`);
            const progressFill = document.getElementById(`progressFill${index}`);
            const contentArea = document.getElementById(`recommendationContent${index}`);
            
            if (!card || !glassIcon || !makingAnimation || !progressFill) {
                console.error('❌ 制作动画元素不存在:', index);
                return;
            }
            
            // 显示进度区域，隐藏内容区域
            if (progressSection) progressSection.style.display = 'block';
            if (contentArea) contentArea.style.display = 'none';
            
            // 设置不同的调酒动效
            const animationTypes = ['shake', 'stir', 'garnish'];
            const statusTexts = [
                '正在摇制调配...', 
                '正在精心搅拌...', 
                '正在添加装饰...'
            ];
            
            const animationType = animationTypes[index % 3];
            makingAnimation.className = `making-animation ${animationType}`;
            if (statusText) statusText.textContent = statusTexts[index % 3];
            
            // 玻璃杯轻微动效
            if (glassIcon) {
                glassIcon.style.animation = 'gentle-bounce 2s ease-in-out infinite';
            }
            
            // 进度条动画
            let progress = 0;
            const duration = 3000; // 3秒制作时间
            const interval = 50;
            const increment = (100 / duration) * interval;
            
            const progressInterval = setInterval(() => {
                progress += increment + Math.random() * 2; // 略有随机性
                if (progress >= 100) {
                    progress = 100;
                    clearInterval(progressInterval);
                    
                    // 制作完成
                    setTimeout(() => {
                    completeMakingAnimation(index);
                    }, 300);
                }
                progressFill.style.width = progress + '%';
            }, interval);
        }

        // 快速制作动画（API数据已准备好）
        function startQuickMakingAnimation(index) {
            console.log(`🎬 启动快速制作动画 ${index}`);
            
            const card = document.getElementById(`makingCard${index}`);
            const glassIcon = document.getElementById(`glassIcon${index}`);
            const makingAnimation = document.getElementById(`makingAnimation${index}`);
            const progressSection = document.getElementById(`progressSection${index}`);
            const statusText = document.getElementById(`statusText${index}`);
            const progressFill = document.getElementById(`progressFill${index}`);
            const contentArea = document.getElementById(`recommendationContent${index}`);
            
            if (!card || !glassIcon || !makingAnimation || !progressFill) {
                console.error('❌ 制作动画元素不存在:', index);
                return;
            }
            
            // 显示进度区域，隐藏内容区域
            if (progressSection) progressSection.style.display = 'block';
            if (contentArea) contentArea.style.display = 'none';
            
            // 设置不同的调酒动效
            const animationTypes = ['shake', 'stir', 'garnish'];
            const statusTexts = [
                '正在摇制调配...', 
                '正在精心搅拌...', 
                '正在添加装饰...'
            ];
            
            const animationType = animationTypes[index % 3];
            makingAnimation.className = `making-animation ${animationType}`;
            if (statusText) statusText.textContent = statusTexts[index % 3];
            
            // 启动酒杯动画
            if (glassIcon) {
                glassIcon.style.animation = `${animationType} 1.5s ease-in-out infinite`;
            }
            
            // 快速进度条动画（因为数据已准备好）
            let progress = 0;
            const duration = 1500; // 1.5秒快速制作时间
            const interval = 50;
            const increment = (100 / duration) * interval;
            
            const progressInterval = setInterval(() => {
                progress += increment + Math.random() * 5; // 快速增长
                if (progress >= 100) {
                    progress = 100;
                    clearInterval(progressInterval);
                }
                progressFill.style.width = progress + '%';
            }, interval);
            
            // 保存interval ID以便后续清理
            card.dataset.progressInterval = progressInterval;
            
            console.log(`✅ 快速制作动画已启动: ${animationType}`);
        }

        // 完成快速制作
        function completeQuickMaking(index) {
            console.log(`✅ 完成快速制作 ${index}`);
            
            const card = document.getElementById(`makingCard${index}`);
            const glassIcon = document.getElementById(`glassIcon${index}`);
            const progressFill = document.getElementById(`progressFill${index}`);
            const statusText = document.getElementById(`statusText${index}`);
            
            // 清理进度条动画
            if (card && card.dataset.progressInterval) {
                clearInterval(parseInt(card.dataset.progressInterval));
                delete card.dataset.progressInterval;
            }
            
            // 完成进度条
            if (progressFill) {
                progressFill.style.width = '100%';
            }
            
            // 停止酒杯动画
            if (glassIcon) {
                glassIcon.style.animation = 'none';
            }
            
            // 更新状态文字
            if (statusText) {
                statusText.textContent = '制作完成！';
            }
        }

        // 简单进度条
        function startSimpleProgress(index) {
            console.log(`📊 开始简单进度条 ${index}`);
            
            const progressFill = document.getElementById(`progressFill${index}`);
            const statusText = document.getElementById(`statusText${index}`);
            
            if (!progressFill) {
                console.error('❌ 进度条元素不存在:', index);
                return;
            }
            
            // 更新状态文字
            if (statusText) {
                statusText.textContent = '正在调制中...';
            }
            
            // 简单进度条动画
            let progress = 0;
            const interval = setInterval(() => {
                progress += Math.random() * 20 + 10; // 快速增长
                if (progress >= 100) {
                    progress = 100;
                    clearInterval(interval);
                }
                progressFill.style.width = progress + '%';
            }, 100);
        }

        function completeSimpleProgress(index) {
            console.log(`✅ 完成简单进度条 ${index}`);
            
            const progressFill = document.getElementById(`progressFill${index}`);
            const statusText = document.getElementById(`statusText${index}`);
            
            // 完成进度条
            if (progressFill) {
                progressFill.style.width = '100%';
            }
            
            // 更新状态文字
            if (statusText) {
                statusText.textContent = '调制完成！';
            }
        }

        // 直接切换显示内容（无动画）
        function switchToContent(index) {
            console.log(`🔄 切换显示内容 ${index}`);
            
            const progressSection = document.getElementById(`progressSection${index}`);
            const contentArea = document.getElementById(`recommendationContent${index}`);
            
            console.log(`🔍 切换元素检查:`, {
                progressSection: !!progressSection,
                contentArea: !!contentArea,
                progressSectionDisplay: progressSection?.style.display,
                contentAreaDisplay: contentArea?.style.display
            });
            
            if (!progressSection || !contentArea) {
                console.error('❌ 切换元素不存在:', index, {
                    progressSection: !!progressSection,
                    contentArea: !!contentArea
                });
                return;
            }
            
            // 直接切换，无动画
            progressSection.style.display = 'none';
            contentArea.style.display = 'flex';
            contentArea.style.opacity = '1';
            contentArea.classList.add('visible'); // 添加visible类以显示子元素
            
            console.log(`✅ 切换完成:`, {
                progressSectionDisplay: progressSection.style.display,
                contentAreaDisplay: contentArea.style.display,
                contentAreaOpacity: contentArea.style.opacity,
                hasVisibleClass: contentArea.classList.contains('visible')
            });
        }

        // 填充推荐内容（无打字机效果）
        function fillRecommendationContent(recommendation, index) {
            console.log(`📝 填充推荐内容 ${index}:`, recommendation);
            console.log(`🔍 推荐数据详情:`, JSON.stringify(recommendation, null, 2));
            
            // 解析推荐数据
            const cocktailNameCn = recommendation.name?.chinese || recommendation.chinese || '神秘鸡尾酒';
            const cocktailNameEn = recommendation.name?.english || recommendation.english || 'Mystery Cocktail';
            const reason = recommendation.reason || '为你特别调制';
            const ingredients = recommendation.recipe?.ingredients || recommendation.ingredients || [];
            const tasteProfile = recommendation.taste_profile || '口感独特，值得品尝';
            const prepTime = recommendation.prep_time || '5分钟';
            const difficulty = recommendation.recipe?.difficulty || recommendation.difficulty || '简单';
            // 优化酒精度显示
            let alcoholContent = recommendation.alcohol_content || '中度(约15%)';
            if (alcoholContent.includes('适中')) {
                alcoholContent = alcoholContent.replace('适中', '中度');
            }
            if (!alcoholContent.includes('%') && !alcoholContent.includes('度')) {
                alcoholContent = `${alcoholContent}(约15%)`;
            }
            
            console.log(`🎯 解析结果:`, {
                cocktailNameCn, cocktailNameEn, reason, ingredients, tasteProfile, prepTime, difficulty, alcoholContent
            });
            
            // 填充内容
            const nameCn = document.getElementById(`nameCn${index}`);
            const nameEn = document.getElementById(`nameEn${index}`);
            const reasonEl = document.getElementById(`reason${index}`);
            const tasteEl = document.getElementById(`taste${index}`);
            const prepTimeEl = document.getElementById(`prepTime${index}`);
            const difficultyEl = document.getElementById(`difficulty${index}`);
            const ingredientsEl = document.getElementById(`ingredients${index}`);
            
            console.log(`🔍 DOM元素检查:`, {
                nameCn: !!nameCn,
                nameEn: !!nameEn,
                reasonEl: !!reasonEl,
                tasteEl: !!tasteEl,
                prepTimeEl: !!prepTimeEl,
                difficultyEl: !!difficultyEl,
                ingredientsEl: !!ingredientsEl
            });
            
            // 酒精度信息已移除，不再需要设置
            
            if (nameCn) {
                nameCn.textContent = cocktailNameCn;
                console.log(`✅ 设置中文名: ${cocktailNameCn}`);
            } else {
                console.error(`❌ 找不到中文名元素: nameCn${index}`);
            }
            
            if (nameEn) {
                nameEn.textContent = cocktailNameEn;
                console.log(`✅ 设置英文名: ${cocktailNameEn}`);
            } else {
                console.error(`❌ 找不到英文名元素: nameEn${index}`);
            }
            
            if (reasonEl) {
                reasonEl.textContent = reason;
                console.log(`✅ 设置推荐理由: ${reason}`);
            } else {
                console.error(`❌ 找不到推荐理由元素: reason${index}`);
            }
            
            if (tasteEl) {
                tasteEl.textContent = tasteProfile;
                console.log(`✅ 设置口感: ${tasteProfile}`);
            } else {
                console.error(`❌ 找不到口感元素: taste${index}`);
            }
            
            if (prepTimeEl) {
                prepTimeEl.textContent = prepTime;
                console.log(`✅ 设置制作时间: ${prepTime}`);
            } else {
                console.error(`❌ 找不到制作时间元素: prepTime${index}`);
            }
            
            if (difficultyEl) {
                difficultyEl.textContent = difficulty;
                console.log(`✅ 设置难度: ${difficulty}`);
            } else {
                console.error(`❌ 找不到难度元素: difficulty${index}`);
            }
            
            // 填充材料标签
            if (ingredientsEl) {
                ingredientsEl.innerHTML = '';
                
                // 如果没有材料数据，使用默认材料
                let displayIngredients = ingredients;
                if (!ingredients || ingredients.length === 0) {
                    displayIngredients = ['基酒', '调味料'];
                }
                
                // 显示前3个材料，保持简洁
                displayIngredients.slice(0, 3).forEach(ingredient => {
                    const tag = document.createElement('span');
                    tag.className = 'ingredient-tag';
                    
                    // 处理不同格式的材料数据
                    let ingredientText = '';
                    if (typeof ingredient === 'string') {
                        ingredientText = ingredient;
                    } else if (ingredient && ingredient.name) {
                        ingredientText = ingredient.name;
                        if (ingredient.amount) {
                            ingredientText += ` ${ingredient.amount}`;
                        }
                    } else {
                        ingredientText = String(ingredient);
                    }
                    
                    tag.textContent = ingredientText;
                    ingredientsEl.appendChild(tag);
                });
                
                console.log(`✅ 填充材料标签: ${displayIngredients.length}个`);
            }
            
            // 添加点击事件
            const card = document.getElementById(`makingCard${index}`);
            const actionButton = document.getElementById(`actionButton${index}`);
            
            const showDetails = (e) => {
                e.stopPropagation();
                showCocktailDetails({
                    nameCn: cocktailNameCn,
                    nameEn: cocktailNameEn,
                    reason: reason,
                    ingredients: ingredients,
                    tasteProfile: tasteProfile,
                    prepTime: prepTime,
                    difficulty: difficulty,
                    alcoholContent: alcoholContent
                });
            };
            
            // 给整个卡片添加点击事件
            if (card) {
                card.style.cursor = 'pointer';
                card.addEventListener('click', (e) => {
                    e.preventDefault();
                    showDetails(e);
                    console.log('🔘 卡片被点击，显示详情');
                });
            }
            
            // 按钮也添加点击事件（双重保险）
            if (actionButton) {
                actionButton.addEventListener('click', (e) => {
                    e.preventDefault();
                    e.stopPropagation();
                    showDetails(e);
                    console.log('🔘 查看详情按钮被点击');
                });
            }
        }

        // 显示鸡尾酒详情
        function showCocktailDetails(cocktail) {
            console.log('🔍 显示详情，接收到的数据:', cocktail);
            
            // 数据验证和默认值
            const safeData = {
                nameCn: cocktail.nameCn || '未知鸡尾酒',
                nameEn: cocktail.nameEn || 'Unknown Cocktail',
                reason: cocktail.reason || '暂无推荐理由',
                ingredients: cocktail.ingredients || [],
                instructions: cocktail.instructions || [
                    '将所有材料加入调酒器中',
                    '加入适量冰块，充分摇匀',
                    '过滤倒入杯中，装饰后即可享用'
                ],
                tasteProfile: cocktail.tasteProfile || '暂无口感描述',
                prepTime: cocktail.prepTime || '未知',
                difficulty: cocktail.difficulty || '未知',
                alcoholContent: cocktail.alcoholContent || '未知'
            };
            
            console.log('✅ 处理后的安全数据:', safeData);
            
            // 创建详情弹窗
            const modal = document.createElement('div');
            modal.className = 'cocktail-details-modal';
            modal.innerHTML = `
                <div class="modal-backdrop" onclick="closeCocktailDetails()"></div>
                <div class="modal-content">
                    <div class="modal-header">
                        <h2>${safeData.nameCn}</h2>
                        <p class="english-name">${safeData.nameEn}</p>
                        <button class="close-btn" onclick="closeCocktailDetails()">×</button>
                    </div>
                    <div class="modal-body">
                        <div class="detail-section">
                            <h3>🍸 基本信息</h3>
                            <div class="info-cards-grid">
                                <div class="info-card">
                                    <div class="info-icon">⏰</div>
                                    <div class="info-content">
                                        <div class="info-label">制作时间</div>
                                        <div class="info-value">${safeData.prepTime}</div>
                                    </div>
                                </div>
                                <div class="info-card">
                                    <div class="info-icon">📊</div>
                                    <div class="info-content">
                                        <div class="info-label">难度等级</div>
                                        <div class="info-value">${safeData.difficulty}</div>
                                    </div>
                                </div>
                                <div class="info-card">
                                    <div class="info-icon">🍺</div>
                                    <div class="info-content">
                                        <div class="info-label">酒精度</div>
                                        <div class="info-value">${safeData.alcoholContent}</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="detail-section">
                            <h3>✨ 推荐理由</h3>
                            <p>${safeData.reason}</p>
                        </div>
                        
                        <div class="detail-section">
                            <h3>🥃 所需材料</h3>
                            <div class="ingredients-detail">
                                ${safeData.ingredients.map(ing => {
                                    const name = typeof ing === 'string' ? ing : (ing.name || ing);
                                    const amount = typeof ing === 'object' ? (ing.amount || '') : '';
                                    return `<div class="ingredient-item">
                                        <span class="ingredient-name">${name}</span>
                                        ${amount ? `<span class="ingredient-amount">${amount}</span>` : ''}
                                    </div>`;
                                }).join('')}
                            </div>
                        </div>
                        
                        <div class="detail-section">
                            <h3>📝 制作方法</h3>
                            <div class="instructions-list">
                                ${(safeData.instructions || [
                                    '将所有材料加入调酒器中',
                                    '加入适量冰块，充分摇匀',
                                    '过滤倒入杯中，装饰后即可享用'
                                ]).map((step, index) => 
                                    `<div class="instruction-step">
                                        <div class="step-number">${index + 1}</div>
                                        <div class="step-text">${step}</div>
                                    </div>`
                                ).join('')}
                            </div>
                        </div>
                        
                        <div class="detail-section">
                            <h3>👅 口感特点</h3>
                            <p>${safeData.tasteProfile}</p>
                        </div>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            
            // 添加动画效果
            setTimeout(() => {
                modal.classList.add('show');
            }, 10);
        }
        
        // 关闭详情弹窗
        function closeCocktailDetails() {
            const modal = document.querySelector('.cocktail-details-modal');
            if (modal) {
                modal.classList.remove('show');
                setTimeout(() => {
                    document.body.removeChild(modal);
                }, 300);
            }
        }

        // 食材下落动画
        function startIngredientAnimation(index) {
            const container = document.getElementById(`ingredientsContainer${index}`);
            const ingredients = ['🍋', '🧊', '🌿', '🍯', '🥃', '🍊'];
            
            let ingredientIndex = 0;
            const ingredientInterval = setInterval(() => {
                if (ingredientIndex < ingredients.length) {
                    createFallingIngredient(container, ingredients[ingredientIndex]);
                    ingredientIndex++;
                } else {
                    clearInterval(ingredientInterval);
                }
            }, 600); // 每600ms一个食材
        }

        // 增强的食材下落动画
        function startEnhancedIngredientAnimation(index) {
            const container = document.getElementById(`ingredientsContainer${index}`);
            const ingredients = ['🧊', '🍋', '🌿', '🍯', '🥃', '🧊', '🍊'];
            
            let ingredientIndex = 0;
            const ingredientInterval = setInterval(() => {
                if (ingredientIndex < ingredients.length) {
                    createEnhancedFallingIngredient(container, ingredients[ingredientIndex], ingredientIndex);
                    ingredientIndex++;
                } else {
                    clearInterval(ingredientInterval);
                }
            }, 500); // 更频繁的食材下落
        }

        // 创建增强的下落食材
        function createEnhancedFallingIngredient(container, ingredient, index) {
            const element = document.createElement('div');
            element.className = 'falling-ingredient enhanced';
            element.textContent = ingredient;
            element.style.cssText = `
                position: absolute;
                font-size: 1.5rem;
                left: ${20 + (index * 15) % 60}%;
                top: -20px;
                animation: enhancedFall 2s ease-in-out forwards, 
                          rotate360 2s linear infinite,
                          sparkle 1s ease-in-out infinite;
                z-index: 5;
                filter: drop-shadow(0 2px 4px rgba(0,0,0,0.2));
            `;
            
            container.appendChild(element);
            
            // 2.5秒后移除元素
            setTimeout(() => {
                if (element.parentNode) {
                    element.parentNode.removeChild(element);
                }
            }, 2500);
        }

        // 创建下落食材
        function createFallingIngredient(container, emoji) {
            const ingredient = document.createElement('div');
            ingredient.className = 'falling-ingredient';
            ingredient.textContent = emoji;
            ingredient.style.left = Math.random() * 80 + 10 + '%';
            
            container.appendChild(ingredient);
            
            // 动画结束后移除
            setTimeout(() => {
                if (ingredient.parentNode) {
                    ingredient.parentNode.removeChild(ingredient);
                }
            }, 2000);
        }

        // 完成调制动画
        function completeMakingAnimation(index) {
            console.log(`✅ 完成制作动画 ${index}`);
            
            const card = document.getElementById(`makingCard${index}`);
            const glassIcon = document.getElementById(`glassIcon${index}`);
            const makingAnimation = document.getElementById(`makingAnimation${index}`);
            const progressSection = document.getElementById(`progressSection${index}`);
            const statusText = document.getElementById(`statusText${index}`);
            
            // 停止所有动画
            if (glassIcon) {
                glassIcon.style.animation = '';
            }
            if (makingAnimation) {
                makingAnimation.className = 'making-animation';
            }
            if (statusText) {
                statusText.textContent = '调制完成！';
            }
            
            // 短暂显示完成状态
            setTimeout(() => {
                // 隐藏进度区域
                if (progressSection) {
                    progressSection.style.display = 'none';
                }
                
                // 准备显示内容
                console.log(`🎯 准备显示推荐内容 ${index}`);
            }, 800);
        }

        // 处理推荐数据 - 逐个流式显示
        function handleRecommendationData(data) {
            console.log('🍸 收到推荐:', data.index, data.content);
            
            if (data.content && data.content.recommendations && data.content.recommendations.length > 0) {
                const recommendation = data.content.recommendations[0];
                
                console.log('🎯 推荐详情:', recommendation);
                
                // 立即开始处理推荐（不重复初始化卡片）
                console.log('🎬 立即开始处理推荐:', data.index);
                
                // 确保对应的卡片存在
                let cardElement = document.getElementById(`makingCard${data.index}`);
                if (!cardElement) {
                    console.log('🔧 创建缺失的卡片:', data.index);
                    const makingGrid = document.getElementById('makingGrid');
                    cardElement = createMakingCard(data.index);
                    makingGrid.appendChild(cardElement);
                }
                
                // 先启动调制动画
                setTimeout(() => {
                    startMakingAnimation(data.index);
                }, data.index * 500);
                
                // 动画进行中显示推荐内容
                setTimeout(() => {
                    console.log('📝 显示推荐内容:', data.index);
                    displayRecommendationInCard(data.index, recommendation);
                }, data.index * 500 + 2500); // 动画2.5秒后显示内容
                
            } else {
                console.warn('🤔 推荐数据格式异常:', data);
            }
        }

        // 在卡片中流式显示推荐
        function displayRecommendationInCard(index, recommendation) {
            console.log('🍸 显示推荐卡片:', index, recommendation);
            
            // 多次尝试获取DOM元素，确保稳定性
            let contentElement = document.getElementById(`recommendationContent${index}`);
            let cardElement = document.getElementById(`makingCard${index}`);
            
            // 如果元素不存在，尝试重新创建
            if (!cardElement) {
                console.warn('⚠️ 卡片元素不存在，重新创建:', index);
                const makingGrid = document.getElementById('makingGrid');
                cardElement = createMakingCard(index);
                makingGrid.appendChild(cardElement);
                contentElement = document.getElementById(`recommendationContent${index}`);
            }
            
            console.log('🎯 DOM元素检查:', {
                contentElement: !!contentElement,
                cardElement: !!cardElement,
                contentElementId: contentElement?.id,
                cardElementId: cardElement?.id,
                cardElementParent: cardElement?.parentElement?.id
            });
            
            if (contentElement && recommendation) {
                // 停止调制动画
                try {
                    completeMakingAnimation(index);
                } catch (e) {
                    console.warn('⚠️ 停止动画失败:', e);
                }
                
                // 确保卡片和内容容器都可见
                if (cardElement) {
                    cardElement.style.display = 'block';
                    cardElement.classList.remove('making');
                    cardElement.style.visibility = 'visible';
                }
                
                // 构建完整内容
                console.log('🔍 推荐数据结构:', recommendation);
                const cocktailName = recommendation.name?.chinese || recommendation.chinese || '神秘鸡尾酒';
                const englishName = recommendation.name?.english || recommendation.english || 'Mystery Cocktail';
                const reason = recommendation.reason || '为你特别调制';
                const ingredients = recommendation.recipe?.ingredients || recommendation.ingredients || [];
                const ingredientText = ingredients.map(ing => 
                    typeof ing === 'string' ? ing : `${ing.name || ing} ${ing.amount || ''}`
                ).join(', ') || '秘密配方';
                
                console.log('📝 内容解析结果:', {
                    cocktailName, englishName, reason, ingredientText
                });
                
                const fullContent = `
                    <div class="cocktail-name" style="font-size: 1.5rem; font-weight: bold; margin-bottom: 0.5rem; color: var(--primary-color);">
                        ${cocktailName}
                    </div>
                    <div class="cocktail-name-en" style="font-size: 1rem; opacity: 0.7; margin-bottom: 1rem; font-style: italic;">
                        ${englishName}
                    </div>
                    <div class="cocktail-reason" style="margin-bottom: 1rem; font-style: italic; color: var(--text-secondary); line-height: 1.6;">
                        ${reason}
                    </div>
                    <div class="cocktail-recipe" style="font-size: 0.9rem; color: var(--text-muted); line-height: 1.5;">
                        <strong>配方:</strong> ${ingredientText}
                    </div>
                `;
                
                // 设置内容并锁定样式
                contentElement.innerHTML = fullContent;
                
                // 强制样式，防止被任何其他代码覆盖
                const lockedStyles = `
                    display: block !important;
                    visibility: visible !important;
                    opacity: 1 !important;
                    transform: translateY(0) !important;
                    transition: all 0.5s ease !important;
                    padding: 1rem !important;
                    background: rgba(255, 255, 255, 0.9) !important;
                    border-radius: 15px !important;
                    margin-top: 1rem !important;
                    position: relative !important;
                    z-index: 10 !important;
                `;
                
                contentElement.style.cssText = lockedStyles;
                
                // 额外保护：定期检查并恢复样式
                const protectionInterval = setInterval(() => {
                    if (contentElement && contentElement.parentElement) {
                        if (contentElement.style.display === 'none' || contentElement.style.visibility === 'hidden') {
                            console.log('🛡️ 检测到推荐内容被隐藏，恢复显示:', index);
                            contentElement.style.cssText = lockedStyles;
                        }
                    } else {
                        clearInterval(protectionInterval);
                    }
                }, 1000);
                
                // 5秒后停止保护
                setTimeout(() => clearInterval(protectionInterval), 5000);
                
                console.log('✅ 推荐卡片显示完成并加锁保护:', index, cocktailName);
            } else {
                console.error('❌ 推荐卡片显示失败:', { 
                    contentElement: !!contentElement, 
                    recommendation: !!recommendation,
                    recommendationKeys: recommendation ? Object.keys(recommendation) : 'null',
                    makingGridChildren: document.getElementById('makingGrid')?.children.length
                });
            }
        }

        // 处理流式完成
        function handleStreamComplete() {
            console.log('🎉 流式推荐完成');
            
            // 不切换section，保持推荐卡片可见
            console.log('✅ 推荐流程完成，保持当前显示状态');
        }

        // 显示推荐结果
        function displayRecommendations(recommendations) {
            showSection('resultsSection');

            const container = document.getElementById('resultsGrid');
            container.innerHTML = '';

            recommendations.forEach((cocktail, index) => {
                const card = document.createElement('div');
                card.className = 'cocktail-card glass-card';
                card.innerHTML = `
                    <h3 class="cocktail-title">${cocktail.name.chinese}</h3>
                    <p class="cocktail-subtitle">${cocktail.name.english}</p>
                    <p class="cocktail-reason">${cocktail.reason}</p>
                    <div class="cocktail-meta">
                        <span>🏷️ ${cocktail.recipe.difficulty}</span>
                        <span>⏱️ ${cocktail.prep_time}</span>
                        <span>🍺 ${cocktail.alcohol_content}</span>
                    </div>
                `;
                
                card.addEventListener('click', () => {
                    showCocktailDetails(cocktail);
                });
                
                container.appendChild(card);
            });
            
            // 滚动到结果区域
            document.getElementById('resultsSection').scrollIntoView({
                behavior: 'smooth',
                block: 'start'
            });
        }



        // 工具函数
        function getAlcoholLevelText(value) {
            if (value < 33) return '低度';
            if (value < 67) return '中度';
            return '高度';
        }

        function getSweetnessText(value) {
            if (value < 33) return '不甜';
            if (value < 67) return '微甜';
            return '很甜';
        }

        function getAcidityText(value) {
            if (value < 33) return '不酸';
            if (value < 67) return '适中';
            return '很酸';
        }
    </script>
</body>
</html>
</html>