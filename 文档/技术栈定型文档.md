# Shaker智能鸡尾酒推荐系统技术栈定型文档

## 📋 文档信息
| 项目 | 内容 |
|------|------|
| **产品名称** | Shaker |
| **版本号** | MVP版本1.0.0 |
| **文档版本** | v1.0 |
| **创建日期** | 2024-08-28 |
| **项目负责人** | 郭锐 |
| **文档状态** | ✅ 已定型 | 

---

## 🎯 核心技术栈

### 1. Web应用架构（前后端分离）
```json
{
  "architecture": "前后端分离",
  "frontend_deployment": "Vercel",
  "backend_deployment": "Railway/Render",
  "ai_service": "Coze API",
  "data_storage": "无数据库(MVP版本)"
}
```

**重要说明**：
- ✅ **前后端分离**：前端负责UI交互，后端负责API和AI集成
- ✅ **无数据库依赖**：MVP版本不保存用户数据，纯推荐服务
- ✅ **AI驱动**：核心推荐逻辑通过Coze API实现
- ✅ **云端部署**：利用现代化的云服务快速上线

### 2. 前端技术栈
| 技术 | 版本 | 用途 | 安装命令 |
|------|------|------|----------|
| **React** | `^18.2.0` | 核心UI框架 | `npm install react@18.2.0` |
| **React DOM** | `^18.2.0` | DOM渲染 | `npm install react-dom@18.2.0` |
| **TypeScript** | `^5.3.0` | 类型系统 | `npm install typescript@5.3.0` |
| **Vite** | `^5.0.0` | 构建工具 | `npm install vite@5.0.0` |

### 3. 前端UI框架
| 技术 | 版本 | 用途 | 安装命令 |
|------|------|------|----------|
| **Tailwind CSS** | `^3.4.0` | CSS框架 | `npm install tailwindcss@3.4.0` |
| **Headless UI** | `^1.7.17` | 无样式组件 | `npm install @headlessui/react@1.7.17` |
| **Heroicons** | `^2.0.18` | 图标库 | `npm install @heroicons/react@2.0.18` |
| **Framer Motion** | `^10.16.16` | 动画库 | `npm install framer-motion@10.16.16` |

### 4. 前端状态管理
| 技术 | 版本 | 用途 | 安装命令 |
|------|------|------|----------|
| **Zustand** | `^4.4.7` | 轻量状态管理 | `npm install zustand@4.4.7` |
| **React Router** | `^6.20.0` | 路由管理 | `npm install react-router-dom@6.20.0` |

### 5. 后端技术栈
| 技术 | 版本 | 用途 | 安装命令 |
|------|------|------|----------|
| **Node.js** | `^18.19.0` | 运行时环境 | `官方下载安装` |
| **Express** | `^4.18.2` | Web框架 | `npm install express@4.18.2` |
| **TypeScript** | `^5.3.0` | 类型系统 | `npm install typescript@5.3.0` |
| **ts-node** | `^10.9.2` | TS运行时 | `npm install ts-node@10.9.2` |

### 6. 后端工具库
| 技术 | 版本 | 用途 | 安装命令 |
|------|------|------|----------|
| **cors** | `^2.8.5` | 跨域处理 | `npm install cors@2.8.5` |
| **helmet** | `^7.1.0` | 安全中间件 | `npm install helmet@7.1.0` |
| **dotenv** | `^16.3.1` | 环境变量 | `npm install dotenv@16.3.1` |
| **axios** | `^1.6.2` | HTTP客户端 | `npm install axios@1.6.2` |
| **zod** | `^3.22.4` | 数据验证 | `npm install zod@3.22.4` |

### 7. AI服务集成
| 服务 | 用途 | 配置 |
|------|------|------|
| **Coze API** | 核心推荐引擎 | API Key + Endpoint |
| **System Prompt** | AI行为定义 | 自定义调酒师角色 |
| **Response Parser** | 响应解析 | JSON格式标准化 |

### 8. 开发工具
| 技术 | 版本 | 用途 | 安装命令 |
|------|------|------|----------|
| **ESLint** | `^8.55.0` | 代码检查 | `npm install eslint@8.55.0` |
| **Prettier** | `^3.1.0` | 代码格式化 | `npm install prettier@3.1.0` |
| **Husky** | `^8.0.3` | Git钩子 | `npm install husky@8.0.3` |
| **lint-staged** | `^15.2.0` | 暂存区检查 | `npm install lint-staged@15.2.0` |

### 9. 测试框架
| 技术 | 版本 | 用途 | 安装命令 |
|------|------|------|----------|
| **Vitest** | `^1.0.0` | 测试运行器 | `npm install vitest@1.0.0` |
| **React Testing Library** | `^14.1.2` | React组件测试 | `npm install @testing-library/react@14.1.2` |
| **jsdom** | `^23.0.1` | DOM环境模拟 | `npm install jsdom@23.0.1` |

---

## 🏗️ 项目结构

### 前端项目结构
```
frontend/
├── public/                 # 静态资源
│   ├── favicon.ico
│   └── index.html
├── src/                   # 源代码
│   ├── components/        # 通用组件
│   │   ├── ui/           # 基础UI组件
│   │   └── forms/        # 表单组件
│   ├── pages/            # 页面组件
│   │   ├── HomePage.tsx
│   │   ├── RecommendPage.tsx
│   │   └── ResultPage.tsx
│   ├── stores/           # 状态管理
│   │   └── useAppStore.ts
│   ├── services/         # API服务
│   │   └── api.ts
│   ├── types/            # 类型定义
│   │   └── index.ts
│   ├── utils/            # 工具函数
│   │   └── helpers.ts
│   ├── App.tsx           # 应用根组件
│   └── main.tsx          # 应用入口
├── package.json
├── vite.config.ts
├── tailwind.config.js
└── tsconfig.json
```

### 后端项目结构
```
backend/
├── src/                  # 源代码
│   ├── controllers/      # 控制器
│   │   └── recommend.ts
│   ├── services/         # 业务服务
│   │   ├── cozeService.ts
│   │   └── promptBuilder.ts
│   ├── middleware/       # 中间件
│   │   ├── cors.ts
│   │   ├── errorHandler.ts
│   │   └── validation.ts
│   ├── types/            # 类型定义
│   │   └── index.ts
│   ├── utils/            # 工具函数
│   │   └── helpers.ts
│   ├── routes/           # 路由定义
│   │   └── index.ts
│   └── app.ts            # 应用配置
├── package.json
├── tsconfig.json
└── .env.example
```

---

## ⚙️ 环境配置

### 开发环境要求
```bash
# 系统要求
Node.js >= 18.0.0
npm >= 9.0.0
Git >= 2.30.0

# 推荐工具
VS Code + 扩展包
Chrome 90+ (开发调试)
Postman (API测试)
```

### 环境变量配置
```bash
# 前端环境变量 (.env)
VITE_API_BASE_URL=http://localhost:3001
VITE_APP_NAME=Shaker
VITE_APP_VERSION=1.0.0

# 后端环境变量 (.env)
PORT=3001
NODE_ENV=development
COZE_API_KEY=your_coze_api_key
COZE_API_ENDPOINT=https://api.coze.cn
CORS_ORIGIN=http://localhost:5173
```

### VS Code 推荐扩展
```json
{
  "recommendations": [
    "bradlc.vscode-tailwindcss",
    "esbenp.prettier-vscode",
    "dbaeumer.vscode-eslint",
    "ms-vscode.vscode-typescript-next",
    "formulahendry.auto-rename-tag",
    "christian-kohler.path-intellisense",
    "ms-vscode.vscode-json"
  ]
}
```

---

## 🚀 构建配置

### 前端构建配置 (vite.config.ts)
```typescript
import { defineConfig } from 'vite'
import react from '@vitejs/plugin-react-swc'
import { resolve } from 'path'

export default defineConfig({
  plugins: [react()],
  resolve: {
    alias: {
      '@': resolve(__dirname, 'src'),
    },
  },
  build: {
    target: 'es2015',
    outDir: 'dist',
    sourcemap: false,
    rollupOptions: {
      output: {
        manualChunks: {
          vendor: ['react', 'react-dom'],
          ui: ['@headlessui/react', 'framer-motion'],
        },
      },
    },
  },
  server: {
    port: 5173,
    proxy: {
      '/api': {
        target: 'http://localhost:3001',
        changeOrigin: true,
      },
    },
  },
})
```

### 后端构建配置 (tsconfig.json)
```json
{
  "compilerOptions": {
    "target": "ES2020",
    "module": "commonjs",
    "lib": ["ES2020"],
    "outDir": "./dist",
    "rootDir": "./src",
    "strict": true,
    "esModuleInterop": true,
    "skipLibCheck": true,
    "forceConsistentCasingInFileNames": true,
    "resolveJsonModule": true,
    "declaration": true,
    "declarationMap": true,
    "sourceMap": true
  },
  "include": ["src/**/*"],
  "exclude": ["node_modules", "dist"]
}
```

---

## 📦 部署方案

### 前端部署 (Vercel)
```json
{
  "name": "shaker-frontend",
  "version": 1,
  "builds": [
    {
      "src": "package.json",
      "use": "@vercel/static-build",
      "config": {
        "distDir": "dist"
      }
    }
  ],
  "routes": [
    {
      "src": "/api/(.*)",
      "dest": "https://shaker-backend.railway.app/api/$1"
    },
    {
      "src": "/(.*)",
      "dest": "/index.html"
    }
  ]
}
```

### 后端部署 (Railway)
```dockerfile
FROM node:18-alpine

WORKDIR /app

COPY package*.json ./
RUN npm ci --only=production

COPY . .
RUN npm run build

EXPOSE $PORT

CMD ["npm", "start"]
```

---

## 🔧 开发脚本

### 前端脚本 (package.json)
```json
{
  "scripts": {
    "dev": "vite",
    "build": "tsc && vite build",
    "preview": "vite preview",
    "lint": "eslint src --ext ts,tsx --report-unused-disable-directives --max-warnings 0",
    "lint:fix": "eslint src --ext ts,tsx --fix",
    "format": "prettier --write src/**/*.{ts,tsx,css,md}",
    "test": "vitest",
    "test:ui": "vitest --ui",
    "test:coverage": "vitest --coverage"
  }
}
```

### 后端脚本 (package.json)
```json
{
  "scripts": {
    "dev": "ts-node src/app.ts",
    "build": "tsc",
    "start": "node dist/app.js",
    "lint": "eslint src --ext .ts",
    "lint:fix": "eslint src --ext .ts --fix",
    "format": "prettier --write src/**/*.ts",
    "test": "vitest",
    "test:watch": "vitest --watch"
  }
}
```

---

## 📊 性能目标

### 前端性能
| 指标 | 目标值 | 测量方式 |
|------|--------|----------|
| **首屏加载时间** | < 3秒 | Lighthouse |
| **交互响应时间** | < 200ms | Chrome DevTools |
| **Bundle大小** | < 500KB | Webpack Bundle Analyzer |
| **Core Web Vitals** | 良好 | PageSpeed Insights |

### 后端性能
| 指标 | 目标值 | 测量方式 |
|------|--------|----------|
| **API响应时间** | < 500ms | 接口监控 |
| **AI推荐时间** | < 15秒 | 业务监控 |
| **并发处理** | 100+ | 压力测试 |
| **内存使用** | < 256MB | 系统监控 |

---

## 🔒 安全配置

### 前端安全
- **CSP配置**：防止XSS攻击
- **HTTPS强制**：生产环境强制使用HTTPS
- **敏感信息**：不在前端存储API密钥

### 后端安全
- **CORS配置**：限制跨域访问
- **输入验证**：所有用户输入严格验证
- **API限流**：防止API滥用
- **错误处理**：不暴露敏感信息

---

*文档版本：v1.0*  
*最后更新：2024-08-28*  
*技术栈已锁定，如需变更请重新评审*
