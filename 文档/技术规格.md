# Shakeræ™ºèƒ½é¸¡å°¾é…’æ¨èç³»ç»ŸæŠ€æœ¯è§„æ ¼

## ğŸ“‹ æ–‡æ¡£ä¿¡æ¯
| é¡¹ç›® | å†…å®¹ |
|------|------|
| **äº§å“åç§°** | Shaker |
| **ç‰ˆæœ¬å·** | v2.0 - æ£®æ—ä¸»é¢˜ç‰ˆæœ¬ |
| **æ–‡æ¡£ç‰ˆæœ¬** | v2.0 |
| **åˆ›å»ºæ—¥æœŸ** | 2024-08-28 |
| **æœ€åæ›´æ–°** | 2025-01-08 |
| **é¡¹ç›®è´Ÿè´£äºº** | éƒ­é” |
| **å¼€å‘çŠ¶æ€** | âœ… å·²å®Œæˆå¹¶ä¸Šçº¿ |
| **æ–‡æ¡£çŠ¶æ€** | âœ… å·²æ›´æ–°è‡³æœ€æ–°å®ç° | 

---

## âš™ï¸ æŠ€æœ¯è§„æ ¼ï¼ˆv2.0æ£®æ—ä¸»é¢˜ç‰ˆï¼‰

### 1 æŠ€æœ¯æ¶æ„

#### ğŸ¯ æ¶æ„è¯´æ˜
> **é‡è¦è¯´æ˜**ï¼šShaker v2.0åŸºäºç°ä»£WebæŠ€æœ¯æ ˆï¼Œé‡‡ç”¨å‰åç«¯åˆ†ç¦»æ¶æ„ï¼Œå®ç°äº†**æœ¬åœ°åˆ†æ+äº‘ç«¯æ¨èçš„æ··åˆæ¶æ„**ã€‚å‰ç«¯è´Ÿè´£æ£®æ—ä¸»é¢˜ç•Œé¢ã€å‚ç›´æ»šåŠ¨ä½“éªŒã€æœ¬åœ°åˆ†æå’Œæ•…äº‹æ€§å±•ç¤ºï¼Œåç«¯è´Ÿè´£AIæ¨èæœåŠ¡ã€ç¼“å­˜ä¼˜åŒ–å’Œæ€§èƒ½ç›‘æ§ã€‚

#### ğŸ“‹ æŠ€æœ¯æ ˆé€‰æ‹©ï¼ˆå®é™…å®ç°ï¼‰
```
- å‰ç«¯æŠ€æœ¯ï¼šVanilla JavaScript + HTML5 + CSS3
- è®¾è®¡ç³»ç»Ÿï¼šæ£®æ—ä¸»é¢˜CSSå˜é‡ç³»ç»Ÿ + ç»ç’ƒæ€æ•ˆæœ
- çŠ¶æ€ç®¡ç†ï¼šAppStateç±» + äº‹ä»¶ç›‘å¬å™¨æ¨¡å¼
- åŠ¨ç”»ç³»ç»Ÿï¼šCSS3åŠ¨ç”» + Intersection Observer
- åç«¯æ¡†æ¶ï¼šNode.js + Express
- AIæœåŠ¡ï¼šç«å±±å¼•æ“APIï¼ˆæ”¯æŒå¤šæœåŠ¡å•†åˆ‡æ¢ï¼‰
- ç¼“å­˜ç³»ç»Ÿï¼šå†…å­˜ç¼“å­˜ + HTTPç¼“å­˜
- éƒ¨ç½²æ–¹æ¡ˆï¼šVercel(å‰ç«¯) + Railway(åç«¯)
```

### 2 æŠ€æœ¯çº¦æŸï¼ˆå·²å®ç°ï¼‰
- âœ… **å…¼å®¹æ€§è¦æ±‚**ï¼š
  - **æµè§ˆå™¨æ”¯æŒ**ï¼šChrome 90+ã€Safari 14+ã€Firefox 88+ã€Edge 90+ï¼ˆè¦†ç›–95%ç”¨æˆ·ï¼‰
  - **ç§»åŠ¨è®¾å¤‡æ”¯æŒ**ï¼šiOS 13+ã€Android 8+ï¼Œå®Œç¾é€‚é…ç§»åŠ¨ç«¯
  - **å±å¹•åˆ†è¾¨ç‡**ï¼šæœ€ä½æ”¯æŒ320pxå®½åº¦ï¼Œä¼˜åŒ–1920Ã—1080æ˜¾ç¤ºæ•ˆæœ
  - **ç½‘ç»œç¯å¢ƒ**ï¼šæ”¯æŒ3Gç½‘ç»œï¼Œä¼˜åŒ–4G/WiFiä½“éªŒï¼Œæµå¼å“åº”å‡å°‘ç­‰å¾…æ„Ÿ
  - **è¯­è¨€æ”¯æŒ**ï¼šä¸­æ–‡ç®€ä½“ï¼Œæ¸©æš–çš„æ£®æ—ä¸»é¢˜æ–‡æ¡ˆé£æ ¼
- âœ… **æ€§èƒ½è¦æ±‚**ï¼š
  - **é¡µé¢åŠ è½½æ—¶é—´**ï¼šé¦–å±åŠ è½½â‰¤3ç§’ï¼Œå‚ç›´æ»šåŠ¨æ— é¡µé¢è·³è½¬
  - **APIå“åº”æ—¶é—´**ï¼šæ¨èæ¥å£â‰¤15ç§’ï¼Œç¼“å­˜å‘½ä¸­<500ms
  - **ç”¨æˆ·æ“ä½œå“åº”**ï¼šUIäº¤äº’â‰¤200msï¼Œæ£®æ—ä¸»é¢˜åŠ¨ç”»æµç•…
  - **å†…å­˜ä½¿ç”¨**ï¼šå‰ç«¯è¿è¡Œæ—¶â‰¤100MBï¼Œåç«¯æœåŠ¡â‰¤256MB
  - **å¹¶å‘å¤„ç†**ï¼šæ”¯æŒ100+ç”¨æˆ·åŒæ—¶ä½¿ç”¨ï¼Œè¯·æ±‚å»é‡ä¼˜åŒ–
- âœ… **å®‰å…¨è¦æ±‚**ï¼š
  - **æ•°æ®ä¼ è¾“**ï¼šç”Ÿäº§ç¯å¢ƒå¼ºåˆ¶HTTPSï¼ŒAPIé€šä¿¡åŠ å¯†
  - **è¾“å…¥éªŒè¯**ï¼šæ”¯æŒå®Œå…¨è‡ªç”±è¾“å…¥ï¼Œæ™ºèƒ½è¿‡æ»¤å’Œæ¸…æ´—
  - **APIå®‰å…¨**ï¼šç«å±±å¼•æ“APIå¯†é’¥åç«¯ä¿æŠ¤ï¼Œå‰ç«¯ä¸æš´éœ²æ•æ„Ÿä¿¡æ¯
  - **é”™è¯¯å¤„ç†**ï¼šæ¸©æš–å‹å¥½çš„é”™è¯¯æç¤ºï¼Œå®Œå–„çš„é™çº§æœºåˆ¶
  - **è®¿é—®æ§åˆ¶**ï¼šAPIé¢‘ç‡é™åˆ¶ï¼Œé˜²æ­¢æ¶æ„è¯·æ±‚

### 3 ç³»ç»Ÿæ¶æ„è®¾è®¡ï¼ˆv2.0å®ç°ï¼‰

#### ğŸ—ï¸ æ•´ä½“æ¶æ„å›¾
```mermaid
graph TB
    A[ç”¨æˆ·æµè§ˆå™¨] --> B[Vercel CDN]
    B --> C[æ£®æ—ä¸»é¢˜å‰ç«¯åº”ç”¨]
    C --> D[Railwayåç«¯æœåŠ¡]
    D --> E[ç«å±±å¼•æ“AI API]
    
    C --> F[æœ¬åœ°åˆ†ææ¨¡å—]
    C --> G[æ•…äº‹æ€§åˆ†æç”Ÿæˆå™¨]
    D --> H[å¤šå±‚ç¼“å­˜ç³»ç»Ÿ]
    D --> I[è¯·æ±‚å»é‡ç®¡ç†å™¨]
    
    J[æ€§èƒ½ç›‘æ§] --> C
    J --> D
    
    style A fill:#e1f5fe
    style C fill:#c8e6c9
    style D fill:#e8f5e8
    style E fill:#fff3e0
    style F fill:#a5d6a7
    style G fill:#81c784
```

#### ğŸ“¦ å‰ç«¯æ¶æ„ï¼ˆå®é™…å®ç°ï¼‰
```javascript
// å‰ç«¯æŠ€æœ¯æ¶æ„ï¼ˆv2.0æ£®æ—ä¸»é¢˜ç‰ˆï¼‰
{
  "è§†å›¾å±‚": "Vanilla JavaScript + HTML5",
  "è®¾è®¡ç³»ç»Ÿ": "æ£®æ—ä¸»é¢˜CSSå˜é‡ç³»ç»Ÿ",
  "çŠ¶æ€ç®¡ç†": "AppStateç±» + è§‚å¯Ÿè€…æ¨¡å¼",
  "åŠ¨ç”»ç³»ç»Ÿ": "CSS3åŠ¨ç”» + Intersection Observer",
  "æ ·å¼æ–¹æ¡ˆ": "CSS3 + ç»ç’ƒæ€æ•ˆæœ",
  "æœ¬åœ°åˆ†æ": "LocalAnalysisGenerator",
  "æ•…äº‹æ€§ä½“éªŒ": "StoryAnalysisGenerator + ReviewCardGenerator",
  "æ€è€ƒå¯è§†åŒ–": "ThoughtBubbleGenerator",
  "APIé€šä¿¡": "Fetch API + æµå¼å“åº”å¤„ç†"
}
```

#### ğŸ”§ åç«¯æ¶æ„ï¼ˆå®é™…å®ç°ï¼‰
```javascript
// åç«¯æŠ€æœ¯æ¶æ„ï¼ˆv2.0ä¼˜åŒ–ç‰ˆï¼‰
{
  "Webæ¡†æ¶": "Express.js",
  "ç¼–ç¨‹è¯­è¨€": "JavaScript",
  "APIè®¾è®¡": "RESTful + æµå¼å“åº”",
  "AIæœåŠ¡": "ç«å±±å¼•æ“APIé›†æˆ",
  "æœåŠ¡å·¥å‚": "AIServiceFactoryï¼ˆæ”¯æŒå¤šæœåŠ¡å•†ï¼‰",
  "ç¼“å­˜ç³»ç»Ÿ": "CacheManagerï¼ˆå†…å­˜ç¼“å­˜ï¼‰",
  "æ€§èƒ½ä¼˜åŒ–": "è¯·æ±‚å»é‡ + è¿æ¥æ± ",
  "é”™è¯¯å¤„ç†": "ç»Ÿä¸€é”™è¯¯ä¸­é—´ä»¶ + å‹å¥½æç¤º",
  "æ—¥å¿—ç³»ç»Ÿ": "Console + æ€§èƒ½ç›‘æ§",
  "æµå¼æœåŠ¡": "StreamServiceï¼ˆå®æ—¶å“åº”ï¼‰"
}
```

---

## ğŸ¨ å‰ç«¯æŠ€æœ¯è§„æ ¼ï¼ˆv2.0æ£®æ—ä¸»é¢˜ç‰ˆï¼‰

### 1 æ£®æ—ä¸»é¢˜è®¾è®¡ç³»ç»Ÿ

#### ğŸŒ¿ æ£®æ—è‰²å½©ç³»ç»Ÿ
```css
:root {
    /* æ£®æ—ä¸»é¢˜è‰²è°ƒ - ç»¿æ„æ¸…æ–°æ¸©æš– */
    --primary-gradient: linear-gradient(135deg, #2d5016 0%, #4a7c59 50%, #8fbc8f 100%);
    --forest-dark: #1a2e1a;
    --forest-green: #228b22;
    --warm-green: #8fbc8f;
    --leaf-green: #9acd32;
    --soft-beige: #f5f5dc;
    
    /* èƒŒæ™¯è‰² - æ¸©æš–è‡ªç„¶ */
    --bg-primary: #f8f5f0;
    --bg-secondary: #e8f5e8;
    --bg-glass: rgba(143, 188, 143, 0.1);
    --bg-glass-hover: rgba(143, 188, 143, 0.2);
    --bg-warm: rgba(245, 245, 220, 0.9);
    
    /* æ–‡æœ¬è‰² - è‡ªç„¶æ¸©æš– */
    --text-primary: #2d4a2d;
    --text-secondary: #4a7c59;
    --text-muted: #6b8e6b;
    --text-warm: #8b4513;
    
    /* è¾¹æ¡†å’Œé˜´å½± - æŸ”å’Œè‡ªç„¶ */
    --border-natural: rgba(143, 188, 143, 0.3);
    --shadow-soft: 0 4px 20px rgba(34, 139, 34, 0.1);
    --shadow-warm: 0 8px 32px rgba(139, 69, 19, 0.1);
}
```

#### ğŸ“‹ é¡µé¢ç»“æ„ï¼ˆå®é™…å®ç°ï¼‰
```
Shakeræ£®æ—ä¸»é¢˜å•é¡µåº”ç”¨
â”œâ”€â”€ æ£®æ—èƒŒæ™¯åŠ¨ç”»å±‚ (bg-animation)
â”‚   â”œâ”€â”€ å¶ç‰‡æ‘‡æ‘†åŠ¨ç”» (forestSway)
â”‚   â””â”€â”€ æœˆå…‰é—ªçƒæ•ˆæœ (leafDance)
â”œâ”€â”€ å¤´éƒ¨å¯¼èˆª (header)
â”‚   â””â”€â”€ Shakerå“ç‰Œæ ‡è¯† ğŸ¸
â”œâ”€â”€ ä¸»å†…å®¹åŒºåŸŸ (main-content)
â”‚   â”œâ”€â”€ è‹±é›„åŒºåŸŸ (hero-section)
â”‚   â”‚   â”œâ”€â”€ ğŸŒ¿Shaker ä½ çš„è°ƒé…’å¸ˆ
â”‚   â”‚   â”œâ”€â”€ æ¸©æš–æ¬¢è¿æ–‡æ¡ˆ
â”‚   â”‚   â””â”€â”€ ğŸ¸å¼€å§‹å¯»æ‰¾ä¹‹æ—…æŒ‰é’®
â”‚   â”œâ”€â”€ å³ä¾§è¿›åº¦æŒ‡ç¤ºå™¨ (progress-sidebar)
â”‚   â”‚   â”œâ”€â”€ è¿›åº¦çº¿ (progress-line-main)
â”‚   â”‚   â””â”€â”€ æ™ºèƒ½è·ŸéšæŒ‡ç¤ºå™¨
â”‚   â”œâ”€â”€ æ—¶å…‰é€‰æ‹©åŒºåŸŸ (sceneSection)
â”‚   â”‚   â””â”€â”€ 3Ã—2ç½‘æ ¼æ£®æ—ä¸»é¢˜å¡ç‰‡
â”‚   â”œâ”€â”€ å¿ƒæƒ…é€‰æ‹©åŒºåŸŸ (moodSection)
â”‚   â”‚   â””â”€â”€ æ£®æ—ä¸»é¢˜å¿ƒæƒ…æ ‡ç­¾ï¼ˆæ”¯æŒå¤šé€‰ï¼‰
â”‚   â”œâ”€â”€ ææ–™é€‰æ‹©åŒºåŸŸ (ingredientSection)
â”‚   â”‚   â”œâ”€â”€ åŸºé…’åˆ†ç±» (spirits)
â”‚   â”‚   â”œâ”€â”€ è°ƒå‘³æ–™åˆ†ç±» (mixers)
â”‚   â”‚   â””â”€â”€ å·¥å…·åˆ†ç±» (tools)
â”‚   â”œâ”€â”€ åå¥½è®¾ç½®åŒºåŸŸ (preferenceSection)
â”‚   â”‚   â”œâ”€â”€ æ£®æ—ä¸»é¢˜æ»‘å— (preference-slider)
â”‚   â”‚   â””â”€â”€ åŠ¨æ€æ•°å€¼æ˜¾ç¤º
â”‚   â”œâ”€â”€ ç‰¹æ®Šè¦æ±‚åŒºåŸŸ (requirementSection)
â”‚   â”‚   â”œâ”€â”€ æ–‡æœ¬è¾“å…¥æ¡†
â”‚   â”‚   â””â”€â”€ å¿«æ·æ ‡ç­¾
â”‚   â”œâ”€â”€ Shakeråˆ†æåŒºåŸŸ (shakerAnalysisSection)
â”‚   â”‚   â”œâ”€â”€ Shakerå¤´åƒ ğŸ§™â€â™‚ï¸
â”‚   â”‚   â”œâ”€â”€ æ€è€ƒæ°”æ³¡å®¹å™¨
â”‚   â”‚   â”œâ”€â”€ åˆ†æ®µåˆ†æå±•ç¤º
â”‚   â”‚   â””â”€â”€ æ•…äº‹æ€§åˆ†æå¡ç‰‡
â”‚   â””â”€â”€ æ¨èç»“æœåŒºåŸŸ (recommendationSection)
â”‚       â”œâ”€â”€ åŠ¨æ€ç½‘æ ¼å¸ƒå±€
â”‚       â”œâ”€â”€ æ£®æ—ä¸»é¢˜æ¨èå¡ç‰‡
â”‚       â””â”€â”€ è¯¦ç»†é…æ–¹æ¨¡æ€æ¡†
â””â”€â”€ åŠ è½½å’Œé”™è¯¯çŠ¶æ€ç»„ä»¶
```

#### ğŸ§© åŸºç¡€ç»„ä»¶åº“
```typescript
// UIç»„ä»¶è§„æ ¼
interface ComponentLibrary {
  // åŸºç¡€ç»„ä»¶
  Button: {
    variants: ['primary', 'secondary', 'outline', 'ghost'];
    sizes: ['sm', 'md', 'lg'];
    states: ['default', 'hover', 'active', 'disabled'];
  };
  
  Card: {
    variants: ['default', 'elevated', 'outlined'];
    clickable: boolean;
    loading: boolean;
  };
  
  Input: {
    types: ['text', 'search', 'textarea'];
    states: ['default', 'focus', 'error', 'disabled'];
    validation: boolean;
  };
  
  // è¡¨å•ç»„ä»¶
  Slider: {
    range: [number, number];
    step: number;
    marks: boolean;
    tooltip: boolean;
  };
  
  Checkbox: {
    states: ['unchecked', 'checked', 'indeterminate'];
    labelPosition: 'left' | 'right';
  };
  
  Select: {
    multiple: boolean;
    searchable: boolean;
    clearable: boolean;
  };
}
```

### 2 çŠ¶æ€ç®¡ç†è§„æ ¼

#### ğŸ—„ï¸ å…¨å±€çŠ¶æ€è®¾è®¡
```typescript
// ZustandçŠ¶æ€ç®¡ç†
interface AppState {
  // ç”¨æˆ·è¾“å…¥çŠ¶æ€
  userInput: {
    scene: SceneType | null;
    moods: MoodType[];
    ingredients: IngredientType[];
    preferences: PreferenceType;
    specialRequirements: string;
  };
  
  // æ¨èç»“æœçŠ¶æ€
  recommendations: {
    data: CocktailRecommendation[];
    loading: boolean;
    error: string | null;
  };
  
  // UIçŠ¶æ€
  ui: {
    currentStep: number;
    sidebarOpen: boolean;
    theme: 'light' | 'dark';
  };
  
  // æ“ä½œæ–¹æ³•
  actions: {
    updateUserInput: (key: keyof UserInput, value: any) => void;
    fetchRecommendations: () => Promise<void>;
    resetState: () => void;
    nextStep: () => void;
    previousStep: () => void;
  };
}
```

### 3 è·¯ç”±è®¾è®¡è§„æ ¼

#### ğŸ›£ï¸ è·¯ç”±ç»“æ„
```typescript
// React Routeré…ç½®
const routes = [
  {
    path: '/',
    element: <HomePage />,
    meta: { title: 'Shaker - æ™ºèƒ½é¸¡å°¾é…’æ¨è' }
  },
  {
    path: '/recommend',
    element: <RecommendFlow />,
    children: [
      { path: 'scene', element: <SceneSelect /> },
      { path: 'mood', element: <MoodSelect /> },
      { path: 'ingredients', element: <IngredientSelect /> },
      { path: 'preferences', element: <PreferenceSet /> },
      { path: 'requirements', element: <SpecialRequirements /> }
    ]
  },
  {
    path: '/results',
    element: <ResultPage />,
    meta: { requiresInput: true }
  },
  {
    path: '*',
    element: <ErrorPage />
  }
];
```

### 4 æ€§èƒ½ä¼˜åŒ–è§„æ ¼

#### âš¡ ä¼˜åŒ–ç­–ç•¥
```typescript
// æ€§èƒ½ä¼˜åŒ–é…ç½®
{
  "ä»£ç åˆ†å‰²": {
    "è·¯ç”±çº§åˆ†å‰²": "React.lazy + Suspense",
    "ç»„ä»¶çº§åˆ†å‰²": "åŠ¨æ€å¯¼å…¥",
    "ç¬¬ä¸‰æ–¹åº“åˆ†å‰²": "ç‹¬ç«‹vendor chunk"
  },
  
  "èµ„æºä¼˜åŒ–": {
    "å›¾ç‰‡æ‡’åŠ è½½": "Intersection Observer",
    "å­—ä½“ä¼˜åŒ–": "font-display: swap",
    "é™æ€èµ„æº": "CDN + ç¼“å­˜"
  },
  
  "è¿è¡Œæ—¶ä¼˜åŒ–": {
    "çŠ¶æ€æ›´æ–°": "æµ…æ¯”è¾ƒ + é¿å…é‡å¤æ¸²æŸ“",
    "äº‹ä»¶å¤„ç†": "é˜²æŠ– + èŠ‚æµ",
    "å†…å­˜ç®¡ç†": "ç»„ä»¶å¸è½½æ—¶æ¸…ç†"
  }
}
```

---

## ğŸ”§ åç«¯æŠ€æœ¯è§„æ ¼

### 1 APIæ¥å£è®¾è®¡

#### ğŸ“¡ RESTful APIè§„æ ¼
```typescript
// APIæ¥å£å®šä¹‰
interface APIEndpoints {
  // å¥åº·æ£€æŸ¥
  'GET /api/health': {
    response: { status: 'ok', timestamp: string };
  };
  
  // è·å–ææ–™åˆ—è¡¨
  'GET /api/ingredients': {
    response: {
      categories: IngredientCategory[];
      total: number;
    };
  };
  
  // è·å–æ¨è
  'POST /api/recommend': {
    request: UserInputData;
    response: {
      recommendations: CocktailRecommendation[];
      total: number;
      generated_at: string;
    };
  };
  
  // é‡æ–°æ¨è
  'POST /api/recommend/refresh': {
    request: { session_id: string } & Partial<UserInputData>;
    response: {
      recommendations: CocktailRecommendation[];
      total: number;
      generated_at: string;
    };
  };
}
```

#### ğŸ—ƒï¸ æ•°æ®æ¨¡å‹è§„æ ¼
```typescript
// æ ¸å¿ƒæ•°æ®ç±»å‹
interface UserInputData {
  scene: 'party' | 'date' | 'alone' | 'business' | 'dining' | 'night';
  moods: ('happy' | 'sad' | 'excited' | 'calm' | 'confident' | 'thoughtful' | 'tired')[];
  ingredients: {
    spirits: string[];
    mixers: string[];
    tools: string[];
  };
  preferences: {
    alcohol_level: 'none' | 'low' | 'medium' | 'high';
    sweetness: 'none' | 'light' | 'medium' | 'high';
    acidity: 'none' | 'light' | 'medium' | 'high';
    style: 'fresh' | 'rich' | 'smooth' | 'strong';
    color: 'any' | 'clear' | 'light' | 'dark' | 'colorful';
  };
  special_requirements?: string;
}

interface CocktailRecommendation {
  id: string;
  name: {
    chinese: string;
    english: string;
  };
  reason: string;
  recipe: {
    ingredients: Array<{
      name: string;
      amount: string;
      essential: boolean;
    }>;
    tools: string[];
    difficulty: 'easy' | 'medium' | 'hard';
  };
  instructions: string[];
  taste_profile: {
    sweetness: number;
    acidity: number;
    alcohol_content: number;
    style: string;
  };
  visual: {
    color: string;
    garnish: string;
    glassware: string;
  };
  timing: {
    prep_time: string;
    serving_temp: string;
    best_time: string;
  };
}
```

### 2 Coze AIé›†æˆè§„æ ¼

#### ğŸ¤– AIæœåŠ¡æ¶æ„
```typescript
// Coze APIé›†æˆé…ç½®
interface CozeServiceConfig {
  client: {
    apiKey: string;
    endpoint: string;
    timeout: 15000; // 15ç§’è¶…æ—¶
    retries: 2;
  };
  
  prompts: {
    system: string; // ç³»ç»Ÿè§’è‰²å®šä¹‰
    template: string; // æ¨èè¯·æ±‚æ¨¡æ¿
    examples: string[]; // ç¤ºä¾‹å¯¹è¯
  };
  
  parsing: {
    responseFormat: 'json';
    validation: ZodSchema;
    fallback: CocktailRecommendation[];
  };
}
```

#### ğŸ“ Promptè®¾è®¡è§„æ ¼
```typescript
// System Prompté…ç½®
const SYSTEM_PROMPT = `
ä½ æ˜¯ä¸€ä½ä¸“ä¸šçš„è°ƒé…’å¸ˆAIåŠ©æ‰‹ï¼Œå…·æœ‰ä¸°å¯Œçš„é¸¡å°¾é…’çŸ¥è¯†å’Œè°ƒé…’ç»éªŒã€‚

ä½ çš„ä»»åŠ¡ï¼š
1. æ ¹æ®ç”¨æˆ·çš„åœºæ™¯ã€å¿ƒæƒ…ã€ææ–™å’Œåå¥½ï¼Œæ¨èæœ€é€‚åˆçš„é¸¡å°¾é…’
2. æä¾›è¯¦ç»†çš„é…æ–¹ã€åˆ¶ä½œæ­¥éª¤å’Œå“é‰´å»ºè®®
3. ç¡®ä¿æ¨èçš„åˆç†æ€§å’Œå¯æ“ä½œæ€§

å“åº”æ ¼å¼è¦æ±‚ï¼š
- æ¨è3-5æ¬¾ä¸åŒé£æ ¼çš„é¸¡å°¾é…’
- æ¯æ¬¾é…’åŒ…å«ï¼šä¸­è‹±æ–‡åç§°ã€æ¨èç†ç”±ã€å®Œæ•´é…æ–¹ã€åˆ¶ä½œæ­¥éª¤ã€å£æ„Ÿæè¿°ã€è§†è§‰æ•ˆæœã€åˆ¶ä½œæ—¶é—´
- ç¡®ä¿JSONæ ¼å¼æ­£ç¡®ï¼Œå­—æ®µå®Œæ•´

è´¨é‡æ ‡å‡†ï¼š
- é…æ–¹çœŸå®å¯è¡Œï¼Œç”¨é‡å‡†ç¡®
- æ¨èç†ç”±åˆ‡åˆç”¨æˆ·éœ€æ±‚
- åˆ¶ä½œæ­¥éª¤æ¸…æ™°æ˜“æ‡‚
- è€ƒè™‘ææ–™çš„å¯è·å¾—æ€§
`;

// è¯·æ±‚æ¨¡æ¿
const REQUEST_TEMPLATE = `
è¯·æ ¹æ®ä»¥ä¸‹ä¿¡æ¯æ¨èé¸¡å°¾é…’ï¼š
åœºæ™¯ï¼š{scene}
å¿ƒæƒ…ï¼š{moods}
å¯ç”¨ææ–™ï¼š{ingredients}
åå¥½è®¾ç½®ï¼š{preferences}
ç‰¹æ®Šè¦æ±‚ï¼š{special_requirements}

è¯·è¿”å›JSONæ ¼å¼çš„æ¨èç»“æœã€‚
`;
```

### 3 ç¼“å­˜ç­–ç•¥è§„æ ¼

#### ğŸš€ ç¼“å­˜æ¶æ„
```typescript
// ç¼“å­˜ç­–ç•¥é…ç½®
interface CacheStrategy {
  // å†…å­˜ç¼“å­˜
  memory: {
    ingredients: {
      ttl: 3600000; // 1å°æ—¶
      maxSize: 100;
    };
    recommendations: {
      ttl: 1800000; // 30åˆ†é’Ÿ
      maxSize: 1000;
      keyGenerator: (input: UserInputData) => string;
    };
  };
  
  // HTTPç¼“å­˜
  http: {
    staticAssets: {
      maxAge: 31536000; // 1å¹´
      immutable: true;
    };
    apiResponses: {
      maxAge: 300; // 5åˆ†é’Ÿ
      staleWhileRevalidate: 600; // 10åˆ†é’Ÿ
    };
  };
}
```

### 4 é”™è¯¯å¤„ç†è§„æ ¼

#### ğŸš¨ é”™è¯¯å¤„ç†æ¶æ„
```typescript
// é”™è¯¯ç±»å‹å®šä¹‰
enum ErrorCode {
  // å®¢æˆ·ç«¯é”™è¯¯ (4xx)
  INVALID_INPUT = 'INVALID_INPUT',
  MISSING_REQUIRED_FIELD = 'MISSING_REQUIRED_FIELD',
  RATE_LIMIT_EXCEEDED = 'RATE_LIMIT_EXCEEDED',
  
  // æœåŠ¡ç«¯é”™è¯¯ (5xx)
  AI_SERVICE_ERROR = 'AI_SERVICE_ERROR',
  AI_SERVICE_TIMEOUT = 'AI_SERVICE_TIMEOUT',
  INTERNAL_SERVER_ERROR = 'INTERNAL_SERVER_ERROR',
  SERVICE_UNAVAILABLE = 'SERVICE_UNAVAILABLE'
}

// é”™è¯¯å“åº”æ ¼å¼
interface ErrorResponse {
  error: {
    code: ErrorCode;
    message: string;
    details?: any;
    timestamp: string;
    request_id: string;
  };
}

// é”™è¯¯å¤„ç†ä¸­é—´ä»¶
class ErrorHandler {
  static handle(error: Error, req: Request, res: Response) {
    const errorResponse: ErrorResponse = {
      error: {
        code: this.getErrorCode(error),
        message: this.getUserFriendlyMessage(error),
        timestamp: new Date().toISOString(),
        request_id: req.headers['x-request-id'] as string
      }
    };
    
    // è®°å½•æ—¥å¿—
    console.error('[API Error]', {
      error: error.message,
      stack: error.stack,
      request: {
        method: req.method,
        url: req.url,
        body: req.body
      }
    });
    
    res.status(this.getHttpStatus(error)).json(errorResponse);
  }
}
```

---

## ğŸ”’ å®‰å…¨æŠ€æœ¯è§„æ ¼

### 1 APIå®‰å…¨
```typescript
// APIå®‰å…¨é…ç½®
interface SecurityConfig {
  cors: {
    origin: string[];
    credentials: boolean;
    methods: ['GET', 'POST', 'OPTIONS'];
    allowedHeaders: ['Content-Type', 'Authorization'];
  };
  
  rateLimit: {
    windowMs: 900000; // 15åˆ†é’Ÿ
    maxRequests: 100; // æ¯ä¸ªIPæœ€å¤š100æ¬¡è¯·æ±‚
    skipSuccessfulRequests: false;
  };
  
  inputValidation: {
    maxBodySize: '1mb';
    parameterPollution: false;
    trimStrings: true;
    sanitizeHtml: true;
  };
}
```

### 2 æ•°æ®ä¿æŠ¤
```typescript
// æ•°æ®ä¿æŠ¤ç­–ç•¥
interface DataProtection {
  encryption: {
    algorithm: 'AES-256-GCM';
    keyRotation: '30days';
  };
  
  logging: {
    excludeFields: ['password', 'token', 'api_key'];
    retention: '30days';
    anonymization: true;
  };
  
  privacy: {
    noUserTracking: true;
    noPersistentStorage: true;
    temporarySessionOnly: true;
  };
}
```

---

## ğŸ“Š ç›‘æ§å’Œæ—¥å¿—è§„æ ¼

### 1 æ€§èƒ½ç›‘æ§
```typescript
// ç›‘æ§æŒ‡æ ‡é…ç½®
interface MonitoringConfig {
  metrics: {
    // å“åº”æ—¶é—´ç›‘æ§
    responseTime: {
      p50: 500;   // 50%è¯·æ±‚<500ms
      p95: 2000;  // 95%è¯·æ±‚<2s
      p99: 5000;  // 99%è¯·æ±‚<5s
    };
    
    // é”™è¯¯ç‡ç›‘æ§
    errorRate: {
      threshold: 0.05; // é”™è¯¯ç‡<5%
      alerting: true;
    };
    
    // ç³»ç»Ÿèµ„æºç›‘æ§
    resources: {
      cpu: { threshold: 80 };
      memory: { threshold: 85 };
      diskSpace: { threshold: 90 };
    };
  };
  
  alerts: {
    channels: ['email', 'webhook'];
    escalation: {
      warning: 5; // 5åˆ†é’Ÿåå‡çº§
      critical: 1; // 1åˆ†é’Ÿåå‡çº§
    };
  };
}
```

### 2 æ—¥å¿—è§„æ ¼
```typescript
// æ—¥å¿—é…ç½®
interface LoggingConfig {
  levels: ['error', 'warn', 'info', 'debug'];
  format: {
    timestamp: 'ISO8601';
    level: string;
    message: string;
    context: object;
    requestId: string;
  };
  
  outputs: {
    console: boolean;
    file: boolean;
    cloud: boolean;
  };
  
  retention: {
    error: '90days';
    info: '30days';
    debug: '7days';
  };
}
```

---

## ğŸ§ª æµ‹è¯•æŠ€æœ¯è§„æ ¼

### 1 æµ‹è¯•ç­–ç•¥
```typescript
// æµ‹è¯•é…ç½®
interface TestStrategy {
  unit: {
    framework: 'Vitest';
    coverage: { threshold: 80 };
    mocking: 'vi.mock';
  };
  
  integration: {
    framework: 'Supertest';
    database: 'in-memory';
    external: 'mocked';
  };
  
  e2e: {
    framework: 'Playwright';
    browsers: ['chromium', 'firefox', 'webkit'];
    viewports: ['mobile', 'tablet', 'desktop'];
  };
  
  performance: {
    tool: 'Lighthouse CI';
    metrics: ['FCP', 'LCP', 'CLS', 'FID'];
    budget: {
      FCP: 2000;
      LCP: 3000;
    };
  };
}
```

---

## ğŸ“ˆ æ‰©å±•æ€§è§„æ ¼

### 1 æ¶æ„æ‰©å±•ç‚¹
```typescript
// æ‰©å±•æ¥å£è®¾è®¡
interface ExtensionPoints {
  // AIæœåŠ¡æ‰©å±•
  aiProviders: {
    interface: 'RecommendationProvider';
    implementations: ['CozeProvider', 'OpenAIProvider'];
  };
  
  // æ•°æ®å­˜å‚¨æ‰©å±•
  dataLayer: {
    interface: 'DataRepository';
    implementations: ['MemoryRepository', 'DatabaseRepository'];
  };
  
  // è®¤è¯æ‰©å±•
  authentication: {
    interface: 'AuthProvider';
    implementations: ['NoAuth', 'JWTAuth', 'OAuth'];
  };
  
  // é€šçŸ¥æ‰©å±•
  notifications: {
    interface: 'NotificationService';
    implementations: ['EmailService', 'PushService'];
  };
}
```

### 2 é…ç½®ç®¡ç†
```typescript
// é…ç½®ç³»ç»Ÿè®¾è®¡
interface ConfigurationSystem {
  environments: ['development', 'staging', 'production'];
  
  sources: {
    env: '.env files';
    cli: 'command line arguments';
    config: 'config files';
    remote: 'remote config service';
  };
  
  validation: {
    schema: 'Zod schemas';
    required: string[];
    defaults: object;
  };
  
  hotReload: {
    enabled: boolean;
    watchFiles: string[];
    gracefulRestart: boolean;
  };
}
```

---

*æ–‡æ¡£ç‰ˆæœ¬ï¼šv1.0*  
*æœ€åæ›´æ–°ï¼š2024-08-28*  
*ä¸‹æ¬¡è¯„å®¡ï¼šM2é‡Œç¨‹ç¢‘å®Œæˆå*
