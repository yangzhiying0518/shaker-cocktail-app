# Shaker APIæ¥å£æ–‡æ¡£

## ğŸ“‹ æ–‡æ¡£ä¿¡æ¯
| é¡¹ç›® | å†…å®¹ |
|------|------|
| **äº§å“åç§°** | Shaker |
| **ç‰ˆæœ¬å·** | v2.0 - æ£®æ—ä¸»é¢˜ç‰ˆæœ¬ |
| **æ–‡æ¡£ç‰ˆæœ¬** | v2.0 |
| **åˆ›å»ºæ—¥æœŸ** | 2025-01-08 |
| **APIåŸºç¡€URL** | https://shaker-cocktail-app-production.up.railway.app |
| **æ–‡æ¡£çŠ¶æ€** | âœ… å·²å®Œæˆ |

---

## ğŸŒ APIæ¦‚è§ˆ

Shaker v2.0 æä¾›RESTful APIæ¥å£ï¼Œæ”¯æŒæ™ºèƒ½é¸¡å°¾é…’æ¨èã€æµå¼å“åº”ã€ç¼“å­˜ä¼˜åŒ–ç­‰åŠŸèƒ½ã€‚

### ğŸ”— åŸºç¡€ä¿¡æ¯
- **åè®®**: HTTPS
- **æ•°æ®æ ¼å¼**: JSON
- **å­—ç¬¦ç¼–ç **: UTF-8
- **è¶…æ—¶æ—¶é—´**: 30ç§’ï¼ˆæ¨èæ¥å£50ç§’ï¼‰

### ğŸ” è®¤è¯æ–¹å¼
- æ— éœ€è®¤è¯ï¼Œå…¬å¼€API
- å†…ç½®é¢‘ç‡é™åˆ¶ï¼šæ¯IPæ¯15åˆ†é’Ÿ100æ¬¡è¯·æ±‚

---

## ğŸ“¡ APIæ¥å£åˆ—è¡¨

### 1. å¥åº·æ£€æŸ¥æ¥å£

#### `GET /api/health`
æ£€æŸ¥APIæœåŠ¡çŠ¶æ€

**è¯·æ±‚ç¤ºä¾‹:**
```bash
curl -X GET "https://shaker-cocktail-app-production.up.railway.app/api/health"
```

**å“åº”ç¤ºä¾‹:**
```json
{
  "status": "ok",
  "message": "Shaker APIæœåŠ¡æ­£å¸¸è¿è¡Œ",
  "timestamp": "2025-01-08T10:30:00.000Z",
  "environment": "production"
}
```

---

### 2. è·å–ææ–™åˆ—è¡¨æ¥å£

#### `GET /api/ingredients`
è·å–æ‰€æœ‰å¯ç”¨çš„è°ƒé…’ææ–™åˆ†ç±»

**è¯·æ±‚ç¤ºä¾‹:**
```bash
curl -X GET "https://shaker-cocktail-app-production.up.railway.app/api/ingredients"
```

**å“åº”ç¤ºä¾‹:**
```json
{
  "spirits": [
    "å¨å£«å¿Œ", "ä¼ç‰¹åŠ ", "é‡‘é…’", "æœ—å§†é…’", "é¾™èˆŒå…°", 
    "ç™½å…°åœ°", "åˆ©å£é…’", "é¦™æ§Ÿ", "å•¤é…’", "æ¸…é…’"
  ],
  "mixers": [
    "æŸ æª¬æ±", "é’æŸ æ±", "æ©™æ±", "è”“è¶Šè“æ±", "è èæ±",
    "è‹æ‰“æ°´", "æ±¤åŠ›æ°´", "å§œæ±æ±½æ°´", "å¯ä¹", "è–„è·å¶",
    "ç³–æµ†", "èœ‚èœœ", "ç›", "èƒ¡æ¤’", "è‚‰æ¡‚"
  ],
  "tools": [
    "è°ƒé…’å™¨", "é‡æ¯", "æ…æ‹Œæ£’", "æ»¤ç½‘", "å¼€ç“¶å™¨",
    "å†°æ¡¶", "æŸ æª¬åˆ€", "è£…é¥°ç­¾", "é«˜çƒæ¯", "é©¬æå°¼æ¯"
  ]
}
```

---

### 3. æ™ºèƒ½æ¨èæ¥å£

#### `POST /api/recommend`
åŸºäºç”¨æˆ·è¾“å…¥ç”Ÿæˆé¸¡å°¾é…’æ¨è

**è¯·æ±‚å‚æ•°:**
```json
{
  "scene": "èšä¼šæ´¾å¯¹",
  "moods": ["æ˜¥æ—¥æ„‰æ‚¦", "å¤æ—¥æ¿€æƒ…"],
  "ingredients": {
    "spirits": ["å¨å£«å¿Œ", "ä¼ç‰¹åŠ "],
    "mixers": ["æŸ æª¬æ±", "è‹æ‰“æ°´"],
    "tools": ["è°ƒé…’å™¨", "é‡æ¯"]
  },
  "preferences": {
    "alcohol_level": "ä¸­åº¦",
    "sweetness": "å¾®ç”œ",
    "acidity": "é€‚ä¸­",
    "style": "æ¸…çˆ½"
  },
  "special_requirements": "å¸Œæœ›é¢œå€¼é«˜ä¸€äº›"
}
```

**è¯·æ±‚ç¤ºä¾‹:**
```bash
curl -X POST "https://shaker-cocktail-app-production.up.railway.app/api/recommend" \
  -H "Content-Type: application/json" \
  -d '{
    "scene": "ç‹¬å¤„æ”¾æ¾",
    "moods": ["ç§‹å¶å®é™"],
    "ingredients": {
      "spirits": ["å¨å£«å¿Œ"],
      "mixers": ["æŸ æª¬æ±"],
      "tools": ["è°ƒé…’å™¨"]
    },
    "preferences": {
      "alcohol_level": "ä¸­åº¦",
      "sweetness": "å¾®ç”œ",
      "acidity": "é€‚ä¸­",
      "style": "æ¸…çˆ½"
    }
  }'
```

**å“åº”ç¤ºä¾‹:**
```json
{
  "success": true,
  "data": {
    "recommendations": [
      {
        "priority": "æœ€é€‚åˆ",
        "name": {
          "chinese": "å¨å£«å¿Œé…¸",
          "english": "Whiskey Sour"
        },
        "glassType": "ğŸ¥ƒ",
        "reason": "ç§‹å¶å®é™çš„å¿ƒå¢ƒé…ä¸Šå¨å£«å¿Œçš„é†‡åšï¼ŒæŸ æª¬çš„æ¸…é¦™å¸¦æ¥æ¸©æš–çš„å¹³è¡¡æ„Ÿ",
        "recipe": {
          "ingredients": [
            {"name": "å¨å£«å¿Œ", "amount": "60ml"},
            {"name": "æŸ æª¬æ±", "amount": "30ml"},
            {"name": "ç³–æµ†", "amount": "15ml"}
          ],
          "tools": ["è°ƒé…’å™¨", "é‡æ¯", "æ»¤ç½‘"],
          "difficulty": "ç®€å•"
        },
        "instructions": [
          "åœ¨è°ƒé…’å™¨ä¸­åŠ å…¥å¨å£«å¿Œã€æŸ æª¬æ±å’Œç³–æµ†",
          "åŠ å…¥å†°å—ï¼Œç”¨åŠ›æ‘‡æ™ƒ15ç§’",
          "é€šè¿‡æ»¤ç½‘å€’å…¥å²©çŸ³æ¯ä¸­",
          "ç”¨æŸ æª¬ç‰‡è£…é¥°å³å¯"
        ],
        "taste_profile": "é…¸ç”œå¹³è¡¡ï¼Œå¨å£«å¿Œçš„é†‡åšä¸æŸ æª¬çš„æ¸…é¦™å®Œç¾èåˆ",
        "visual": "é‡‘é»„è‰²æ³½ï¼ŒæŸ æª¬ç‰‡è£…é¥°ï¼Œç®€çº¦ä¼˜é›…",
        "prep_time": "3åˆ†é’Ÿ",
        "alcohol_content": "18%",
        "best_time": "å‚æ™šç‹¬å¤„æ—¶å…‰"
      }
    ]
  },
  "cached": false,
  "responseTime": 8500
}
```

**å‚æ•°è¯´æ˜:**

| å‚æ•° | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|------|------|------|------|
| scene | string | å¦ | ä½¿ç”¨åœºæ™¯ï¼šèšä¼šæ´¾å¯¹/æµªæ¼«çº¦ä¼š/ç‹¬å¤„æ”¾æ¾/å•†åŠ¡åœºåˆ/é¤å‰é¤å/æ·±å¤œæ—¶å…‰ |
| moods | array | å¦ | å¿ƒæƒ…çŠ¶æ€ï¼šæ˜¥æ—¥æ„‰æ‚¦/é›¨åå¿§éƒ/å¤æ—¥æ¿€æƒ…/ç§‹å¶å®é™/å±±å³°è‡ªä¿¡/æ·±æ—æ²‰æ€ |
| ingredients | object | å¦ | å¯ç”¨ææ–™ |
| ingredients.spirits | array | å¦ | åŸºé…’åˆ—è¡¨ |
| ingredients.mixers | array | å¦ | è°ƒæ–™åˆ—è¡¨ |
| ingredients.tools | array | å¦ | å·¥å…·åˆ—è¡¨ |
| preferences | object | å¦ | åå¥½è®¾ç½® |
| preferences.alcohol_level | string | å¦ | é…’ç²¾åº¦ï¼šä½åº¦/ä¸­åº¦/é«˜åº¦ |
| preferences.sweetness | string | å¦ | ç”œåº¦ï¼šä¸ç”œ/å¾®ç”œ/å¾ˆç”œ |
| preferences.acidity | string | å¦ | é…¸åº¦ï¼šä¸é…¸/é€‚ä¸­/å¾ˆé…¸ |
| preferences.style | string | å¦ | é£æ ¼ï¼šæ¸…çˆ½/æµ“éƒ/é¡ºæ»‘/åˆºæ¿€ |
| special_requirements | string | å¦ | ç‰¹æ®Šè¦æ±‚ |

---

### 4. æµå¼æ¨èæ¥å£

#### `POST /api/stream-recommendation`
å®æ—¶æµå¼é¸¡å°¾é…’æ¨èï¼Œæ”¯æŒServer-Sent Events

**è¯·æ±‚å‚æ•°:** åŒ `/api/recommend`

**è¯·æ±‚ç¤ºä¾‹:**
```bash
curl -X POST "https://shaker-cocktail-app-production.up.railway.app/api/stream-recommendation" \
  -H "Content-Type: application/json" \
  -H "Accept: text/event-stream" \
  -d '{
    "scene": "æµªæ¼«çº¦ä¼š",
    "moods": ["æ˜¥æ—¥æ„‰æ‚¦"]
  }'
```

**å“åº”æ ¼å¼:** Server-Sent Events (SSE)

**å“åº”äº‹ä»¶ç±»å‹:**

1. **è¿æ¥æˆåŠŸ**
```
data: {"type":"connected","message":"Shakerå¼€å§‹ä¸ºæ‚¨åˆ†æ..."}
```

2. **åˆ†æ®µåˆ†æ**
```
data: {"type":"segmented_analysis","segments":[{"title":"ç†è§£ä½ çš„åœºæ™¯é€‰æ‹©","content":"æµªæ¼«çº¦ä¼šçš„ç¾å¥½æ—¶å…‰å€¼å¾—ç²¾å¿ƒè°ƒåˆ¶","focus":"scene"}]}
```

3. **é˜¶æ®µè½¬æ¢**
```
data: {"type":"phase_transition","phase":"recommendations","message":"åˆ†æå®Œæˆï¼Œå¼€å§‹è°ƒåˆ¶æ¨è..."}
```

4. **æ¨èç»“æœ**
```
data: {"type":"recommendation","index":0,"content":{"recommendations":[...]},"glassType":"ğŸ¸"}
```

5. **å®Œæˆä¿¡å·**
```
data: {"type":"complete","message":"æ¨èå®Œæˆ"}
```

6. **é”™è¯¯å¤„ç†**
```
data: {"type":"error","message":"æ¨èæœåŠ¡æš‚æ—¶ä¸å¯ç”¨","source":"ai_service_error"}
```

---

### 5. ç³»ç»Ÿç»Ÿè®¡æ¥å£

#### `GET /api/stats`
è·å–ç³»ç»Ÿè¿è¡ŒçŠ¶æ€å’Œæ€§èƒ½ç»Ÿè®¡

**è¯·æ±‚ç¤ºä¾‹:**
```bash
curl -X GET "https://shaker-cocktail-app-production.up.railway.app/api/stats"
```

**å“åº”ç¤ºä¾‹:**
```json
{
  "success": true,
  "data": {
    "cache": {
      "totalEntries": 156,
      "hitRate": "78.5%",
      "memoryUsage": "12.3MB",
      "oldestEntry": "2025-01-08T09:15:30.000Z"
    },
    "api": {
      "totalRequests": 1247,
      "recentRequests": 89,
      "successRate": "96.8%",
      "cacheHitRate": "45.2%",
      "avgResponseTime": "3200ms",
      "lastUpdated": "2025-01-08T10:30:00.000Z"
    },
    "system": {
      "uptime": 86400,
      "memory": {
        "rss": 67108864,
        "heapTotal": 45088768,
        "heapUsed": 32505856,
        "external": 1089536
      },
      "nodeVersion": "v18.17.0",
      "platform": "linux"
    },
    "ai": {
      "provider": "VOLCANO",
      "connectionPoolReady": true
    }
  },
  "timestamp": "2025-01-08T10:30:00.000Z"
}
```

---

### 6. ç¼“å­˜ç®¡ç†æ¥å£

#### `GET /api/cache/stats`
è·å–ç¼“å­˜ç»Ÿè®¡ä¿¡æ¯

**å“åº”ç¤ºä¾‹:**
```json
{
  "success": true,
  "data": {
    "totalEntries": 156,
    "hitRate": "78.5%",
    "memoryUsage": "12.3MB",
    "oldestEntry": "2025-01-08T09:15:30.000Z"
  },
  "timestamp": "2025-01-08T10:30:00.000Z"
}
```

#### `POST /api/cache/clear`
æ¸…ç©ºæ‰€æœ‰ç¼“å­˜

**å“åº”ç¤ºä¾‹:**
```json
{
  "success": true,
  "message": "ç¼“å­˜å·²æ¸…ç©º",
  "timestamp": "2025-01-08T10:30:00.000Z"
}
```

---

## ğŸš¨ é”™è¯¯å¤„ç†

### é”™è¯¯å“åº”æ ¼å¼
```json
{
  "success": false,
  "error": "é”™è¯¯ç±»å‹",
  "message": "è¯¦ç»†é”™è¯¯ä¿¡æ¯",
  "responseTime": 1500
}
```

### å¸¸è§é”™è¯¯ç 

| HTTPçŠ¶æ€ç  | é”™è¯¯ç±»å‹ | è¯´æ˜ |
|------------|----------|------|
| 400 | Bad Request | è¯·æ±‚å‚æ•°é”™è¯¯ |
| 429 | Too Many Requests | è¯·æ±‚é¢‘ç‡è¶…é™ |
| 500 | Internal Server Error | æœåŠ¡å™¨å†…éƒ¨é”™è¯¯ |
| 503 | Service Unavailable | AIæœåŠ¡ä¸å¯ç”¨ |

### é”™è¯¯ç¤ºä¾‹
```json
{
  "success": false,
  "error": "æ¨èæœåŠ¡æš‚æ—¶ä¸å¯ç”¨",
  "message": "AIæœåŠ¡å“åº”è¶…æ—¶",
  "responseTime": 50000
}
```

---

## ğŸ”§ æŠ€æœ¯ç‰¹æ€§

### æ€§èƒ½ä¼˜åŒ–
- **å¤šå±‚ç¼“å­˜**: å†…å­˜ç¼“å­˜ + HTTPç¼“å­˜
- **è¯·æ±‚å»é‡**: é˜²æ­¢é‡å¤è¯·æ±‚
- **æµå¼å“åº”**: å‡å°‘ç­‰å¾…æ—¶é—´
- **è¿æ¥æ± **: ä¼˜åŒ–ç½‘ç»œè¿æ¥

### å¯é æ€§ä¿éšœ
- **é”™è¯¯æ¢å¤**: å®Œå–„çš„é™çº§æœºåˆ¶
- **è¶…æ—¶å¤„ç†**: åˆç†çš„è¶…æ—¶è®¾ç½®
- **é‡è¯•æœºåˆ¶**: æ™ºèƒ½é‡è¯•ç­–ç•¥
- **ç›‘æ§å‘Šè­¦**: å®æ—¶æ€§èƒ½ç›‘æ§

### æ‰©å±•æ€§è®¾è®¡
- **æœåŠ¡å·¥å‚**: æ”¯æŒå¤šAIæœåŠ¡å•†
- **æ¨¡å—åŒ–æ¶æ„**: æ˜“äºåŠŸèƒ½æ‰©å±•
- **é…ç½®åŒ–**: è¿è¡Œæ—¶é…ç½®åˆ‡æ¢

---

## ğŸ“Š ä½¿ç”¨ç»Ÿè®¡

### æ¨èè´¨é‡
- **æ¨èæˆåŠŸç‡**: â‰¥95%
- **ç”¨æˆ·æ»¡æ„åº¦**: â‰¥85%
- **å“åº”æ—¶é—´**: å¹³å‡8ç§’

### ç³»ç»Ÿæ€§èƒ½
- **APIå¯ç”¨æ€§**: â‰¥99%
- **ç¼“å­˜å‘½ä¸­ç‡**: â‰¥70%
- **å¹¶å‘æ”¯æŒ**: 100+ç”¨æˆ·

---

## ğŸ”„ ç‰ˆæœ¬æ›´æ–°

### v2.0 (2025-01-08)
- âœ… æ–°å¢æµå¼æ¨èæ¥å£
- âœ… ä¼˜åŒ–ç¼“å­˜ç³»ç»Ÿ
- âœ… å¢åŠ ç³»ç»Ÿç»Ÿè®¡æ¥å£
- âœ… å®Œå–„é”™è¯¯å¤„ç†

### v1.0 (2024-08-28)
- âœ… åŸºç¡€æ¨èæ¥å£
- âœ… ææ–™åˆ—è¡¨æ¥å£
- âœ… å¥åº·æ£€æŸ¥æ¥å£

---

**è”ç³»æ–¹å¼**: å¦‚æœ‰é—®é¢˜è¯·è”ç³»å¼€å‘å›¢é˜Ÿ
**æ›´æ–°é¢‘ç‡**: éšåŠŸèƒ½è¿­ä»£å®æ—¶æ›´æ–°
